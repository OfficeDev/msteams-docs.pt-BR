---
title: Adicionar bots personalizados ao Microsoft Teams com WebHooks de saída
author: laujan
description: como adicionar um webhook de saída
keywords: guias do Microsoft Teams saída de webhook *
ms.topic: conceptual
ms.author: lajanuar
ms.openlocfilehash: 04fc86fc3df7601235cb7f6bb7e53da59777f49f
ms.sourcegitcommit: e8dfcb167274e996395b77d65999991a18f2051a
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/15/2020
ms.locfileid: "47819057"
---
# <a name="add-custom-bots-to-microsoft-teams-with-outgoing-webhooks"></a><span data-ttu-id="4538c-104">Adicionar bots personalizados ao Microsoft Teams com WebHooks de saída</span><span class="sxs-lookup"><span data-stu-id="4538c-104">Add custom bots to Microsoft Teams with outgoing webhooks</span></span>

## <a name="what-are-outgoing-webhooks-in-teams"></a><span data-ttu-id="4538c-105">O que são WebHooks de saída no Microsoft Teams?</span><span class="sxs-lookup"><span data-stu-id="4538c-105">What are outgoing webhooks in Teams?</span></span>

<span data-ttu-id="4538c-106">Os WebHooks são uma ótima maneira de a integração do Microsoft Teams com aplicativos externos.</span><span class="sxs-lookup"><span data-stu-id="4538c-106">Webhooks are a great way for Teams to integrate with external apps.</span></span> <span data-ttu-id="4538c-107">Um webhook é essencialmente uma solicitação POST enviada para uma URL de retorno de chamada.</span><span class="sxs-lookup"><span data-stu-id="4538c-107">A webhook is essentially a POST request sent to a callback URL.</span></span> <span data-ttu-id="4538c-108">No Teams, os WebHooks de saída fornecem uma maneira simples de permitir que os usuários enviem mensagens para o seu serviço Web sem precisar passar por todo o processo de criação de bots por meio da [Microsoft bot Framework](https://dev.botframework.com/).</span><span class="sxs-lookup"><span data-stu-id="4538c-108">In Teams, outgoing webhooks provide a simple way to allow users to send messages to your web service without having to go through the full process of creating bots via the [Microsoft Bot Framework](https://dev.botframework.com/).</span></span> <span data-ttu-id="4538c-109">Os WebHooks de saída postam dados do teams para qualquer serviço escolhido capaz de aceitar uma carga JSON.</span><span class="sxs-lookup"><span data-stu-id="4538c-109">Outgoing webhooks post data from Teams to any chosen service capable of accepting a JSON payload.</span></span> <span data-ttu-id="4538c-110">Após um webhook de saída ser adicionado a uma equipe, ele atua como bot, ouvindo canais para mensagens usando \*\* \@ menção\*\*, enviando notificações para serviços Web externos e respondendo com mensagens avançadas que podem incluir cartões e imagens.</span><span class="sxs-lookup"><span data-stu-id="4538c-110">Once an outgoing webhook is added to a team, it acts like bot, listening in channels for messages using **\@mention**, sending notifications to external web services, and responding with rich messages that can include cards and images.</span></span>

## <a name="outgoing-webhook-key-features"></a><span data-ttu-id="4538c-111">Recursos de chave de webhook de saída</span><span class="sxs-lookup"><span data-stu-id="4538c-111">Outgoing webhook key features</span></span>

| <span data-ttu-id="4538c-112">Recurso</span><span class="sxs-lookup"><span data-stu-id="4538c-112">Feature</span></span> | <span data-ttu-id="4538c-113">Descrição</span><span class="sxs-lookup"><span data-stu-id="4538c-113">Description</span></span> |
| ------- | ----------- |
| <span data-ttu-id="4538c-114">Configuração com escopo</span><span class="sxs-lookup"><span data-stu-id="4538c-114">Scoped Configuration</span></span>| <span data-ttu-id="4538c-115">Os WebHooks têm escopo no nível da equipe.</span><span class="sxs-lookup"><span data-stu-id="4538c-115">Webhooks are scoped at the team level.</span></span> <span data-ttu-id="4538c-116">Você precisará passar pelo processo de instalação para cada equipe à qual deseja adicionar o webhook de saída.</span><span class="sxs-lookup"><span data-stu-id="4538c-116">You’ll need to go through the setup process for each team you want to add your outgoing webhook to.</span></span> |
| <span data-ttu-id="4538c-117">Mensagens reativas</span><span class="sxs-lookup"><span data-stu-id="4538c-117">Reactive Messaging</span></span>| <span data-ttu-id="4538c-118">Os usuários devem usar @mention para o webhook para receber mensagens.</span><span class="sxs-lookup"><span data-stu-id="4538c-118">Users must use @mention for the webhook to receive messages.</span></span> <span data-ttu-id="4538c-119">Atualmente, os usuários só podem enviar uma mensagem para um webhook de saída em canais públicos e não dentro do escopo pessoal ou privado</span><span class="sxs-lookup"><span data-stu-id="4538c-119">Currently users can only message an outgoing webhook in public channels and not within the personal or private scope</span></span> |
|<span data-ttu-id="4538c-120">Troca de mensagens HTTP padrão</span><span class="sxs-lookup"><span data-stu-id="4538c-120">Standard HTTP message exchange</span></span>|<span data-ttu-id="4538c-121">As respostas aparecerão na mesma cadeia da mensagem de solicitação original e podem incluir qualquer conteúdo de mensagem da estrutura de bot (Rich Text, imagens, cartões e emojis).</span><span class="sxs-lookup"><span data-stu-id="4538c-121">Responses will appear in the same chain as the original request message and can include any Bot Framework message content (rich text, images, cards, and emojis).</span></span> <span data-ttu-id="4538c-122">**Observação**: embora os WebHooks de saída possam usar cartões, eles não podem usar nenhuma ação de cartão, exceto para `openURL` .</span><span class="sxs-lookup"><span data-stu-id="4538c-122">**Note**: Although outgoing webhooks can use cards, they cannot use any card actions except for `openURL`.</span></span>|
| <span data-ttu-id="4538c-123">Suporte ao método de API do teams</span><span class="sxs-lookup"><span data-stu-id="4538c-123">Teams API method support</span></span>|<span data-ttu-id="4538c-124">No Teams, os WebHooks de saída enviam um HTTP POST para um serviço Web e processam uma resposta de retorno.</span><span class="sxs-lookup"><span data-stu-id="4538c-124">In Teams, outgoing webhooks send an HTTP POST to a web service and process a response back.</span></span> <span data-ttu-id="4538c-125">Eles não podem acessar nenhuma outra API como recuperar a lista ou a lista de canais em uma equipe.</span><span class="sxs-lookup"><span data-stu-id="4538c-125">They cannot access any other APIs like retrieve the roster or list of channels in a team.</span></span>|

## <a name="adding-outgoing-webhook-processing-to-your-app"></a><span data-ttu-id="4538c-126">Adicionando processamento de webhook de saída ao seu aplicativo</span><span class="sxs-lookup"><span data-stu-id="4538c-126">Adding outgoing webhook processing to your app</span></span>

<span data-ttu-id="4538c-127">**Cenário**: enviar notificações de status de alteração em um servidor de banco de dados de canal do teams para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="4538c-127">**Scenario**: Push change status notifications on a Teams channel database server to your app.</span></span>  
<span data-ttu-id="4538c-128">**Exemplo**: você tem um aplicativo de linha de negócios que controla todas as operações CRUD feitas a registros de funcionários por usuários de canal de RH de canal de equipe em uma locação do Office 365.</span><span class="sxs-lookup"><span data-stu-id="4538c-128">**Example**: You have a line-of-business app that tracks all CRUD operations made to employee records by Teams channel HR users across an Office 365 tenancy.</span></span>

### <a name="1-create-a-url-on-your-apps-server-to-accept-and-process-a-post-request-with-a-json-payload"></a><span data-ttu-id="4538c-129">1. criar uma URL no servidor de seu aplicativo para aceitar e processar uma solicitação POST com uma carga JSON</span><span class="sxs-lookup"><span data-stu-id="4538c-129">1. Create a URL on your app's server to accept and process a POST request with a JSON payload</span></span>

<span data-ttu-id="4538c-130">Seu serviço receberá mensagens no esquema de mensagens do serviço bot do Azure padrão.</span><span class="sxs-lookup"><span data-stu-id="4538c-130">Your service will receive messages in the standard Azure bot service messaging schema.</span></span> <span data-ttu-id="4538c-131">O conector da estrutura de bot é um serviço RESTful que permite que seu serviço processe o intercâmbio de mensagens formatadas por JSON por meio de protocolos HTTPS, conforme documentado na [API do serviço de bot do Azure](/bot-framework/rest-api/bot-framework-rest-connector-api-reference).</span><span class="sxs-lookup"><span data-stu-id="4538c-131">The Bot Framework connector is a RESTful service that enables your service to process the interchange of JSON formatted messages via HTTPS protocols as documented in the [Azure Bot Service API](/bot-framework/rest-api/bot-framework-rest-connector-api-reference).</span></span> <span data-ttu-id="4538c-132">Como alternativa, você pode seguir o [Microsoft bot Framework SDK] para processar e analisar mensagens.</span><span class="sxs-lookup"><span data-stu-id="4538c-132">Alternatively, you can follow the [Microsoft Bot Framework SDK] to process and parse messages.</span></span> <span data-ttu-id="4538c-133">*Consulte também*  [sobre o serviço de bot do Azure](/azure/bot-service/bot-service-overview-introduction?view=azure-bot-service-4.0).</span><span class="sxs-lookup"><span data-stu-id="4538c-133">*See also*  [About Azure Bot Service](/azure/bot-service/bot-service-overview-introduction?view=azure-bot-service-4.0).</span></span>

<span data-ttu-id="4538c-134">Os WebHooks de saída têm escopo para o `team` nível e são visíveis para todos os membros da equipe.</span><span class="sxs-lookup"><span data-stu-id="4538c-134">Outgoing webhooks are scoped to the `team` level and are visible to all members of the team.</span></span> <span data-ttu-id="4538c-135">Assim como um bot, os usuários precisam \*\* \@ mencionar\*\* o nome do webhook de saída para chamá-lo no canal.</span><span class="sxs-lookup"><span data-stu-id="4538c-135">Just like a bot, users are required to **\@mention** the name of the outgoing webhook to invoke it in the channel.</span></span>

### <a name="2-create-a-method-to-verify-the-outgoing-webhook-hmac-token"></a><span data-ttu-id="4538c-136">2. Crie um método para verificar o token HMAC de saída de webhook</span><span class="sxs-lookup"><span data-stu-id="4538c-136">2. Create a method to verify the outgoing webhook HMAC token</span></span>

<span data-ttu-id="4538c-137">Para garantir que o serviço esteja recebendo chamadas apenas de clientes do Microsoft Teams, o Microsoft Teams fornece um código HMAC no `hmac` cabeçalho HTTP que deve sempre ser incluído no seu protocolo de autenticação.</span><span class="sxs-lookup"><span data-stu-id="4538c-137">To ensure that your service is receiving calls only from actual Teams clients, Teams provides an HMAC Code in the HTTP `hmac` header that should always be  included in your authentication protocol.</span></span>

<span data-ttu-id="4538c-138">O código deve sempre validar a assinatura HMAC incluída na solicitação:</span><span class="sxs-lookup"><span data-stu-id="4538c-138">Your code should always validate the HMAC signature included in the request:</span></span>

* <span data-ttu-id="4538c-139">*Gere* o token HMAC do corpo da solicitação da mensagem.</span><span class="sxs-lookup"><span data-stu-id="4538c-139">*Generate* the HMAC token from the request body of the message.</span></span> <span data-ttu-id="4538c-140">Há bibliotecas padrão para fazer isso na maioria das plataformas (*consulte* [crypto](https://nodejs.org/api/crypto.html#crypto_crypto) para Node.js ou  *consulte* [Teams webhook Sample](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook/blob/23eb61da5a18634d51c5247944843da9abed01b6/WebhookSampleBot/Models/AuthProvider.cs) for C \# ).</span><span class="sxs-lookup"><span data-stu-id="4538c-140">There are standard libraries to do this on most platforms (*see* [Crypto](https://nodejs.org/api/crypto.html#crypto_crypto) for Node.js or  *see* [Teams Webhook Sample](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook/blob/23eb61da5a18634d51c5247944843da9abed01b6/WebhookSampleBot/Models/AuthProvider.cs) for C\#).</span></span> <span data-ttu-id="4538c-141">O Microsoft Teams usa a criptografia HMAC de SHA256 padrão.</span><span class="sxs-lookup"><span data-stu-id="4538c-141">Microsoft Teams uses standard SHA256 HMAC cryptography .</span></span> <span data-ttu-id="4538c-142">Você precisará converter o corpo em uma matriz de bytes em UTF8.</span><span class="sxs-lookup"><span data-stu-id="4538c-142">You will need to convert the body to a byte array in UTF8.</span></span>
* <span data-ttu-id="4538c-143">*Compute* o hash da matriz de bytes do token de segurança **fornecido pelo Microsoft Teams** quando você registrou o webhook de saída no cliente do teams].</span><span class="sxs-lookup"><span data-stu-id="4538c-143">*Compute* the hash from the byte array of the security token **provided by Teams** when you registered the outgoing webhook in the Teams client].</span></span> <span data-ttu-id="4538c-144">*Confira* [criar um webhook de saída](#create-an-outgoing-webhook), abaixo.</span><span class="sxs-lookup"><span data-stu-id="4538c-144">*See* [Create an outgoing webhook](#create-an-outgoing-webhook), below.</span></span>
* <span data-ttu-id="4538c-145">*Converta* o hash em uma cadeia de caracteres usando a codificação UTF-8.</span><span class="sxs-lookup"><span data-stu-id="4538c-145">*Convert* the hash to a string using UTF-8 encoding.</span></span>
* <span data-ttu-id="4538c-146">*Compare* o valor da cadeia de caracteres do hash gerado com o valor fornecido na solicitação HTTP.</span><span class="sxs-lookup"><span data-stu-id="4538c-146">*Compare* the string value of the generated hash with the value provided in the HTTP request.</span></span>

### <a name="3-create-a-method-to-send-a-success-or-failure-response"></a><span data-ttu-id="4538c-147">3. criar um método para enviar uma resposta de êxito ou falha</span><span class="sxs-lookup"><span data-stu-id="4538c-147">3. Create a method to send a success or failure response</span></span>

<span data-ttu-id="4538c-148">As respostas do webhook de saída aparecerão na mesma cadeia de resposta da mensagem original.</span><span class="sxs-lookup"><span data-stu-id="4538c-148">Responses from your outgoing webhook will appear in the same reply chain as the original message.</span></span> <span data-ttu-id="4538c-149">Quando o usuário executa uma consulta, o Microsoft Teams emite uma solicitação HTTP síncrona para o seu serviço e seu código terá 5 segundos para responder à mensagem antes que o tempo limite da conexão expire e seja encerrado.</span><span class="sxs-lookup"><span data-stu-id="4538c-149">When the user performs a query, Microsoft Teams issues a synchronous HTTP request to your service and your code will have 5 seconds to respond to the message before the connection times out and terminates.</span></span>

### <a name="example-response"></a><span data-ttu-id="4538c-150">Resposta de exemplo</span><span class="sxs-lookup"><span data-stu-id="4538c-150">Example response</span></span>

```json
{
    "type": "message",
    "text": "This is a reply!"
}
```

## <a name="create-an-outgoing-webhook"></a><span data-ttu-id="4538c-151">Criar um webhook de saída</span><span class="sxs-lookup"><span data-stu-id="4538c-151">Create an outgoing webhook</span></span>

1. <span data-ttu-id="4538c-152">Selecione a equipe apropriada e selecione **Gerenciar equipe** no menu suspenso (&#8226;&#8226;&#8226;).</span><span class="sxs-lookup"><span data-stu-id="4538c-152">Select the appropriate team and select **Manage team** from the (&#8226;&#8226;&#8226;) drop-down menu.</span></span>
1. <span data-ttu-id="4538c-153">Escolha a guia **aplicativos** na barra de navegação.</span><span class="sxs-lookup"><span data-stu-id="4538c-153">Choose the **Apps** tab from the navigation bar.</span></span>
1. <span data-ttu-id="4538c-154">No canto inferior direito da janela, selecione **criar um webhook de saída**.</span><span class="sxs-lookup"><span data-stu-id="4538c-154">From the window's lower right corner select **Create an outgoing webhook**.</span></span>
1. <span data-ttu-id="4538c-155">Na janela pop-up resultante, preencha os campos obrigatórios:</span><span class="sxs-lookup"><span data-stu-id="4538c-155">In the resulting popup window complete the required fields:</span></span>

>* <span data-ttu-id="4538c-156">**Nome** -o título do webhook e o @mention toque.</span><span class="sxs-lookup"><span data-stu-id="4538c-156">**Name** - The webhook title and @mention tap.</span></span>
>* <span data-ttu-id="4538c-157">**URL de retorno de chamada** : o ponto de extremidade HTTPS que aceita cargas JSON e receberá solicitações post do teams.</span><span class="sxs-lookup"><span data-stu-id="4538c-157">**Callback URL** - The HTTPS endpoint that accepts JSON payloads and will receive POST requests from Teams.</span></span>
>* <span data-ttu-id="4538c-158">**Descrição** -uma cadeia de caracteres detalhada que aparecerá no cartão de perfil e no painel de aplicativos de nível de equipe.</span><span class="sxs-lookup"><span data-stu-id="4538c-158">**Description** - A detailed string that will appear in the profile card and the team-level App dashboard.</span></span>
>* <span data-ttu-id="4538c-159">**Imagem de perfil** (opcional) um ícone de aplicativo para seu webhook.</span><span class="sxs-lookup"><span data-stu-id="4538c-159">**Profile Picture** (optional) an app icon for your webhook.</span></span>
>* <span data-ttu-id="4538c-160">Selecione o botão **criar** no canto inferior direito da janela pop-up e o webhook de saída será adicionado aos canais da equipe atual.</span><span class="sxs-lookup"><span data-stu-id="4538c-160">Select the **Create** button from lower right corner of the pop-up window and the outgoing webhook will be added to the current team's channels.</span></span>
>* <span data-ttu-id="4538c-161">A próxima janela de diálogo exibirá um token [de segurança HMAC (código de autenticação de mensagens baseado em hash)](https://security.stackexchange.com/questions/20129/how-and-when-do-i-use-hmac/20301) que será usado para autenticar chamadas entre o Teams e o serviço externo designado.</span><span class="sxs-lookup"><span data-stu-id="4538c-161">The next dialog window will display an [Hash-based Message Authentication Code (HMAC)](https://security.stackexchange.com/questions/20129/how-and-when-do-i-use-hmac/20301) security token that will be used to authenticate calls between Teams and the designated outside service.</span></span>
>* <span data-ttu-id="4538c-162">Se a URL for válida e os tokens de autenticação de servidor e cliente forem iguais (ou seja, um handshake HMAC), o webhook de saída estará disponível para os usuários da equipe.</span><span class="sxs-lookup"><span data-stu-id="4538c-162">If the URL is valid and the server and client authentication tokens are equal (i.e., an HMAC handshake), the outgoing webhook will be available to the team's users.</span></span>

## <a name="code-samples"></a><span data-ttu-id="4538c-163">Exemplos de código</span><span class="sxs-lookup"><span data-stu-id="4538c-163">Code samples</span></span>

<span data-ttu-id="4538c-164">Você pode exibir exemplos de código de webhook de saída no GitHub:</span><span class="sxs-lookup"><span data-stu-id="4538c-164">You can view outgoing webhook code samples on GitHub:</span></span>

### <a name="nodejs"></a><span data-ttu-id="4538c-165">Node.js</span><span class="sxs-lookup"><span data-stu-id="4538c-165">Node.js</span></span>

[<span data-ttu-id="4538c-166">OfficeDev/msteams-amostras-saída-webhook-NodeJS</span><span class="sxs-lookup"><span data-stu-id="4538c-166">OfficeDev/msteams-samples-outgoing-webhook-nodejs</span></span>](https://github.com/OfficeDev/msteams-samples-outgoing-webhook-nodejs)

### <a name="c"></a><span data-ttu-id="4538c-167">Unidade\#</span><span class="sxs-lookup"><span data-stu-id="4538c-167">C\#</span></span>

[<span data-ttu-id="4538c-168">OfficeDev/Microsoft-Teams-Sample-saída-webhook</span><span class="sxs-lookup"><span data-stu-id="4538c-168">OfficeDev/microsoft-teams-sample-outgoing-webhook</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook)
