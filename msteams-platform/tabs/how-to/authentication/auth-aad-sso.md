---
title: Suporte de login único para guias
description: Descreve o SSO (sign-on único)
ms.topic: how-to
keywords: api de login único do SSO AAD de autenticação do teams
ms.openlocfilehash: e6bf278e446861556da8362905916cc030df723e
ms.sourcegitcommit: 82bda0599ba2676ab9348c2f4284f73c7dad0838
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/06/2021
ms.locfileid: "51596678"
---
# <a name="single-sign-on-sso-support-for-tabs"></a><span data-ttu-id="1d7ff-104">Suporte a SSO (login único) para guias</span><span class="sxs-lookup"><span data-stu-id="1d7ff-104">Single sign-on (SSO) support for tabs</span></span>

<span data-ttu-id="1d7ff-105">Os usuários entrar no Microsoft Teams por meio de suas contas de trabalho, escola ou Microsoft que são Office 365, Outlook e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-105">Users sign in to Microsoft Teams through their work, school, or Microsoft accounts that is Office 365, Outlook, and so on.</span></span> <span data-ttu-id="1d7ff-106">Você pode tirar proveito disso permitindo que um único login autorize sua guia ou módulo de tarefas do Teams em clientes desktop ou móveis.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-106">You can take advantage of this by allowing a single sign-on to authorize your Teams tab or task module on desktop or mobile clients.</span></span> <span data-ttu-id="1d7ff-107">Se um usuário consentir em usar seu aplicativo, ele não precisa consentir novamente em outro dispositivo, pois ele está conectado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-107">If a user consents to use your app, they do not have to consent again on another device as they are signed in automatically.</span></span> <span data-ttu-id="1d7ff-108">Além disso, seu token de acesso é prefetchado para melhorar o desempenho e os tempos de carga.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-108">In addition, your access token is prefetched to improve performance and load times.</span></span>

> [!NOTE]
> <span data-ttu-id="1d7ff-109">**Versões do cliente móvel do Teams que suportam SSO**</span><span class="sxs-lookup"><span data-stu-id="1d7ff-109">**Teams mobile client versions supporting SSO**</span></span>  
>
> <span data-ttu-id="1d7ff-110">✔Teams para Android (1416/1.0.0.2020073101 e posterior)</span><span class="sxs-lookup"><span data-stu-id="1d7ff-110">✔Teams for Android (1416/1.0.0.2020073101 and later)</span></span>
>
> <span data-ttu-id="1d7ff-111">✔Teams para iOS (_Versão_: 2.0.18 e posterior)</span><span class="sxs-lookup"><span data-stu-id="1d7ff-111">✔Teams for iOS (_Version_: 2.0.18 and later)</span></span>  
>
> <span data-ttu-id="1d7ff-112">Para ter a melhor experiência com o Teams, use a versão mais recente do iOS e android.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-112">For the best experience with Teams, use the latest version of iOS and Android.</span></span>

> [!NOTE]
> <span data-ttu-id="1d7ff-113">**Início rápido**</span><span class="sxs-lookup"><span data-stu-id="1d7ff-113">**Quickstart**</span></span>  
>
> <span data-ttu-id="1d7ff-114">O caminho mais simples para começar com a guia SSO é com o kit de ferramentas do Teams para Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-114">The simplest path to getting started with tab SSO is with the Teams toolkit for Visual Studio Code.</span></span> <span data-ttu-id="1d7ff-115">Para obter mais informações, consulte [SSO with Teams toolkit and Visual Studio Code for tabs](../../../toolkit/visual-studio-code-tab-sso.md)</span><span class="sxs-lookup"><span data-stu-id="1d7ff-115">For more information, see [SSO with Teams toolkit and Visual Studio Code for tabs](../../../toolkit/visual-studio-code-tab-sso.md)</span></span>

## <a name="how-sso-works-at-runtime"></a><span data-ttu-id="1d7ff-116">Como o SSO funciona em tempo de execução</span><span class="sxs-lookup"><span data-stu-id="1d7ff-116">How SSO works at runtime</span></span>

<span data-ttu-id="1d7ff-117">A imagem a seguir mostra como o processo de SSO funciona:</span><span class="sxs-lookup"><span data-stu-id="1d7ff-117">The following image shows how the SSO process works:</span></span>

<!-- markdownlint-disable MD033 -->
<img src="~/assets/images/tabs/tabs-sso-diagram.png" alt="Tab single sign-on SSO diagram" width="75%"/>

1. <span data-ttu-id="1d7ff-118">Na guia, uma chamada JavaScript é feita para `getAuthToken()` .</span><span class="sxs-lookup"><span data-stu-id="1d7ff-118">In the tab, a JavaScript call is made to `getAuthToken()`.</span></span> <span data-ttu-id="1d7ff-119">Isso diz ao Teams para obter um token de autenticação para o aplicativo de tabulação.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-119">This tells Teams to obtain an authentication token for the tab application.</span></span>
2. <span data-ttu-id="1d7ff-120">Se essa for a primeira vez que o usuário atual usou seu aplicativo de tabulação, haverá um prompt de solicitação para consentir se o consentimento for necessário ou para lidar com a autenticação de etapa, como a autenticação de dois fatores.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-120">If this is the first time the current user has used your tab application, there is a request prompt to consent if consent is required or to handle step-up authentication such as two-factor authentication.</span></span>
3. <span data-ttu-id="1d7ff-121">O Teams solicita o token de aplicativo de tabulação do ponto de extremidade do Azure Active Directory (AAD) para o usuário atual.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-121">Teams requests the tab application token from the Azure Active Directory (AAD) endpoint for the current user.</span></span>
4. <span data-ttu-id="1d7ff-122">O AAD envia o token de aplicativo de tabulação para o aplicativo teams.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-122">AAD sends the tab application token to the Teams application.</span></span>
5. <span data-ttu-id="1d7ff-123">O Teams envia o token de aplicativo de tabulação para a guia como parte do objeto de resultado retornado pela `getAuthToken()` chamada.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-123">Teams sends the tab application token to the tab as part of the result object returned by the `getAuthToken()` call.</span></span>
6. <span data-ttu-id="1d7ff-124">O token é analisado no aplicativo de tabulação usando JavaScript, para extrair informações necessárias, como o endereço de email do usuário.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-124">The token is parsed in the tab application using JavaScript, to extract required information, such as the user's email address.</span></span>

> [!NOTE]
> <span data-ttu-id="1d7ff-125">O é válido apenas para consentir um conjunto limitado de APIs no nível do usuário que são `getAuthToken()` email, perfil, offline_access e OpenId.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-125">The `getAuthToken()` is only valid for consenting to a limited set of user-level APIs that is email, profile, offline_access and OpenId.</span></span> <span data-ttu-id="1d7ff-126">Ele não é usado para outros escopos do Graph, como `User.Read` ou `Mail.Read` .</span><span class="sxs-lookup"><span data-stu-id="1d7ff-126">It is not used for further Graph scopes such as `User.Read` or `Mail.Read`.</span></span> <span data-ttu-id="1d7ff-127">Para soluções alternativas sugeridas, consulte [escopos adicionais do Graph.](#apps-that-require-additional-graph-scopes)</span><span class="sxs-lookup"><span data-stu-id="1d7ff-127">For suggested workarounds, see [additional Graph scopes](#apps-that-require-additional-graph-scopes).</span></span>

<span data-ttu-id="1d7ff-128">A API do SSO também funciona em [módulos de tarefas](../../../task-modules-and-cards/what-are-task-modules.md) que incorporam conteúdo da Web.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-128">The SSO API also works in [task modules](../../../task-modules-and-cards/what-are-task-modules.md) that embed web content.</span></span>

## <a name="develop-an-sso-microsoft-teams-tab"></a><span data-ttu-id="1d7ff-129">Desenvolver uma guia SSO do Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="1d7ff-129">Develop an SSO Microsoft Teams tab</span></span>

<span data-ttu-id="1d7ff-130">Esta seção descreve as tarefas envolvidas na criação de uma guia do Teams que usa SSO.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-130">This section describes the tasks involved in creating a Teams tab that uses SSO.</span></span> <span data-ttu-id="1d7ff-131">Essas tarefas são agnósticas de idioma e estrutura.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-131">These tasks are language- and framework-agnostic.</span></span>

### <a name="1-create-your-aad-application"></a><span data-ttu-id="1d7ff-132">1. Crie seu aplicativo AAD</span><span class="sxs-lookup"><span data-stu-id="1d7ff-132">1. Create your AAD application</span></span>

<span data-ttu-id="1d7ff-133">**Para registrar seu aplicativo na visão geral [do portal do AAD](https://azure.microsoft.com/features/azure-portal/)**</span><span class="sxs-lookup"><span data-stu-id="1d7ff-133">**To register your application in the [AAD portal](https://azure.microsoft.com/features/azure-portal/) overview**</span></span>

1. <span data-ttu-id="1d7ff-134">Obter sua [ID do Aplicativo AAD.](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in)</span><span class="sxs-lookup"><span data-stu-id="1d7ff-134">Get your [AAD Application ID](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in).</span></span>
2. <span data-ttu-id="1d7ff-135">Especifique as permissões que seu aplicativo precisa para o ponto de extremidade do AAD e, opcionalmente, Graph.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-135">Specify the permissions that your application needs for the AAD endpoint and, optionally, Graph.</span></span>
3. <span data-ttu-id="1d7ff-136">[Conceda permissões](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) para aplicativos desktop, web e móveis do Teams.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-136">[Grant permissions](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) for Teams desktop, web, and mobile applications.</span></span>
4. <span data-ttu-id="1d7ff-137">Pré-autorizar o Teams selecionando **o** botão Adicionar um escopo e, no painel que é aberto, insira access_as_user **como** o nome **do escopo**.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-137">Pre-authorize Teams by selecting the **Add a scope** button and in the panel that opens, enter **access_as_user** as the **Scope name**.</span></span>

> [!NOTE]
> <span data-ttu-id="1d7ff-138">Há algumas restrições importantes que você deve saber:</span><span class="sxs-lookup"><span data-stu-id="1d7ff-138">There are some important restrictions that you must know:</span></span>
>
> * <span data-ttu-id="1d7ff-139">Somente as permissões da API graph no nível do usuário têm suporte, ou seja, email, perfil, offline_access, OpenId.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-139">Only user-level Graph API permissions are supported that is, email, profile, offline_access, OpenId.</span></span> <span data-ttu-id="1d7ff-140">Se você deve ter acesso a outros escopos do Graph, `User.Read` como ou , consulte a solução alternativa `Mail.Read` [recomendada](#apps-that-require-additional-graph-scopes).</span><span class="sxs-lookup"><span data-stu-id="1d7ff-140">If you must have access to other Graph scopes such as `User.Read` or `Mail.Read`, see [recommended workaround](#apps-that-require-additional-graph-scopes).</span></span>
> * <span data-ttu-id="1d7ff-141">É importante que o nome de domínio do aplicativo seja o mesmo que o nome de domínio que você registrou para seu aplicativo AAD.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-141">It is important that your application's domain name is the same as the domain name you have registered for your AAD application.</span></span>
> * <span data-ttu-id="1d7ff-142">Atualmente, não há suporte para vários domínios por aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-142">Currently multiple domains per app are not supported.</span></span>
> * <span data-ttu-id="1d7ff-143">Os aplicativos que usam o domínio não têm `azurewebsites.net` suporte, pois ele é muito comum e pode ser um risco de segurança.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-143">Applications that use the `azurewebsites.net` domain are not supported as it is too common and can be a security risk.</span></span>

<span data-ttu-id="1d7ff-144">**Para registrar seu aplicativo por meio do portal do AAD**</span><span class="sxs-lookup"><span data-stu-id="1d7ff-144">**To register your app through the AAD portal**</span></span>

1. <span data-ttu-id="1d7ff-145">Registre um novo aplicativo no portal registros [do aplicativo AAD.](https://go.microsoft.com/fwlink/?linkid=2083908)</span><span class="sxs-lookup"><span data-stu-id="1d7ff-145">Register a new application in the [AAD App Registrations](https://go.microsoft.com/fwlink/?linkid=2083908) portal.</span></span>
2. <span data-ttu-id="1d7ff-146">Selecione **Novo Registro**.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-146">Select **New Registration**.</span></span> <span data-ttu-id="1d7ff-147">A **página Registrar um aplicativo** é exibida.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-147">The **Register an application** page appears.</span></span>
3. <span data-ttu-id="1d7ff-148">Na página **Registrar um aplicativo,** insira os seguintes valores:</span><span class="sxs-lookup"><span data-stu-id="1d7ff-148">In the **Register an application** page, enter the following values:</span></span>
    1. <span data-ttu-id="1d7ff-149">Insira um **Nome** para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-149">Enter a **Name** for your app.</span></span>
    2. <span data-ttu-id="1d7ff-150">Escolha os **tipos de conta com** suporte, selecione locatário único ou tipo de conta multitenant.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-150">Choose the **Supported account types**, select single tenant or multitenant account type.</span></span> <span data-ttu-id="1d7ff-151">¹</span><span class="sxs-lookup"><span data-stu-id="1d7ff-151">¹</span></span>
    * <span data-ttu-id="1d7ff-152">Deixe o **URI de Redirecionamento** vazio.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-152">Leave **Redirect URI** empty.</span></span>
    3. <span data-ttu-id="1d7ff-153">Escolha **Registrar**.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-153">Choose **Register**.</span></span>
4. <span data-ttu-id="1d7ff-154">Na página visão geral, copie e salve a **ID do aplicativo (cliente).**</span><span class="sxs-lookup"><span data-stu-id="1d7ff-154">On the overview page, copy and save the **Application (client) ID**.</span></span> <span data-ttu-id="1d7ff-155">Você deve tê-lo mais tarde ao atualizar seu manifesto de aplicativo do Teams.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-155">You must have it later when updating your Teams application manifest.</span></span>
5. <span data-ttu-id="1d7ff-156">Em **Gerenciar**, selecione **Expor uma API**.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-156">Under **Manage**, select **Expose an API**.</span></span>
6. <span data-ttu-id="1d7ff-157">Selecione o link **Definir** para gerar o URI de ID do Aplicativo no formato `api://{AppID}` de .</span><span class="sxs-lookup"><span data-stu-id="1d7ff-157">Select the **Set** link to generate the Application ID URI in the form of `api://{AppID}`.</span></span> <span data-ttu-id="1d7ff-158">Insira seu nome de domínio totalmente qualificado com uma barra de avanço "/" anexada ao final, entre as barras de avanço duplo e o GUID.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-158">Insert your fully qualified domain name with a forward slash "/" appended to the end, between the double forward slashes and the GUID.</span></span> <span data-ttu-id="1d7ff-159">A ID inteira deve ter a forma `api://fully-qualified-domain-name.com/{AppID}` de .</span><span class="sxs-lookup"><span data-stu-id="1d7ff-159">The entire ID must have the form of `api://fully-qualified-domain-name.com/{AppID}`.</span></span> <span data-ttu-id="1d7ff-160">² Por exemplo, `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` .</span><span class="sxs-lookup"><span data-stu-id="1d7ff-160">² For example, `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`.</span></span> <span data-ttu-id="1d7ff-161">O nome de domínio totalmente qualificado é o nome de domínio acessível para humanos a partir do qual seu aplicativo é servido.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-161">The fully qualified domain name is the human readable domain name from which your app is served.</span></span> <span data-ttu-id="1d7ff-162">Se você estiver usando um serviço de túnel, como ngrok, deverá atualizar esse valor sempre que o subdomínio ngrok mudar.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-162">If you are using a tunneling service such as ngrok, you must update this value whenever your ngrok subdomain changes.</span></span>
7. <span data-ttu-id="1d7ff-163">Selecione **Adicionar um escopo**.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-163">Select **Add a scope**.</span></span> <span data-ttu-id="1d7ff-164">No painel que é aberto, digite **access_as_user** como o **nome do escopo**.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-164">In the panel that opens, enter **access_as_user** as the **Scope name**.</span></span>
8. <span data-ttu-id="1d7ff-165">Na caixa **Quem pode consentir?** insira **Administradores e usuários**.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-165">In the **Who can consent?** box, enter **Admins and users**.</span></span>
9. <span data-ttu-id="1d7ff-166">Insira os detalhes nas caixas para configurar os prompts de consentimento do administrador e do usuário com valores apropriados para o `access_as_user` escopo:</span><span class="sxs-lookup"><span data-stu-id="1d7ff-166">Enter the details in the boxes for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope:</span></span>
    * <span data-ttu-id="1d7ff-167">**Título de consentimento do administrador:** O Teams pode acessar o perfil do usuário.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-167">**Admin consent title:** Teams can access the user’s profile.</span></span>
    * <span data-ttu-id="1d7ff-168">**Descrição do** consentimento do administrador: o Teams pode chamar as APIs da Web do aplicativo como o usuário atual.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-168">**Admin consent description**: Teams can call the app’s web APIs as the current user.</span></span>
    * <span data-ttu-id="1d7ff-169">**Título de consentimento do** usuário : o Teams pode acessar seu perfil e fazer solicitações em seu nome.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-169">**User consent title**: Teams can access your profile and make requests on your behalf.</span></span>
    * <span data-ttu-id="1d7ff-170">**Descrição do consentimento do usuário:** O Teams pode chamar as APIs desse aplicativo com os mesmos direitos que você.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-170">**User consent description:** Teams can call this app’s APIs with the same rights as you have.</span></span>
10. <span data-ttu-id="1d7ff-171">Verifique se o **Estado** está definido como **Habilitado**.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-171">Ensure that **State** is set to **Enabled**.</span></span>
11. <span data-ttu-id="1d7ff-172">Selecione **Adicionar escopo** para salvar os detalhes.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-172">Select **Add scope** to save the details.</span></span> <span data-ttu-id="1d7ff-173">A parte de domínio do nome **escopo** exibida abaixo do campo de texto deve corresponder automaticamente ao conjunto de URI **de ID** do aplicativo na etapa anterior, com anexado `/access_as_user` ao final `api://subdomain.example.com/00000000-0000-0000-0000-000000000000/access_as_user` .</span><span class="sxs-lookup"><span data-stu-id="1d7ff-173">The domain part of the **Scope name** displayed below the text field must automatically match the **Application ID** URI set in the previous step, with `/access_as_user` appended to the end `api://subdomain.example.com/00000000-0000-0000-0000-000000000000/access_as_user`.</span></span>
12. <span data-ttu-id="1d7ff-174">Na seção **Aplicativos cliente autorizados,** identifique os aplicativos que você deseja autorizar para o aplicativo Web do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-174">In the **Authorized client applications** section, identify the applications that you want to authorize for your app’s web application.</span></span> <span data-ttu-id="1d7ff-175">Selecione **Adicionar um aplicativo cliente**.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-175">Select **Add a client application**.</span></span> <span data-ttu-id="1d7ff-176">Insira cada uma das seguintes IDs de cliente e selecione o escopo autorizado criado na etapa anterior:</span><span class="sxs-lookup"><span data-stu-id="1d7ff-176">Enter each of the following client IDs and select the authorized scope you created in the previous step:</span></span>
    * <span data-ttu-id="1d7ff-177">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` para aplicativos móveis ou desktop do Teams.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-177">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` for Teams mobile or desktop application.</span></span>
    * <span data-ttu-id="1d7ff-178">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` para o aplicativo Web do Teams.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-178">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` for Teams web application.</span></span>
13. <span data-ttu-id="1d7ff-179">Navegue até **Permissões de API**.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-179">Navigate to **API Permissions**.</span></span> <span data-ttu-id="1d7ff-180">Selecione **Adicionar uma permissão permissões** Delegadas do Microsoft  >  **Graph** e adicione as seguintes permissões da API do  >  Graph:</span><span class="sxs-lookup"><span data-stu-id="1d7ff-180">Select **Add a permission** > **Microsoft Graph** > **Delegated permissions**, then add the following permissions from Graph API:</span></span>
    * <span data-ttu-id="1d7ff-181">User.Read habilitado por padrão</span><span class="sxs-lookup"><span data-stu-id="1d7ff-181">User.Read enabled by default</span></span>
    * <span data-ttu-id="1d7ff-182">email</span><span class="sxs-lookup"><span data-stu-id="1d7ff-182">email</span></span>
    * <span data-ttu-id="1d7ff-183">offline_access</span><span class="sxs-lookup"><span data-stu-id="1d7ff-183">offline_access</span></span>
    * <span data-ttu-id="1d7ff-184">OpenId</span><span class="sxs-lookup"><span data-stu-id="1d7ff-184">OpenId</span></span>
    * <span data-ttu-id="1d7ff-185">perfil</span><span class="sxs-lookup"><span data-stu-id="1d7ff-185">profile</span></span>

14. <span data-ttu-id="1d7ff-186">Navegue até **Autenticação**.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-186">Navigate to **Authentication**.</span></span>

    <span data-ttu-id="1d7ff-187">Se um aplicativo não tiver sido concedido o consentimento do administrador de IT, os usuários terão que fornecer consentimento na primeira vez que usarem um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-187">If an app has not been granted IT admin consent, users have to provide consent the first time they use an app.</span></span>

    <span data-ttu-id="1d7ff-188">Para inserir um URI de redirecionamento:</span><span class="sxs-lookup"><span data-stu-id="1d7ff-188">To enter a redirect URI:</span></span>
    * <span data-ttu-id="1d7ff-189">Selecione **Adicionar uma plataforma**.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-189">Select **Add a platform**.</span></span>
    * <span data-ttu-id="1d7ff-190">Selecione **Web**.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-190">Select **web**.</span></span>
    * <span data-ttu-id="1d7ff-191">Insira o **URI de redirecionamento** para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-191">Enter the **redirect URI** for your app.</span></span> <span data-ttu-id="1d7ff-192">Esta é a página em que um fluxo de concessão implícito bem-sucedido redireciona o usuário.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-192">This is the page where a successful implicit grant flow redirects the user.</span></span> <span data-ttu-id="1d7ff-193">Esse é o mesmo nome de domínio totalmente qualificado que você entrou na etapa 5 seguido pela rota da API para a qual uma resposta de autenticação é enviada.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-193">This is the same fully qualified domain name that you entered in step 5 followed by the API route where an authentication response is sent.</span></span> <span data-ttu-id="1d7ff-194">Se você estiver seguindo qualquer um dos exemplos do Teams, será `https://subdomain.example.com/auth-end` .</span><span class="sxs-lookup"><span data-stu-id="1d7ff-194">If you are following any of the Teams samples, this is `https://subdomain.example.com/auth-end`.</span></span>

    <span data-ttu-id="1d7ff-195">Habilitar a concessão implícita verificando as seguintes caixas: ✔ Token de ID ✔ Token de Acesso</span><span class="sxs-lookup"><span data-stu-id="1d7ff-195">Enable implicit grant by checking the following boxes: ✔ ID Token ✔ Access Token</span></span>

<span data-ttu-id="1d7ff-196">Parabéns!</span><span class="sxs-lookup"><span data-stu-id="1d7ff-196">Congratulations!</span></span> <span data-ttu-id="1d7ff-197">Você concluiu os pré-requisitos de registro do aplicativo para continuar com seu aplicativo SSO de guia.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-197">You have completed the app registration prerequisites to proceed with your tab SSO app.</span></span>

> [!NOTE]
>
> * <span data-ttu-id="1d7ff-198">¹ Se seu aplicativo AAD estiver registrado no mesmo locatário em que você está fazendo uma solicitação de autenticação no Teams, o usuário não poderá ser solicitado a consentir e terá um token de acesso imediatamente.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-198">¹ If your AAD app is registered in the same tenant where you are making an authentication request in Teams, the user cannot be asked to consent and is granted an access token right away.</span></span> <span data-ttu-id="1d7ff-199">Os usuários só consentem com essas permissões se o aplicativo AAD estiver registrado em um locatário diferente.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-199">Users only consent to these permissions if the AAD app is registered in a different tenant.</span></span>
> * <span data-ttu-id="1d7ff-200">² Se o domínio personalizado não for adicionado ao AAD, você receberá um erro informando que o nome do host não deve ser baseado em um domínio já pertencente.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-200">² If the custom domain is not added to AAD, you get an error stating that the host name must not be based on an already owned domain.</span></span> <span data-ttu-id="1d7ff-201">Para adicionar domínio personalizado ao AAD e registrá-lo, siga o procedimento adicionar um nome de domínio personalizado ao [procedimento AAD](/azure/active-directory/fundamentals/add-custom-domain) e repita a etapa 5.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-201">To add custom domain to AAD and register it, follow the [add a custom domain name to AAD](/azure/active-directory/fundamentals/add-custom-domain) procedure, and then repeat step 5.</span></span> <span data-ttu-id="1d7ff-202">Você também pode obter esse erro se não estiver se inscreveu com credenciais de administrador na área de trabalho do Office 365.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-202">You can also get this error if you are not signed in with Admin credentials in the Office 365 tenancy.</span></span>
> * <span data-ttu-id="1d7ff-203">Se você não estiver recebendo o nome principal do usuário (UPN)) no token de acesso retornado, você poderá adicioná-lo como uma declaração [opcional](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) no AAD.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-203">If you are not receiving the user principal name (UPN)) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in AAD.</span></span>

### <a name="2-update-your-teams-application-manifest"></a><span data-ttu-id="1d7ff-204">2. Atualizar seu manifesto de aplicativo do Teams</span><span class="sxs-lookup"><span data-stu-id="1d7ff-204">2. Update your Teams application manifest</span></span>

<span data-ttu-id="1d7ff-205">Use o seguinte código para adicionar novas propriedades ao manifesto do Teams:</span><span class="sxs-lookup"><span data-stu-id="1d7ff-205">Use the following code to add new properties to your Teams manifest:</span></span>

```json
"webApplicationInfo": {
  "id": "00000000-0000-0000-0000-000000000000",
  "resource": "api://subdomain.example.com/00000000-0000-0000-0000-000000000000"
}
```

* <span data-ttu-id="1d7ff-206">**WebApplicationInfo** é o pai dos seguintes elementos:</span><span class="sxs-lookup"><span data-stu-id="1d7ff-206">**WebApplicationInfo** is the parent of the following elements:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="1d7ff-207">**id** - A ID do cliente do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-207">**id** - The client ID of the application.</span></span> <span data-ttu-id="1d7ff-208">Esta é a ID do aplicativo que você obteve como parte do registro do aplicativo no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-208">This is the application ID that you obtained as part of registering the application with Azure AD.</span></span>
>* <span data-ttu-id="1d7ff-209">**resource** - O domínio e o subdomínio do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-209">**resource** - The domain and subdomain of your application.</span></span> <span data-ttu-id="1d7ff-210">Esse é o mesmo URI (incluindo o `api://` protocolo) que você registrou ao criar seu `scope` na etapa 6.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-210">This is the same URI (including the `api://` protocol) that you registered when creating your `scope` in step 6.</span></span> <span data-ttu-id="1d7ff-211">Você não deve incluir o `access_as_user` caminho em seu recurso.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-211">You must not include the `access_as_user` path in your resource.</span></span> <span data-ttu-id="1d7ff-212">A parte de domínio deste URI deve corresponder ao domínio, incluindo quaisquer subdomas, usados nas URLs do manifesto do aplicativo teams.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-212">The domain part of this URI must match the domain, including any subdomains, used in the URLs of your Teams application manifest.</span></span>

> [!NOTE]
>
>* <span data-ttu-id="1d7ff-213">O recurso para um aplicativo AAD geralmente é a raiz de sua URL de site e o appID (por `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` exemplo, ).</span><span class="sxs-lookup"><span data-stu-id="1d7ff-213">The resource for an AAD app is usually the root of its site URL and the appID (e.g. `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`).</span></span> <span data-ttu-id="1d7ff-214">Esse valor também é usado para garantir que sua solicitação seja proveniente do mesmo domínio.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-214">This value is also used to ensure your request is coming from the same domain.</span></span> <span data-ttu-id="1d7ff-215">Verifique se a `contentURL` guia para sua guia usa os mesmos domínios que sua propriedade de recurso.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-215">Ensure that the `contentURL` for your tab uses the same domains as your resource property.</span></span>
>* <span data-ttu-id="1d7ff-216">Você deve usar o manifesto versão 1.5 ou superior para implementar o `webApplicationInfo` campo.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-216">You must use manifest version 1.5 or higher to implement the `webApplicationInfo` field.</span></span>

### <a name="3-get-an-authentication-token-from-your-client-side-code"></a><span data-ttu-id="1d7ff-217">3. Obter um token de autenticação do código do lado do cliente</span><span class="sxs-lookup"><span data-stu-id="1d7ff-217">3. Get an authentication token from your client-side code</span></span>

<span data-ttu-id="1d7ff-218">Use a seguinte API de autenticação:</span><span class="sxs-lookup"><span data-stu-id="1d7ff-218">Use the following authentication API:</span></span>

```javascript
var authTokenRequest = {
  successCallback: function(result) { console.log("Success: " + result); },
  failureCallback: function(error) { console.log("Failure: " + error); }
};
microsoftTeams.authentication.getAuthToken(authTokenRequest);
```

<span data-ttu-id="1d7ff-219">Quando você chama - e o consentimento adicional do usuário é necessário para permissões no nível do usuário, uma caixa de diálogo é mostrada ao usuário para `getAuthToken` conceder consentimento adicional.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-219">When you call `getAuthToken` - and additional user consent is required for user-level permissions, a dialog is shown to the user to grant additional consent.</span></span>

<span data-ttu-id="1d7ff-220">Depois de receber o token de acesso no retorno de chamada de sucesso, você pode decodificar o token de acesso para exibir as declarações associadas a esse token.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-220">After you receive the access token in the success callback, you can decode the access token to view the claims associated with that token.</span></span> <span data-ttu-id="1d7ff-221">Opcionalmente, você pode copiar e colar manualmente o token de acesso em uma ferramenta, como jwt.ms [inspecionar](https://jwt.ms/) seu conteúdo.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-221">Optionally, you can manually copy and paste the access token into a tool, such as [jwt.ms](https://jwt.ms/) to inspect its contents.</span></span> <span data-ttu-id="1d7ff-222">Se você não estiver recebendo o UPN no token de acesso retornado, poderá adicioná-lo como uma [declaração opcional](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) no AAD.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-222">If you are not receiving the UPN in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in AAD.</span></span>

<p>
    <img src="~/assets/images/tabs/tabs-sso-prompt.png" alt="Tab single sign-on SSO dialog prompt" width="75%"/>
</p>

## <a name="code-sample"></a><span data-ttu-id="1d7ff-223">Exemplo de código</span><span class="sxs-lookup"><span data-stu-id="1d7ff-223">Code sample</span></span>

|<span data-ttu-id="1d7ff-224">**Exemplo de nome**</span><span class="sxs-lookup"><span data-stu-id="1d7ff-224">**Sample name**</span></span>|<span data-ttu-id="1d7ff-225">**Descrição**</span><span class="sxs-lookup"><span data-stu-id="1d7ff-225">**Description**</span></span>|<span data-ttu-id="1d7ff-226">**C#**</span><span class="sxs-lookup"><span data-stu-id="1d7ff-226">**C#**</span></span>|<span data-ttu-id="1d7ff-227">**Node.js**</span><span class="sxs-lookup"><span data-stu-id="1d7ff-227">**Node.js**</span></span>|
|---------------|---------------|------|--------------|
| <span data-ttu-id="1d7ff-228">Guia SSO</span><span class="sxs-lookup"><span data-stu-id="1d7ff-228">Tab SSO</span></span> |<span data-ttu-id="1d7ff-229">Aplicativo de exemplo do Microsoft Teams para guias do Azure AD SSO</span><span class="sxs-lookup"><span data-stu-id="1d7ff-229">Microsoft Teams sample app for tabs Azure AD SSO</span></span>| [<span data-ttu-id="1d7ff-230">View</span><span class="sxs-lookup"><span data-stu-id="1d7ff-230">View</span></span>](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/tab-sso/csharp)|<span data-ttu-id="1d7ff-231">[Exibir](https://github.com/OfficeDev/Microsoft-Teams-Samples/blob/main/samples/tab-sso/nodejs),</span><span class="sxs-lookup"><span data-stu-id="1d7ff-231">[View](https://github.com/OfficeDev/Microsoft-Teams-Samples/blob/main/samples/tab-sso/nodejs),</span></span> </br>[<span data-ttu-id="1d7ff-232">Teams Toolkit</span><span class="sxs-lookup"><span data-stu-id="1d7ff-232">Teams Toolkit</span></span>](../../../toolkit/visual-studio-code-tab-sso.md)|

## <a name="known-limitations"></a><span data-ttu-id="1d7ff-233">Limitações conhecidas</span><span class="sxs-lookup"><span data-stu-id="1d7ff-233">Known limitations</span></span>

### <a name="apps-that-require-additional-graph-scopes"></a><span data-ttu-id="1d7ff-234">Aplicativos que exigem escopos adicionais do Graph</span><span class="sxs-lookup"><span data-stu-id="1d7ff-234">Apps that require additional Graph scopes</span></span>

<span data-ttu-id="1d7ff-235">Nossa implementação atual para o SSO concede consentimento apenas para permissões no nível do usuário que são email, perfil, offline_access, OpenId e não para outras APIs, como User.Read ou Mail.Read.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-235">Our current implementation for SSO only grants consent for user-level permissions that is email, profile, offline_access, OpenId and not for other APIs such as User.Read or Mail.Read.</span></span> <span data-ttu-id="1d7ff-236">Se seu aplicativo precisar de outros escopos do Graph, a próxima seção fornece algumas soluções alternativas de habilitação.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-236">If your app needs further Graph scopes, the next section provides some enabling workarounds.</span></span>

#### <a name="tenant-admin-consent"></a><span data-ttu-id="1d7ff-237">Consentimento do administrador do locatário</span><span class="sxs-lookup"><span data-stu-id="1d7ff-237">Tenant Admin Consent</span></span>

<span data-ttu-id="1d7ff-238">A abordagem mais simples é fazer com que um administrador de locatários consenta previamente em nome da organização.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-238">The simplest approach is to get a tenant admin to pre-consent on behalf of the organization.</span></span> <span data-ttu-id="1d7ff-239">Isso significa que os usuários não têm que consentir com esses escopos e, em seguida, você pode ser livre para trocar o lado do servidor de token usando o fluxo [on-behalf-of do](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow)AAD.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-239">This means users do not have to consent to these scopes and you can then be free to exchange the token server side using AAD’s [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow).</span></span> <span data-ttu-id="1d7ff-240">Essa solução alternativa é aceitável para aplicativos internos de linha de negócios, mas não é suficiente para desenvolvedores de terceiros que não podem depender da aprovação do administrador de locatários.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-240">This workaround is acceptable for internal line-of-business applications but is not enough for third-party developers who are not able to rely on tenant admin approval.</span></span>

<span data-ttu-id="1d7ff-241">Uma maneira simples de consentir em nome de uma organização como administrador de locatário é fazer referência a `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>` .</span><span class="sxs-lookup"><span data-stu-id="1d7ff-241">A simple way of consenting on behalf of an organization as a tenant admin is to refer to `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>`.</span></span>

#### <a name="ask-for-additional-consent-using-the-auth-api"></a><span data-ttu-id="1d7ff-242">Solicitar consentimento adicional usando a API Auth</span><span class="sxs-lookup"><span data-stu-id="1d7ff-242">Ask for additional consent using the Auth API</span></span>

<span data-ttu-id="1d7ff-243">Outra abordagem para obter escopos adicionais do Graph é apresentar uma caixa de diálogo de consentimento usando nossa abordagem de autenticação existente do [Azure AD](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) baseada na Web que envolve a aparecendo uma caixa de diálogo de consentimento do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-243">Another approach for getting additional Graph scopes is to present a consent dialog using our existing [web-based Azure AD authentication approach](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) which involves popping up an Azure AD consent dialog box.</span></span> 

<span data-ttu-id="1d7ff-244">**Para solicitar consentimento adicional usando a API Auth**</span><span class="sxs-lookup"><span data-stu-id="1d7ff-244">**To ask for additional consent using the Auth API**</span></span>

1. <span data-ttu-id="1d7ff-245">O token recuperado usando precisa ser trocado no lado do servidor usando o AAD em nome do fluxo para obter acesso a essas `getAuthToken()` APIs adicionais [](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) do Graph.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-245">The token retrieved using `getAuthToken()` needs to be exchanged server-side using AAD [on-behalf-of flow](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) to get access to those additional Graph APIs.</span></span> <span data-ttu-id="1d7ff-246">Certifique-se de usar o ponto de extremidade do Graph v2 para este exchange.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-246">Ensure you use the v2 Graph endpoint for this exchange.</span></span>
2. <span data-ttu-id="1d7ff-247">Se a troca falhar, o AAD retornará uma exceção de concessão inválida.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-247">If the exchange fails, AAD returns an invalid grant exception.</span></span> <span data-ttu-id="1d7ff-248">Geralmente, há uma das duas mensagens de erro `invalid_grant` ou `interaction_required` .</span><span class="sxs-lookup"><span data-stu-id="1d7ff-248">There are usually one of two error messages, `invalid_grant` or `interaction_required`.</span></span>
3. <span data-ttu-id="1d7ff-249">Quando a troca falhar, você deve solicitar consentimento adicional.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-249">When the exchange fails, you must ask for additional consent.</span></span> <span data-ttu-id="1d7ff-250">Mostrar alguma interface do usuário (UI) solicitando que o usuário conceda consentimento adicional.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-250">Show some user interface (UI) asking the user to grant additional consent.</span></span> <span data-ttu-id="1d7ff-251">Essa interface do usuário deve incluir um botão que dispara uma caixa de diálogo de consentimento do AAD usando nossa API de autenticação [AAD.](~/concepts/authentication/auth-silent-aad.md)</span><span class="sxs-lookup"><span data-stu-id="1d7ff-251">This UI must include a button that triggers an AAD consent dialog box using our [AAD authentication API](~/concepts/authentication/auth-silent-aad.md).</span></span>
4. <span data-ttu-id="1d7ff-252">Ao solicitar o consentimento adicional do AAD, você deve incluir no parâmetro `prompt=consent` [query-string para](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) a AAD, caso contrário, o AAD não solicitará os escopos adicionais.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-252">When asking for additional consent from AAD, you must include `prompt=consent` in your [query-string-parameter](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) to AAD, otherwise AAD does not ask for the additional scopes.</span></span>
    * <span data-ttu-id="1d7ff-253">Em vez de `?scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="1d7ff-253">Instead of `?scope={scopes}`</span></span>
    * <span data-ttu-id="1d7ff-254">Use isso `?prompt=consent&scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="1d7ff-254">Use this `?prompt=consent&scope={scopes}`</span></span>
    * <span data-ttu-id="1d7ff-255">Verifique se isso inclui todos os escopos que você está solicitando ao usuário, por `{scopes}` exemplo, Mail.Read ou User.Read.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-255">Ensure that `{scopes}` includes all the scopes you are prompting the user for, for example, Mail.Read or User.Read.</span></span>
5. <span data-ttu-id="1d7ff-256">Depois que o usuário tiver concedido permissão adicional, repetir o on-behalf-of-flow para obter acesso a essas APIs adicionais.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-256">Once the user has granted additional permission, retry the on-behalf-of-flow to get access to these additional APIs.</span></span>

### <a name="non-aad-authentication"></a><span data-ttu-id="1d7ff-257">Autenticação não AAD</span><span class="sxs-lookup"><span data-stu-id="1d7ff-257">Non-AAD authentication</span></span>

<span data-ttu-id="1d7ff-258">A solução de autenticação acima descrita só funciona para aplicativos e serviços que suportam o AAD como um provedor de identidade.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-258">The above-described authentication solution only works for apps and services that support AAD as an identity provider.</span></span> <span data-ttu-id="1d7ff-259">Os aplicativos que querem autenticar usando serviços não baseados no AAD devem continuar usando o fluxo de autenticação da Web baseado em [pop-up.](~/concepts/authentication.md)</span><span class="sxs-lookup"><span data-stu-id="1d7ff-259">Apps that want to authenticate using non-AAD based services must continue using the pop-up-based [web authentication flow](~/concepts/authentication.md).</span></span>

> [!NOTE]
> <span data-ttu-id="1d7ff-260">O SSO é suportado para aplicativos de propriedade do cliente nos locatários do AAD B2C.</span><span class="sxs-lookup"><span data-stu-id="1d7ff-260">SSO is supported for customer owned apps within the AAD B2C tenants.</span></span>
