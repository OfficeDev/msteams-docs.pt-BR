---
title: Logon Único
description: Descreve o logon único (SSO)
keywords: AAD de autenticação do Microsoft Teams
ms.openlocfilehash: 1857651aecd902f04bd57f5b4e2fb0fda88eb348
ms.sourcegitcommit: 4329a94918263c85d6c65ff401f571556b80307b
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 02/01/2020
ms.locfileid: "41672463"
---
# <a name="single-sign-on"></a><span data-ttu-id="82793-104">Logon Único</span><span class="sxs-lookup"><span data-stu-id="82793-104">Single Sign-On</span></span>

> [!NOTE]
> <span data-ttu-id="82793-105">A API "logon único" atualmente tem suporte somente na _visualização do desenvolvedor_ .</span><span class="sxs-lookup"><span data-stu-id="82793-105">The "single sign-on" API is currently supported in _Developer Preview_ only.</span></span>

<span data-ttu-id="82793-106">Os usuários entram no Microsoft Teams usando sua conta corporativa ou de estudante (Office 365) e você pode aproveitar isso usando o logon único (SSO) para autorizar o usuário à sua guia do Microsoft Teams. Isso significa que, se um usuário autorizar a usar seu aplicativo na área de trabalho, ele não terá que se resentir em dispositivos móveis e será automaticamente conectado.</span><span class="sxs-lookup"><span data-stu-id="82793-106">Users sign-in to Microsoft Teams using their work or school (Office 365) account and you can take advantage of this by using single sign-on (SSO) to authorize the user to your Microsoft Teams tab. That means if a user consents to use your app on desktop, they won’t have to consent again on mobile and will be automatically logged in.</span></span> 

## <a name="how-sso-works-at-runtime"></a><span data-ttu-id="82793-107">Como o SSO funciona em tempo de execução</span><span class="sxs-lookup"><span data-stu-id="82793-107">How SSO works at runtime</span></span>

<span data-ttu-id="82793-108">O diagrama a seguir mostra como funciona o processo de SSO:</span><span class="sxs-lookup"><span data-stu-id="82793-108">The following diagram shows how the SSO process works:</span></span>

<img src="~/assets/images/tabs/tabs-sso-diagram.png" alt="Tab single sign-on SSO diagram" width="75%"/>

1. <span data-ttu-id="82793-109">Na guia, JavaScript chama getAuthToken ().</span><span class="sxs-lookup"><span data-stu-id="82793-109">In the tab, JavaScript calls getAuthToken().</span></span> <span data-ttu-id="82793-110">Isso informa ao aplicativo Teams para obter um token de autenticação para o aplicativo de guia.</span><span class="sxs-lookup"><span data-stu-id="82793-110">This tells the Teams application to obtain an authentication token to the tab application.</span></span>
2. <span data-ttu-id="82793-111">Se esta é a primeira vez que o usuário atual usou seu aplicativo de guia, ele será solicitado a confirmar (se o consentimento for necessário) ou se for solicitado a lidar com a autenticação de depuração (como a autenticação de dois fatores).</span><span class="sxs-lookup"><span data-stu-id="82793-111">If this is the first time the current user has used your tab application, they will be prompted to consent (if consent is required) or asked to handle step-up authentication (such as two-factor authentication).</span></span>
3. <span data-ttu-id="82793-112">O aplicativo Microsoft Teams solicita o token do aplicativo guia do ponto de extremidade do Azure AD v 1.0 para o usuário atual.</span><span class="sxs-lookup"><span data-stu-id="82793-112">The Microsoft Teams application requests the tab application token from the Azure AD v1.0 endpoint for the current user.</span></span>
4. <span data-ttu-id="82793-113">O Azure AD envia o token do aplicativo guia para o aplicativo Teams.</span><span class="sxs-lookup"><span data-stu-id="82793-113">Azure AD sends the tab application token to the Teams application.</span></span>
5. <span data-ttu-id="82793-114">O aplicativo Microsoft Teams envia o token do aplicativo guia para a guia como parte do objeto de resultado retornado pela chamada getAuthToken ().</span><span class="sxs-lookup"><span data-stu-id="82793-114">The Microsoft Teams application sends the tab application token to the tab as part of the result object returned by the getAuthToken() call.</span></span>
6. <span data-ttu-id="82793-115">O JavaScript no aplicativo guia pode analisar o token e extrair as informações necessárias, como o endereço de email do usuário.</span><span class="sxs-lookup"><span data-stu-id="82793-115">JavaScript in the tab application can parse the token and extract the information it needs, such as the user's email address.</span></span>
    * <span data-ttu-id="82793-116">Observação: esse token só é válido para o envio de um conjunto limitado de APIs de nível de usuário (por exemplo, email, perfil, etc.) e não para escopos de gráfico adicionais (como mail. Read).</span><span class="sxs-lookup"><span data-stu-id="82793-116">Note: this token is only valid for consenting to a limited set of user-level APIs (ex: email, profile, etc)  and not for further Graph scopes (such as Mail.Read).</span></span> <span data-ttu-id="82793-117">Consulte nossa seção no final deste documento para obter soluções alternativas sugeridas se você precisar de escopos de gráfico adicionais.</span><span class="sxs-lookup"><span data-stu-id="82793-117">See our section at the end of this document for suggested workarounds if you require additional Graph scopes.</span></span>

## <a name="develop-an-sso-microsoft-teams-tab"></a><span data-ttu-id="82793-118">Desenvolver uma guia SSO do Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="82793-118">Develop an SSO Microsoft Teams tab</span></span>

<span data-ttu-id="82793-119">Esta seção descreve as tarefas envolvidas na criação de uma guia do Microsoft Teams que usam SSO.</span><span class="sxs-lookup"><span data-stu-id="82793-119">This section describes the tasks involved in creating an Microsoft Teams tab that use SSO.</span></span> <span data-ttu-id="82793-120">Essas tarefas descritas aqui apresentam uma linguagem e uma estrutura de forma agnóstica.</span><span class="sxs-lookup"><span data-stu-id="82793-120">These tasks are described here in a language- and framework-agnostic way.</span></span>

### <a name="1-create-your-aad-application-in-azure"></a><span data-ttu-id="82793-121">1. criar seu aplicativo AAD no Azure</span><span class="sxs-lookup"><span data-stu-id="82793-121">1. Create your AAD application in Azure</span></span>

<span data-ttu-id="82793-122">Registre seu aplicativo no portal de registro para o ponto de extremidade do Azure AD v 1.0.</span><span class="sxs-lookup"><span data-stu-id="82793-122">Register you application at the registration portal for the Azure AD v1.0 endpoint.</span></span> <span data-ttu-id="82793-123">Esse é um processo que leva entre 5 e 10 minutos e inclui as seguintes tarefas:</span><span class="sxs-lookup"><span data-stu-id="82793-123">This is a 5–10 minute process that includes the following tasks:</span></span>

* <span data-ttu-id="82793-124">Obtendo sua ID de aplicativo do AAD</span><span class="sxs-lookup"><span data-stu-id="82793-124">Getting your AAD application ID</span></span>
* <span data-ttu-id="82793-125">Especifique as permissões de que seu aplicativo precisa para o ponto de extremidade do AAD (e, opcionalmente, para o Microsoft Graph).</span><span class="sxs-lookup"><span data-stu-id="82793-125">Specify the permissions that your application needs for the AAD endpoint (and optionally to Microsoft Graph).</span></span> 
* <span data-ttu-id="82793-126">Conceder à área de trabalho do Microsoft Teams, a Web e o aplicativo móvel para confiar no aplicativo</span><span class="sxs-lookup"><span data-stu-id="82793-126">Grant the Microsoft Teams desktop, web and mobile application to trust to your application</span></span>
* <span data-ttu-id="82793-127">Preautor o aplicativo Microsoft Teams para seu aplicativo com o nome de escopo `access_as_user`padrão de.</span><span class="sxs-lookup"><span data-stu-id="82793-127">Preauthorize the Microsoft Teams application to your app with the default scope name of `access_as_user`.</span></span>

> [!NOTE]
> <span data-ttu-id="82793-128">Há algumas restrições importantes que você deve ter em mente:</span><span class="sxs-lookup"><span data-stu-id="82793-128">There are some important restrictions you should be aware of:</span></span>
>
> * <span data-ttu-id="82793-129">Só damos suporte a permissões de API de gráfico em nível de usuário (IE: email, Profile, offline_access, OpenID.</span><span class="sxs-lookup"><span data-stu-id="82793-129">We only support user-level Graph API permissions (ie: email, profile, offline_access, openid.</span></span> <span data-ttu-id="82793-130">Se você precisar acessar outros escopos de gráfico, leia nossa solução alternativa no final desta documentação.</span><span class="sxs-lookup"><span data-stu-id="82793-130">If you need access to other Graph scopes, read our recommended workaround at the end of this documentation.</span></span>
> * <span data-ttu-id="82793-131">É importante que o nome de domínio do aplicativo seja registrado com seu aplicativo do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="82793-131">It's important that your application's domain name be registered with your Azure AD application.</span></span> <span data-ttu-id="82793-132">Este deve ser o mesmo nome de domínio no qual o aplicativo é executado ao solicitar um token de autenticação no Teams e também ao especificar a Propriedade Resource no manifesto do Teams (mais detalhes na próxima seção).</span><span class="sxs-lookup"><span data-stu-id="82793-132">This must be the same domain name that your application runs on when requesting an authentication token in Teams and also when specifying the resource property in your Teams manifest (more details in the next section).</span></span>
> * <span data-ttu-id="82793-133">No momento, não há suporte para vários domínios por aplicativo</span><span class="sxs-lookup"><span data-stu-id="82793-133">We do not currently support multiple domains per app</span></span>
> * <span data-ttu-id="82793-134">Também não há suporte para aplicativos que usam o `azurewebsites.net` domínio, já que esse domínio é muito comum e pode ser um risco de segurança</span><span class="sxs-lookup"><span data-stu-id="82793-134">We also do not support applications that use the `azurewebsites.net` domain since this domain is too common and may be a security risk</span></span>

#### <a name="steps"></a><span data-ttu-id="82793-135">Etapas</span><span class="sxs-lookup"><span data-stu-id="82793-135">Steps</span></span>

1. <span data-ttu-id="82793-136">Registrar um novo aplicativo no [Azure Active Directory –](https://go.microsoft.com/fwlink/?linkid=2083908) portal de registro de aplicativos</span><span class="sxs-lookup"><span data-stu-id="82793-136">Register a new application in the [Azure Active Directory – App Registration](https://go.microsoft.com/fwlink/?linkid=2083908) portal</span></span>
2. <span data-ttu-id="82793-137">Selecione "novo registro".</span><span class="sxs-lookup"><span data-stu-id="82793-137">Select “New Registration”.</span></span> <span data-ttu-id="82793-138">Na página registrar um aplicativo, defina os valores da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="82793-138">On the register an application page, set the values as follows:</span></span>
    * <span data-ttu-id="82793-139">Definir **nome** para o nome do aplicativo</span><span class="sxs-lookup"><span data-stu-id="82793-139">Set **name** to your app name</span></span>
    * <span data-ttu-id="82793-140">Definir **tipos de conta com suporte** para **contas em qualquer diretório organizacional e contas pessoais da Microsoft**</span><span class="sxs-lookup"><span data-stu-id="82793-140">Set **supported account types** to **Accounts in any organizational directory and personal Microsoft accounts**</span></span>
    * <span data-ttu-id="82793-141">Sair do **URI de redirecionamento** vazio</span><span class="sxs-lookup"><span data-stu-id="82793-141">Leave **Redirect URI** empty</span></span>
    * <span data-ttu-id="82793-142">Escolha **registrar**</span><span class="sxs-lookup"><span data-stu-id="82793-142">Choose **Register**</span></span>
3. <span data-ttu-id="82793-143">Na página Visão geral, copie e salve a **ID do aplicativo (cliente)**.</span><span class="sxs-lookup"><span data-stu-id="82793-143">On the overview page, copy and save the **Application (client) ID**.</span></span> <span data-ttu-id="82793-144">Você precisará dele mais tarde ao atualizar o manifesto do aplicativo do Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="82793-144">You’ll need it later when updating your Teams application manifest.</span></span>
4. <span data-ttu-id="82793-145">Selecionar **Expor uma API** em **Gerenciar**.</span><span class="sxs-lookup"><span data-stu-id="82793-145">Select **Expose an API** under **Manage**.</span></span> <span data-ttu-id="82793-146">Selecione o link **definir** para gerar o URI da ID do aplicativo no formato `api://{AppID}`de.</span><span class="sxs-lookup"><span data-stu-id="82793-146">Select the **Set** link to generate the Application ID URI in the form of `api://{AppID}`.</span></span> <span data-ttu-id="82793-147">Insira o nome de domínio totalmente qualificado (com uma barra "/" acrescentada ao final) entre as barras duplas de avanço e o GUID.</span><span class="sxs-lookup"><span data-stu-id="82793-147">Insert your fully qualified domain name (with a forward slash "/" appended to the end) between the double forward slashes and the GUID.</span></span> <span data-ttu-id="82793-148">A ID completa deve ter a forma de:`api://fully-qualified-domain-name.com/{AppID}`</span><span class="sxs-lookup"><span data-stu-id="82793-148">The entire ID should have the form of: `api://fully-qualified-domain-name.com/{AppID}`</span></span>
    * <span data-ttu-id="82793-149">ex: `api://subdomain.example.com:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`.</span><span class="sxs-lookup"><span data-stu-id="82793-149">ex: `api://subdomain.example.com:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`.</span></span>

> [!NOTE]
> <span data-ttu-id="82793-150">Se você receber um erro dizendo que o domínio já pertence a alguém, mas você é o seu proprietário, siga o procedimento em [Início Rápido: Adicionar um domínio personalizado ao Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) para registrá-lo e, em seguida, repita esta etapa.</span><span class="sxs-lookup"><span data-stu-id="82793-150">If you get an error saying that the domain is already owned but you own it, follow the procedure at [Quickstart: Add a custom domain name to Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) to register it, and then repeat this step.</span></span> <span data-ttu-id="82793-151">(Esse erro também pode ocorrer se você não tiver entrado com as credenciais de um administrador no Office 365 locação).</span><span class="sxs-lookup"><span data-stu-id="82793-151">(This error can also occur if you are not signed in with credentials of an admin in the Office 365 tenancy).</span></span>

5. <span data-ttu-id="82793-152">Selecione o botão **Adicionar um escopo**.</span><span class="sxs-lookup"><span data-stu-id="82793-152">Select the **Add a scope** button.</span></span> <span data-ttu-id="82793-153">No painel que se abre, insira `access_as_user` como o **Nome de escopo**.</span><span class="sxs-lookup"><span data-stu-id="82793-153">In the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>
6. <span data-ttu-id="82793-154">Definir quem pode consentir? para administradores e usuários</span><span class="sxs-lookup"><span data-stu-id="82793-154">Set Who can consent? to Admins and users</span></span>
7. <span data-ttu-id="82793-155">Preencha os campos para configurar os prompts de consentimento de usuário e administrador com os valores que são apropriados `access_as_user` para o escopo.</span><span class="sxs-lookup"><span data-stu-id="82793-155">Fill in the fields for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope.</span></span> <span data-ttu-id="82793-156">Sugestões:</span><span class="sxs-lookup"><span data-stu-id="82793-156">Suggestions:</span></span>
    * <span data-ttu-id="82793-157">**Título do consentimento do administrador:** O Microsoft Teams pode acessar o perfil do usuário</span><span class="sxs-lookup"><span data-stu-id="82793-157">**Admin consent title:** Teams can access the user’s profile</span></span>
    * <span data-ttu-id="82793-158">**Descrição do consentimento do administrador**: permite que o Teams chame as APIs Web do aplicativo como o usuário atual.</span><span class="sxs-lookup"><span data-stu-id="82793-158">**Admin consent description**: Allows Teams to call the app’s web APIs as the current user.</span></span>
    * <span data-ttu-id="82793-159">**Título de consentimento do usuário**: o Teams pode acessar seu perfil de usuário e fazer solicitações em seu nome</span><span class="sxs-lookup"><span data-stu-id="82793-159">**User consent title**: Teams can access your user profile and make requests on your behalf</span></span>
    * <span data-ttu-id="82793-160">**Descrição do consentimento do usuário:** Habilitar o Teams para chamar as APIs deste aplicativo com os mesmos direitos</span><span class="sxs-lookup"><span data-stu-id="82793-160">**User consent description:** Enable Teams to call this app’s APIs with the same rights that you have</span></span>
8. <span data-ttu-id="82793-161">Verifique se o **estado** está definido como **habilitado**</span><span class="sxs-lookup"><span data-stu-id="82793-161">Ensure that **State** is set to **Enabled**</span></span>
9. <span data-ttu-id="82793-162">Selecionar **Adicionar escopo**</span><span class="sxs-lookup"><span data-stu-id="82793-162">Select **Add scope**</span></span>
    * <span data-ttu-id="82793-163">Observação: a parte de domínio do **nome do escopo** exibida logo abaixo do campo de texto deve corresponder automaticamente ao conjunto de URI da **ID do aplicativo** na `/access_as_user` etapa anterior, com acrescentado ao final; por exemplo:</span><span class="sxs-lookup"><span data-stu-id="82793-163">Note: The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID** URI set in the previous step, with `/access_as_user` appended to the end; for example:</span></span> 
        * `api://subdomain.example.com:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user`
10. <span data-ttu-id="82793-164">Na seção **aplicativos cliente autorizados** , identifique os aplicativos que você deseja autorizar para o aplicativo Web do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="82793-164">In the **Authorized client applications** section, you identify the applications that you want to authorize to your app’s web application.</span></span> <span data-ttu-id="82793-165">Cada uma das seguintes IDs precisa ser inserida:</span><span class="sxs-lookup"><span data-stu-id="82793-165">Each of the following IDs needs to be entered:</span></span>
    * <span data-ttu-id="82793-166">`1fec8e78-bce4-4aaf-ab1b-5451cc387264`(Aplicativo móvel/aplicativo de área de trabalho do Microsoft Teams)</span><span class="sxs-lookup"><span data-stu-id="82793-166">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Teams mobile/desktop application)</span></span>
    * <span data-ttu-id="82793-167">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346`(Aplicativo Web do Teams)</span><span class="sxs-lookup"><span data-stu-id="82793-167">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Teams web application)</span></span>
11. <span data-ttu-id="82793-168">Navegue até **permissões de API**e certifique-se de adicionar as permissões a seguir:</span><span class="sxs-lookup"><span data-stu-id="82793-168">Navigate to **API Permissions**, and make sure to add the follow permissions:</span></span>
    * <span data-ttu-id="82793-169">User. Read (ativado por padrão)</span><span class="sxs-lookup"><span data-stu-id="82793-169">User.Read (enabled by default)</span></span>
    * <span data-ttu-id="82793-170">email</span><span class="sxs-lookup"><span data-stu-id="82793-170">email</span></span>
    * <span data-ttu-id="82793-171">offline_access</span><span class="sxs-lookup"><span data-stu-id="82793-171">offline_access</span></span>
    * <span data-ttu-id="82793-172">openid</span><span class="sxs-lookup"><span data-stu-id="82793-172">openid</span></span>
    * <span data-ttu-id="82793-173">perfil</span><span class="sxs-lookup"><span data-stu-id="82793-173">profile</span></span>

### <a name="2-update-your-microsoft-teams-application-manifest"></a><span data-ttu-id="82793-174">2. atualize seu manifesto de aplicativo do Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="82793-174">2. Update your Microsoft Teams application manifest</span></span>

<span data-ttu-id="82793-175">Adicione novas propriedades ao manifesto do Microsoft Teams:</span><span class="sxs-lookup"><span data-stu-id="82793-175">Add new properties to your Microsoft Teams manifest:</span></span>

* <span data-ttu-id="82793-176">**WebApplicationInfo** – o pai dos seguintes elementos.</span><span class="sxs-lookup"><span data-stu-id="82793-176">**WebApplicationInfo** - The parent of the following elements.</span></span>
* <span data-ttu-id="82793-177">**ID** – a ID do cliente do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="82793-177">**Id** - The client ID of the application.</span></span> <span data-ttu-id="82793-178">Esta é uma ID de aplicativo que você obtém como parte do registro do aplicativo com o ponto de extremidade do Azure AD 1,0.</span><span class="sxs-lookup"><span data-stu-id="82793-178">This is an application ID that you obtain as part of registering the application with Azure AD 1.0 endpoint.</span></span>
* <span data-ttu-id="82793-179">**Resource** -o domínio e o subdomínio do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="82793-179">**Resource** - The domain and subdomain of your application.</span></span> <span data-ttu-id="82793-180">Este é o mesmo URI (incluindo o `api://` protocolo) que você usou ao registrar o aplicativo no AAD.</span><span class="sxs-lookup"><span data-stu-id="82793-180">This is the same URI (including the `api://` protocol) that you used when registering the app in AAD.</span></span> <span data-ttu-id="82793-181">A parte de domínio desse URI deve corresponder ao domínio, incluindo todos os subdomínios, usados nas URLs na seção do manifesto do aplicativo do Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="82793-181">The domain part of this URI should match the domain, including any subdomains, used in the URLs in the section of your Teams application manifest.</span></span>

```json
"webApplicationInfo": {
  "id": "<application_GUID here>",
  "resource": "<web_API resource here>"
}
```

<span data-ttu-id="82793-182">Observações:</span><span class="sxs-lookup"><span data-stu-id="82793-182">Notes:</span></span>

* <span data-ttu-id="82793-183">O recurso para um aplicativo AAD normalmente será a raiz da URL do site e a appID (por exemplo, `api://subdomain.example.com/6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`).</span><span class="sxs-lookup"><span data-stu-id="82793-183">The resource for an AAD app will usually just be the root of its site URL and the appID (e.g. `api://subdomain.example.com/6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`).</span></span> <span data-ttu-id="82793-184">Também utilizamos esse valor para garantir que sua solicitação seja proveniente do mesmo domínio.</span><span class="sxs-lookup"><span data-stu-id="82793-184">We also use this value to ensure your request is coming from the same domain.</span></span> <span data-ttu-id="82793-185">Therefor certifique-se de `contentURL` que seu para sua guia usa os mesmos domínios de sua Propriedade Resource.</span><span class="sxs-lookup"><span data-stu-id="82793-185">Therefor make sure that your `contentURL` for your tab uses the same domains as your resource property.</span></span>
* <span data-ttu-id="82793-186">Você precisa estar usando o manifesto versão 1,5 ou superior para que esses campos sejam usados.</span><span class="sxs-lookup"><span data-stu-id="82793-186">You need to be using manifest version 1.5 or higher for these fields to be used.</span></span>
* <span data-ttu-id="82793-187">Escopos não são suportados no manifesto e, em vez disso, devem ser especificados na seção permissões de API no portal do Azure</span><span class="sxs-lookup"><span data-stu-id="82793-187">Scopes aren’t supported in the manifest and instead should be specified in the API Permissions section in the Azure portal</span></span>

### <a name="3-get-an-authentication-token-from-your-client-side-code"></a><span data-ttu-id="82793-188">3. Obtenha um token de autenticação do seu código do lado do cliente</span><span class="sxs-lookup"><span data-stu-id="82793-188">3. Get an authentication token from your client-side code</span></span>

<span data-ttu-id="82793-189">Veja a aparência da API de autenticação:</span><span class="sxs-lookup"><span data-stu-id="82793-189">Here's what the authentication API looks like:</span></span>

```javascript
var authTokenRequest = {
  successCallback: function(result) { console.log("Success: " + result); },
  failureCallback: function(error) { console.log("Failure: " + error); },
};
microsoftTeams.authentication.getAuthToken(authTokenRequest);
```

<span data-ttu-id="82793-190">Quando você chama `getAuthToken` e o consentimento do usuário adicional é necessário (para permissões no nível do usuário), mostraremos uma caixa de diálogo para o usuário incentivando-o a conceder consentimento adicional.</span><span class="sxs-lookup"><span data-stu-id="82793-190">When you call `getAuthToken` - and additional user consent is required (for user-level permissions) - we will show a dialog to the user encouraging them to grant additional consent.</span></span> 

<img src="~/assets/images/tabs/tabs-sso-prompt.png" alt="Tab single sign-on SSO dialog prompt" width="75%"/>

## <a name="demo-code"></a><span data-ttu-id="82793-191">Código de demonstração</span><span class="sxs-lookup"><span data-stu-id="82793-191">Demo code</span></span>

<span data-ttu-id="82793-192">Por ora, você pode visitar nossa tarefa de aplicativo de teste [Meow](https://github.com/ydogandjiev/taskmeow) e usar o manifesto de `teams.auth.service.js` SSO `sso.auth.service.js` e fazer checkout do arquivo e do para ver como lidamos com o fluxo de trabalho de autenticação.</span><span class="sxs-lookup"><span data-stu-id="82793-192">For now you can visit our test application [Task Meow](https://github.com/ydogandjiev/taskmeow) and use the SSO manifest and checkout the `teams.auth.service.js` and `sso.auth.service.js` file to see how we handle the authentication workflow.</span></span>

## <a name="known-limitations"></a><span data-ttu-id="82793-193">Limitações conhecidas</span><span class="sxs-lookup"><span data-stu-id="82793-193">Known Limitations</span></span>

### <a name="apps-that-require-additional-graph-scopes"></a><span data-ttu-id="82793-194">Aplicativos que exigem escopos de gráfico adicionais</span><span class="sxs-lookup"><span data-stu-id="82793-194">Apps that require additional Graph Scopes</span></span>

<span data-ttu-id="82793-195">Nossa implementação atual do SSO concede consentimento apenas para permissões de nível de usuário (email, perfil, offline_access, OpenID), mas não para outras APIs (como mail. Read).</span><span class="sxs-lookup"><span data-stu-id="82793-195">Our current implementation for SSO only grants consent for user-level permissions (email, profile, offline_access, openid) but not for other APIs (such as Mail.Read).</span></span> <span data-ttu-id="82793-196">Se seu aplicativo precisar de escopos de gráficos adicionais, há algumas soluções alternativas para habilitar isso.</span><span class="sxs-lookup"><span data-stu-id="82793-196">If your app needs further Graph scopes, there are some workarounds to enable this.</span></span>

#### <a name="tenant-admin-consent"></a><span data-ttu-id="82793-197">Consentimento do administrador do locatário</span><span class="sxs-lookup"><span data-stu-id="82793-197">Tenant Admin Consent</span></span>

<span data-ttu-id="82793-198">A abordagem mais simples seria fazer com que um administrador de locatários se consentisse em nome da organização.</span><span class="sxs-lookup"><span data-stu-id="82793-198">The simplest approach would be to get a tenant admin to pre-consent on behalf of the organization.</span></span> <span data-ttu-id="82793-199">Isso significa que os usuários não terão que se concordar com esses escopos e você poderá ficar livre para trocar o lado do servidor de token usando o [fluxo em nome de do](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow)AAD.</span><span class="sxs-lookup"><span data-stu-id="82793-199">This means users won’t have to consent to these scopes and you can then be free to exchange the token server side using AAD’s [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow).</span></span> <span data-ttu-id="82793-200">Essa solução alternativa é aceitável para aplicativos de linha de negócios internos, mas pode não ser suficiente para ISVs que podem não confiar na aprovação do administrador de locatários.</span><span class="sxs-lookup"><span data-stu-id="82793-200">This workaround is acceptable for internal line-of-business applications but may not be enough for ISVs who may not be able to rely on tenant admin approval.</span></span>

<span data-ttu-id="82793-201">Uma maneira simples de conenviar em nome de uma organização (como um administrador de locatários) é visitar:</span><span class="sxs-lookup"><span data-stu-id="82793-201">A simple way of consenting on behalf of an organization (as a tenant admin) is to visit:</span></span>

* `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>`

#### <a name="asking-for-additional-consent-using-the-auth-api"></a><span data-ttu-id="82793-202">Solicitar consentimento adicional usando a API de autenticação</span><span class="sxs-lookup"><span data-stu-id="82793-202">Asking for additional consent using the Auth API</span></span>

<span data-ttu-id="82793-203">Outra abordagem para obter escopos de gráfico adicionais seria apresentar uma caixa de diálogo de consentimento usando nossa [abordagem existente de autenticação AAD baseada na Web,](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) que envolve a apresentação de uma caixa de diálogo de consentimento do AAD.</span><span class="sxs-lookup"><span data-stu-id="82793-203">Another approach for getting additional Graph scopes would be to present a consent dialog using our existing [web-based AAD authentication approach](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) which involves popping up an AAD consent dialog.</span></span> <span data-ttu-id="82793-204">Há algumas adições notáveis:</span><span class="sxs-lookup"><span data-stu-id="82793-204">There are some notable additions:</span></span>

1. <span data-ttu-id="82793-205">O token recuperado usando getAuthToken precisaria ser trocado no servidor usando o [fluxo em nome de](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow) AADs para obter acesso a essas APIs adicionais do Graph.</span><span class="sxs-lookup"><span data-stu-id="82793-205">The token retrieved using getAuthToken would need to be exchanged server side using AADs [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow) to get access to those additional Graph APIs.</span></span>
    * <span data-ttu-id="82793-206">Certifique-se de usar o ponto de extremidade do gráfico v2 para esta troca</span><span class="sxs-lookup"><span data-stu-id="82793-206">Be sure to use the v2 Graph endpoint for this exchange</span></span>
2. <span data-ttu-id="82793-207">Se o Exchange falhar, o AAD retornará uma exceção de concessão inválida.</span><span class="sxs-lookup"><span data-stu-id="82793-207">If the exchange fails, AAD will return an invalid grant exception.</span></span> <span data-ttu-id="82793-208">Há geralmente uma de duas mensagens de erro: `ConsentRequired` ou`InteractionRequired`</span><span class="sxs-lookup"><span data-stu-id="82793-208">There are usually one of two error messages: `ConsentRequired` or `InteractionRequired`</span></span>
3. <span data-ttu-id="82793-209">Quando o Exchange falhar, você precisará solicitar o consentimento adicional.</span><span class="sxs-lookup"><span data-stu-id="82793-209">When the exchange fails, then you need to ask for additional consent.</span></span> <span data-ttu-id="82793-210">Recomendamos que você mostre algumas interfaces de usuário solicitando que o usuário conceda um consentimento adicional.</span><span class="sxs-lookup"><span data-stu-id="82793-210">We recommend showing some UI asking the user to grant additional consent.</span></span> <span data-ttu-id="82793-211">Esta interface do usuário deve incluir um botão que dispare uma caixa de diálogo de consentimento do AAD usando nossa [API de autenticação AAD](~/concepts/authentication/auth-silent-aad.md).</span><span class="sxs-lookup"><span data-stu-id="82793-211">This UI should include a button that triggers an AAD consent dialog using our [AAD authentication API](~/concepts/authentication/auth-silent-aad.md).</span></span>
4. <span data-ttu-id="82793-212">Ao solicitar o consentimento adicional do AAD, você precisa incluir `prompt=consent` em seu parâmetro de cadeia de caracteres de [consulta](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) para AAD caso contrário, o AAD não solicitará os escopos adicionais.</span><span class="sxs-lookup"><span data-stu-id="82793-212">When asking for additional consent from AAD, you need to include `prompt=consent` in your [query-string-parameter](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) to AAD otherwise AAD will not ask for the additional scopes.</span></span>
    * <span data-ttu-id="82793-213">Em vez de:`?scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="82793-213">Instead of: `?scope={scopes}`</span></span>
    * <span data-ttu-id="82793-214">Use:`?prompt=consent&scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="82793-214">Use this: `?prompt=consent&scope={scopes}`</span></span>
    * <span data-ttu-id="82793-215">Certifique-se `{scopes}` de incluir todos os escopos para os quais você está solicitando o usuário (ex: mail. Read ou User. Read).</span><span class="sxs-lookup"><span data-stu-id="82793-215">Be sure that `{scopes}` includes all the scopes you are prompting the user for (ex: Mail.Read or User.Read).</span></span>
5. <span data-ttu-id="82793-216">Depois que o usuário tiver concedido permissão adicional, repita o em em nome de fluxo para obter acesso a essas APIs adicionais.</span><span class="sxs-lookup"><span data-stu-id="82793-216">Once the user has granted additional permission, retry the on-behalf-of-flow to get access to these additional APIs.</span></span>

### <a name="non-aad-authentication"></a><span data-ttu-id="82793-217">Autenticação não AAD</span><span class="sxs-lookup"><span data-stu-id="82793-217">Non-AAD Authentication</span></span>

<span data-ttu-id="82793-218">A solução de autenticação descrita acima só funciona para aplicativos e serviços que dão suporte ao Azure AD como um provedor de identidade.</span><span class="sxs-lookup"><span data-stu-id="82793-218">The above-described authentication solution only works for apps and services that support Azure AD as an identity provider.</span></span> <span data-ttu-id="82793-219">Os aplicativos que desejam autenticar usando serviços baseados em AAD precisam continuar usando o fluxo de [autenticação da Web](~/concepts/authentication.md)baseado em pop-up.</span><span class="sxs-lookup"><span data-stu-id="82793-219">Apps that want to authenticate using non-AAD based services need to continue using the popup-based [web authentication flow](~/concepts/authentication.md).</span></span>
