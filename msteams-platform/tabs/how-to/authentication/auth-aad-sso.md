---
title: Logon Único
description: Descreve o logon único (SSO)
keywords: API de logon único do AAD no SSO de autenticação de equipes
ms.openlocfilehash: 849e2c357859a1e8980aaa4662a55319cd7b2493
ms.sourcegitcommit: e355f59d2d21a2d5ae36cc46acad5ed4765b42e0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/02/2020
ms.locfileid: "45021598"
---
# <a name="single-sign-on-sso"></a><span data-ttu-id="fe6e9-104">Logon único (SSO)</span><span class="sxs-lookup"><span data-stu-id="fe6e9-104">Single Sign-On (SSO)</span></span>

> [!NOTE]
> * <span data-ttu-id="fe6e9-105">A API de logon único (SSO) geralmente está disponível na Web e na área de trabalho.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-105">The Single Sign-on (SSO) API is generally available on web and desktop.</span></span> <span data-ttu-id="fe6e9-106">O Mobile estará disponível em breve.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-106">Mobile will be available soon.</span></span> <span data-ttu-id="fe6e9-107">Enquanto isso, recomendamos fazer o fallback para nossa [API de autenticação clássica](auth-flow-tab.md) no celular.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-107">In the meantime, we recommend gracefully falling back to our [classic authentication API](auth-flow-tab.md) on mobile.</span></span>

<span data-ttu-id="fe6e9-108">Os usuários entram no Microsoft Teams por meio de suas contas corporativas, de estudante ou da Microsoft (Office 365, Outlook, etc.).</span><span class="sxs-lookup"><span data-stu-id="fe6e9-108">Users sign in to Microsoft Teams via their work, school, or Microsoft accounts (Office 365, Outlook, etc).</span></span> <span data-ttu-id="fe6e9-109">Você pode aproveitar isso permitindo que um único logon autorize sua guia do Microsoft Teams (ou módulo de tarefa) em clientes móveis ou de desktop.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-109">You can take advantage of this by allowing a single sign-on to authorize your Microsoft Teams tab (or task module) on desktop or mobile clients.</span></span> <span data-ttu-id="fe6e9-110">Portanto, se um usuário concorda em usar seu aplicativo, ele não precisará ser remetido em outro dispositivo, ele será conectado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-110">Thus, if a user consents to use your app, they won’t have to consent again on another device — they will signed in be automatically.</span></span> <span data-ttu-id="fe6e9-111">Além disso, prefetch seu token de acesso para melhorar o desempenho e os tempos de carga.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-111">In addition, we prefetch your access token to improve performance and load times.</span></span>

## <a name="how-sso-works-at-runtime"></a><span data-ttu-id="fe6e9-112">Como o SSO funciona em tempo de execução</span><span class="sxs-lookup"><span data-stu-id="fe6e9-112">How SSO works at runtime</span></span>

<span data-ttu-id="fe6e9-113">O diagrama a seguir mostra como funciona o processo de SSO:</span><span class="sxs-lookup"><span data-stu-id="fe6e9-113">The following diagram shows how the SSO process works:</span></span>

<img src="~/assets/images/tabs/tabs-sso-diagram.png" alt="Tab single sign-on SSO diagram" width="75%"/>

1. <span data-ttu-id="fe6e9-114">Na guia, é feita uma chamada JavaScript `getAuthToken()` .</span><span class="sxs-lookup"><span data-stu-id="fe6e9-114">In the tab, a JavaScript call is made to `getAuthToken()`.</span></span> <span data-ttu-id="fe6e9-115">Isso instrui o Microsoft Teams a obter um token de autenticação para o aplicativo de guia.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-115">This tells Teams to obtain an authentication token for the tab application.</span></span>
2. <span data-ttu-id="fe6e9-116">Se esta é a primeira vez que o usuário atual usou seu aplicativo de guia, haverá um prompt de solicitação para o consentimento (se o consentimento for necessário) ou para lidar com a autenticação de depuração (como autenticação de dois fatores).</span><span class="sxs-lookup"><span data-stu-id="fe6e9-116">If this is the first time the current user has used your tab application, there will be a request prompt to consent (if consent is required) or to handle step-up authentication (such as two-factor authentication).</span></span>
3. <span data-ttu-id="fe6e9-117">O Microsoft Teams solicita o token do aplicativo guia do ponto de extremidade do Azure AD para o usuário atual.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-117">Teams requests the tab application token from the Azure AD endpoint for the current user.</span></span>
4. <span data-ttu-id="fe6e9-118">O Azure AD envia o token do aplicativo guia para o aplicativo Teams.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-118">Azure AD sends the tab application token to the Teams application.</span></span>
5. <span data-ttu-id="fe6e9-119">O Microsoft Teams envia o token do aplicativo guia para a guia como parte do objeto de resultado retornado pela `getAuthToken()` chamada.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-119">Teams sends the tab application token to the tab as part of the result object returned by the `getAuthToken()` call.</span></span>
6. <span data-ttu-id="fe6e9-120">O token será analisado no aplicativo guia, via JavaScript, para extrair as informações necessárias, como o endereço de email do usuário.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-120">The token will be parsed in the tab application, via JavaScript, to extract the needed information, such as the user's email address.</span></span>

> [!NOTE]
> <span data-ttu-id="fe6e9-121">O `getAuthToken()` só é válido para o envio de um conjunto limitado de APIs de nível de usuário — email, perfil, offline_access e OpenID, e não para maiores escopos do Microsoft Graph, como `User.Read` ou `Mail.Read` .</span><span class="sxs-lookup"><span data-stu-id="fe6e9-121">The `getAuthToken()` is only valid for consenting to a limited set of user-level APIs — email, profile, offline_access and OpenId — and not for further Microsoft Graph scopes such as `User.Read` or `Mail.Read`.</span></span> <span data-ttu-id="fe6e9-122">Consulte nossa seção no final deste documento para obter soluções alternativas sugeridas se você precisar de [escopos de gráfico adicionais](#apps-that-require-additional-microsoft-graph-scopes).</span><span class="sxs-lookup"><span data-stu-id="fe6e9-122">See our section at the end of this document for suggested workarounds if you require [additional Graph scopes](#apps-that-require-additional-microsoft-graph-scopes).</span></span>

<span data-ttu-id="fe6e9-123">A API SSO também funcionará em [módulos de tarefas](../../../task-modules-and-cards/what-are-task-modules.md) que inserem conteúdo da Web.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-123">The SSO API will also work in [Task Modules](../../../task-modules-and-cards/what-are-task-modules.md) that embed web content.</span></span>

## <a name="develop-an-sso-microsoft-teams-tab"></a><span data-ttu-id="fe6e9-124">Desenvolver uma guia SSO do Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="fe6e9-124">Develop an SSO Microsoft Teams tab</span></span>

<span data-ttu-id="fe6e9-125">Esta seção descreve as tarefas envolvidas na criação de uma guia do teams que usa SSO.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-125">This section describes the tasks involved in creating a Teams tab that uses SSO.</span></span> <span data-ttu-id="fe6e9-126">Essas tarefas são descritas aqui, independente da linguagem e da estrutura.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-126">These tasks are described here are language- and framework-agnostic.</span></span>

### <a name="1-create-your-azure-active-directory-azure-ad-application"></a><span data-ttu-id="fe6e9-127">1. criar seu aplicativo do Azure Active Directory (Azure AD)</span><span class="sxs-lookup"><span data-stu-id="fe6e9-127">1. Create your Azure Active Directory (Azure AD) application</span></span>

<span data-ttu-id="fe6e9-128">Registre seu aplicativo no[portal do Azure ad](https://azure.microsoft.com/features/azure-portal/).</span><span class="sxs-lookup"><span data-stu-id="fe6e9-128">Register your application in the[Azure AD portal](https://azure.microsoft.com/features/azure-portal/).</span></span> <span data-ttu-id="fe6e9-129">Esse é um processo que leva entre 5 e 10 minutos e inclui as seguintes tarefas:</span><span class="sxs-lookup"><span data-stu-id="fe6e9-129">This is a 5–10 minute process that includes the following tasks:</span></span>

1. <span data-ttu-id="fe6e9-130">Obtenha sua [ID de aplicativo do Azure ad](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in).</span><span class="sxs-lookup"><span data-stu-id="fe6e9-130">Get your [Azure AD Application ID](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in).</span></span>
2. <span data-ttu-id="fe6e9-131">Especifique as permissões de que seu aplicativo precisa para o ponto de extremidade do Azure AD e, opcionalmente, o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-131">Specify the permissions that your application needs for the Azure AD endpoint and, optionally, Microsoft Graph.</span></span>
3. <span data-ttu-id="fe6e9-132">[Conceder permissões](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) para aplicativos de desktop, Web e móveis do teams.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-132">[Grant permissions](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) for Teams desktop, web, and mobile applications.</span></span>
4. <span data-ttu-id="fe6e9-133">Pré-autorizar o Microsoft Teams selecionando o botão **Adicionar um escopo** e no painel que é aberto, insira `access_as_user` como o **nome do escopo**.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-133">Pre-authorize Teams by selecting the **Add a scope** button and in the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>

> [!NOTE]
> <span data-ttu-id="fe6e9-134">Há algumas restrições importantes que você deve ter em mente:</span><span class="sxs-lookup"><span data-stu-id="fe6e9-134">There are some important restrictions you should be aware of:</span></span>
>
> * <span data-ttu-id="fe6e9-135">Só damos suporte a permissões de API do Microsoft Graph em nível de usuário, ou seja, email, perfil, offline_access, OpenId.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-135">We only support user-level Microsoft Graph API permissions, i.e., email, profile, offline_access, OpenId.</span></span> <span data-ttu-id="fe6e9-136">Se você precisar acessar outros escopos do Microsoft Graph (como `User.Read` ou `Mail.Read` ), consulte nossa [solução alternativa recomendada](#apps-that-require-additional-microsoft-graph-scopes) no final desta documentação.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-136">If you need access to other Microsoft Graph scopes (such as `User.Read` or `Mail.Read`), see our [recommended workaround](#apps-that-require-additional-microsoft-graph-scopes) at the end of this documentation.</span></span>
> * <span data-ttu-id="fe6e9-137">É importante que o nome de domínio do aplicativo seja o mesmo que o nome de domínio que você está registrando para seu aplicativo do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-137">It's important that your application's domain name is the same as the domain name you've registering for your Azure AD application.</span></span>
> * <span data-ttu-id="fe6e9-138">No momento, não há suporte para vários domínios por aplicativo.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-138">We don't currently support multiple domains per app.</span></span>
> * <span data-ttu-id="fe6e9-139">Não há suporte para aplicativos que usam o `azurewebsites.net` domínio porque são muito comuns e podem ser um risco de segurança.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-139">We don't support applications that use the `azurewebsites.net` domain because it is too common and may be a security risk.</span></span> <span data-ttu-id="fe6e9-140">No entanto, estamos buscando ativamente a remoção dessa restrição.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-140">However, we're actively seeking to remove this restriction.</span></span>

#### <a name="steps"></a><span data-ttu-id="fe6e9-141">Etapas</span><span class="sxs-lookup"><span data-stu-id="fe6e9-141">Steps</span></span>

1. <span data-ttu-id="fe6e9-142">Registrar um novo aplicativo no portal [do Azure Active Directory – registros de aplicativos](https://go.microsoft.com/fwlink/?linkid=2083908) .</span><span class="sxs-lookup"><span data-stu-id="fe6e9-142">Register a new application in the [Azure Active Directory – App Registrations](https://go.microsoft.com/fwlink/?linkid=2083908) portal.</span></span>
2. <span data-ttu-id="fe6e9-143">Selecione **novo registro** e na *página registrar um aplicativo*, defina os seguintes valores:</span><span class="sxs-lookup"><span data-stu-id="fe6e9-143">Select **New Registration** and on the *register an application page*, set following values:</span></span>
    * <span data-ttu-id="fe6e9-144">Defina o **nome** como o nome do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-144">Set **name** to your app name.</span></span>
    * <span data-ttu-id="fe6e9-145">Escolha os **tipos de conta com suporte** (qualquer tipo de conta funcionará) ¹</span><span class="sxs-lookup"><span data-stu-id="fe6e9-145">Choose the **supported account types** (any account type will work) ¹</span></span>
    * <span data-ttu-id="fe6e9-146">Deixe o **URI de Redirecionamento** vazio.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-146">Leave **Redirect URI** empty.</span></span>
    * <span data-ttu-id="fe6e9-147">Escolha **Registrar**.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-147">Choose **Register**.</span></span>
3. <span data-ttu-id="fe6e9-148">Na página Visão geral, copie e salve a **ID do aplicativo (cliente)**.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-148">On the overview page, copy and save the **Application (client) ID**.</span></span> <span data-ttu-id="fe6e9-149">Você precisará dele mais tarde ao atualizar o manifesto do aplicativo do Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-149">You’ll need it later when updating your Teams application manifest.</span></span>
4. <span data-ttu-id="fe6e9-150">Em **Gerenciar**, selecione **Expor uma API**.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-150">Under **Manage**, select **Expose an API**.</span></span> 
5. <span data-ttu-id="fe6e9-151">Selecione o link **definir** para gerar o URI da ID do aplicativo no formato de `api://{AppID}` .</span><span class="sxs-lookup"><span data-stu-id="fe6e9-151">Select the **Set** link to generate the Application ID URI in the form of `api://{AppID}`.</span></span> <span data-ttu-id="fe6e9-152">Insira o nome de domínio totalmente qualificado (com uma barra "/" acrescentada ao final) entre as barras duplas de avanço e o GUID.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-152">Insert your fully qualified domain name (with a forward slash "/" appended to the end) between the double forward slashes and the GUID.</span></span> <span data-ttu-id="fe6e9-153">A ID completa deve ter a forma de: `api://fully-qualified-domain-name.com/{AppID}` ²</span><span class="sxs-lookup"><span data-stu-id="fe6e9-153">The entire ID should have the form of: `api://fully-qualified-domain-name.com/{AppID}` ²</span></span>
    * <span data-ttu-id="fe6e9-154">ex: `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` .</span><span class="sxs-lookup"><span data-stu-id="fe6e9-154">ex: `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`.</span></span>
6. <span data-ttu-id="fe6e9-155">Selecione o botão **Adicionar um escopo**.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-155">Select the **Add a scope** button.</span></span> <span data-ttu-id="fe6e9-156">No painel que se abre, insira `access_as_user` como o **Nome de escopo**.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-156">In the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>
7. <span data-ttu-id="fe6e9-157">Definir **quem pode consentir?** para`Admins and users`</span><span class="sxs-lookup"><span data-stu-id="fe6e9-157">Set **Who can consent?** to `Admins and users`</span></span>
8. <span data-ttu-id="fe6e9-158">Preencha os campos para configurar os prompts de consentimento de usuário e administrador com os valores que são apropriados para o `access_as_user` escopo:</span><span class="sxs-lookup"><span data-stu-id="fe6e9-158">Fill in the fields for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope:</span></span>
    * <span data-ttu-id="fe6e9-159">**Título do consentimento do administrador:** O Microsoft Teams pode acessar o perfil do usuário.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-159">**Admin consent title:** Teams can access the user’s profile.</span></span>
    * <span data-ttu-id="fe6e9-160">**Descrição do consentimento do administrador**: permite que o Teams chame as APIs Web do aplicativo como o usuário atual.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-160">**Admin consent description**: Allows Teams to call the app’s web APIs as the current user.</span></span>
    * <span data-ttu-id="fe6e9-161">**Título de consentimento do usuário**: o Teams pode acessar o perfil do usuário e fazer solicitações no nome do usuário.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-161">**User consent title**: Teams can access the user profile and make requests on the user's behalf.</span></span>
    * <span data-ttu-id="fe6e9-162">**Descrição do consentimento do usuário:** Habilite o Teams para chamar as APIs deste aplicativo com os mesmos direitos do usuário.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-162">**User consent description:** Enable Teams to call this app’s APIs with the same rights as the user.</span></span>
9. <span data-ttu-id="fe6e9-163">Verifique se o **estado** está definido como **habilitado**</span><span class="sxs-lookup"><span data-stu-id="fe6e9-163">Ensure that **State** is set to **Enabled**</span></span>
10. <span data-ttu-id="fe6e9-164">Selecionar **Adicionar escopo**</span><span class="sxs-lookup"><span data-stu-id="fe6e9-164">Select **Add scope**</span></span>
    * <span data-ttu-id="fe6e9-165">A parte de domínio do **nome do escopo** exibida logo abaixo do campo de texto deve coincidir automaticamente com o conjunto de URI da **ID do aplicativo** na etapa anterior, com `/access_as_user` acrescentado ao final:</span><span class="sxs-lookup"><span data-stu-id="fe6e9-165">The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID** URI set in the previous step, with `/access_as_user` appended to the end:</span></span>
        * `api://subdomain.example.com/00000000-0000-0000-0000-000000000000/access_as_user`
11. <span data-ttu-id="fe6e9-166">Na seção **aplicativos cliente autorizados** , identifique os aplicativos que você deseja autorizar para o aplicativo Web do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-166">In the **Authorized client applications** section, identify the applications that you want to authorize for your app’s web application.</span></span> <span data-ttu-id="fe6e9-167">Cada uma das seguintes IDs precisa ser inserida:</span><span class="sxs-lookup"><span data-stu-id="fe6e9-167">Each of the following IDs needs to be entered:</span></span>
    * <span data-ttu-id="fe6e9-168">`1fec8e78-bce4-4aaf-ab1b-5451cc387264`(Aplicativo móvel/aplicativo de área de trabalho do Microsoft Teams)</span><span class="sxs-lookup"><span data-stu-id="fe6e9-168">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Teams mobile/desktop application)</span></span>
    * <span data-ttu-id="fe6e9-169">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346`(Aplicativo Web do Teams)</span><span class="sxs-lookup"><span data-stu-id="fe6e9-169">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Teams web application)</span></span>
12. <span data-ttu-id="fe6e9-170">Navegue até **permissões de API**e certifique-se de adicionar as permissões a seguir:</span><span class="sxs-lookup"><span data-stu-id="fe6e9-170">Navigate to **API Permissions**, and make sure to add the follow permissions:</span></span>
    * <span data-ttu-id="fe6e9-171">User. Read (ativado por padrão)</span><span class="sxs-lookup"><span data-stu-id="fe6e9-171">User.Read (enabled by default)</span></span>
    * <span data-ttu-id="fe6e9-172">email</span><span class="sxs-lookup"><span data-stu-id="fe6e9-172">email</span></span>
    * <span data-ttu-id="fe6e9-173">offline_access</span><span class="sxs-lookup"><span data-stu-id="fe6e9-173">offline_access</span></span>
    * <span data-ttu-id="fe6e9-174">OpenId</span><span class="sxs-lookup"><span data-stu-id="fe6e9-174">OpenId</span></span>
    * <span data-ttu-id="fe6e9-175">perfil</span><span class="sxs-lookup"><span data-stu-id="fe6e9-175">profile</span></span>

> [!NOTE]
>
> * <span data-ttu-id="fe6e9-176">¹ se o seu aplicativo do Azure AD estiver registrado no _mesmo_ locatário em que você está fazendo uma solicitação de autenticação no Teams, o usuário não será solicitado a fazer o consentimento e receberá um token de acesso imediatamente.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-176">¹ If your Azure AD app is registered in the _same_ tenant where you're making an authentication request in Teams, the user won't be asked to consent and will be granted an access token right away.</span></span> <span data-ttu-id="fe6e9-177">Os usuários só precisam concordar com essas permissões se o aplicativo do Azure AD estiver registrado em um locatário diferente.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-177">Users only need to consent to these permissions if the Azure AD app is registered in a different tenant.</span></span>
> * <span data-ttu-id="fe6e9-178">² se você receber um erro informando que o domínio já pertence e você é o proprietário, siga o procedimento em [início rápido: Adicione um nome de domínio personalizado ao Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) para registrar o domínio e, em seguida, repita a etapa 5, acima.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-178">² If you get an error stating that the domain is already owned and you are the owner, follow the procedure at [Quickstart: Add a custom domain name to Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) to register the domain, and then repeat step 5, above.</span></span> <span data-ttu-id="fe6e9-179">(Esse erro também pode ocorrer se você não tiver entrado com credenciais de administrador no Office 365 locação).</span><span class="sxs-lookup"><span data-stu-id="fe6e9-179">(This error can also occur if you aren't signed in with Admin credentials in the Office 365 tenancy).</span></span>
> * <span data-ttu-id="fe6e9-180">Se você não estiver recebendo o UPN (nome principal do usuário) no token de acesso retornado, você poderá adicioná-lo como uma [declaração opcional](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-180">If you are not receiving the UPN (User Principal Name) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in Azure AD.</span></span>

### <a name="2-update-your-microsoft-teams-application-manifest"></a><span data-ttu-id="fe6e9-181">2. atualize seu manifesto de aplicativo do Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="fe6e9-181">2. Update your Microsoft Teams application manifest</span></span>

<span data-ttu-id="fe6e9-182">Adicione novas propriedades ao manifesto do Microsoft Teams:</span><span class="sxs-lookup"><span data-stu-id="fe6e9-182">Add new properties to your Microsoft Teams manifest:</span></span>

* <span data-ttu-id="fe6e9-183">**WebApplicationInfo** -o pai dos seguintes elementos:</span><span class="sxs-lookup"><span data-stu-id="fe6e9-183">**WebApplicationInfo** - The parent of the following elements:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="fe6e9-184">**ID** – a ID do cliente do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-184">**id** - The client ID of the application.</span></span> <span data-ttu-id="fe6e9-185">Esta é a ID do aplicativo que você obteve como parte do registro do aplicativo com o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-185">This is the application ID that you obtained as part of registering the application with Azure AD.</span></span>
>* <span data-ttu-id="fe6e9-186">**Resource** -o domínio e o subdomínio do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-186">**resource** - The domain and subdomain of your application.</span></span> <span data-ttu-id="fe6e9-187">Este é o mesmo URI (incluindo o `api://` protocolo) que você registrou ao criar seu `scope` na etapa 6 acima.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-187">This is the same URI (including the `api://` protocol) that you registered when creating your `scope` in step 6 above.</span></span> <span data-ttu-id="fe6e9-188">Você não deve incluir o `access_as_user` caminho em seu recurso.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-188">You shouldn't include the `access_as_user` path in your resource.</span></span> <span data-ttu-id="fe6e9-189">A parte de domínio desse URI deve corresponder ao domínio, incluindo todos os subdomínios, usados nas URLs do manifesto de aplicativo do Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-189">The domain part of this URI should match the domain, including any subdomains, used in the URLs of your Teams application manifest.</span></span>

```json
"webApplicationInfo": {
  "id": "00000000-0000-0000-0000-000000000000",
  "resource": "api://subdomain.example.com/00000000-0000-0000-0000-000000000000"
}
```

> [!NOTE]
>
>* <span data-ttu-id="fe6e9-190">O recurso para um aplicativo do AAD normalmente será a raiz da URL do site e a appID (por exemplo, `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` ).</span><span class="sxs-lookup"><span data-stu-id="fe6e9-190">The resource for an AAD app will usually be the root of its site URL and the appID (e.g. `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`).</span></span> <span data-ttu-id="fe6e9-191">Também utilizamos esse valor para garantir que sua solicitação seja proveniente do mesmo domínio.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-191">We also use this value to ensure your request is coming from the same domain.</span></span> <span data-ttu-id="fe6e9-192">Portanto, certifique-se de que o `contentURL` para sua guia usa os mesmos domínios de sua propriedade de recurso.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-192">Therefore, make sure that the `contentURL` for your tab uses the same domains as your resource property.</span></span>
>* <span data-ttu-id="fe6e9-193">Você precisa usar a versão 1,5 ou superior do manifesto para implementar o `webApplicationInfo` campo.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-193">You need to use manifest version 1.5 or higher to implement the `webApplicationInfo` field.</span></span>

### <a name="3-get-an-authentication-token-from-your-client-side-code"></a><span data-ttu-id="fe6e9-194">3. Obtenha um token de autenticação do seu código do lado do cliente</span><span class="sxs-lookup"><span data-stu-id="fe6e9-194">3. Get an authentication token from your client-side code</span></span>

<span data-ttu-id="fe6e9-195">Veja a aparência da API de autenticação:</span><span class="sxs-lookup"><span data-stu-id="fe6e9-195">Here's what the authentication API looks like:</span></span>

```javascript
var authTokenRequest = {
  successCallback: function(result) { console.log("Success: " + result); },
  failureCallback: function(error) { console.log("Failure: " + error); },
};
microsoftTeams.authentication.getAuthToken(authTokenRequest);
```

<span data-ttu-id="fe6e9-196">Quando você chama `getAuthToken` e o consentimento do usuário adicional é necessário (para permissões no nível do usuário), mostraremos uma caixa de diálogo para o usuário incentivando-o a conceder consentimento adicional.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-196">When you call `getAuthToken` - and additional user consent is required (for user-level permissions) - we will show a dialog to the user encouraging them to grant additional consent.</span></span> 

<span data-ttu-id="fe6e9-197">Depois de receber o token de acesso no retorno de chamada de êxito, você poderá decodificar o token de acesso para exibir as declarações associadas a esse token.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-197">Once you've received the access token in the success callback you can decode the access token to view the claims associated with that token.</span></span> <span data-ttu-id="fe6e9-198">(Opcionalmente, você pode copiar/colar manualmente o token de acesso em uma ferramenta como o [JWT.Io](https://jwt.io/) para inspecionar seu conteúdo).</span><span class="sxs-lookup"><span data-stu-id="fe6e9-198">(Optionally, you can manually copy/paste the access token into a tool such as [JWT.io](https://jwt.io/) to inspect its contents).</span></span> <span data-ttu-id="fe6e9-199">Se você não estiver recebendo o UPN (nome principal do usuário) no token de acesso retornado, você poderá adicioná-lo como uma [declaração opcional](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-199">If you are not receiving the UPN (User Principal Name) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in Azure AD.</span></span>

<p>
    <img src="~/assets/images/tabs/tabs-sso-prompt.png" alt="Tab single sign-on SSO dialog prompt" width="75%"/>
</p>

## <a name="sample-code"></a><span data-ttu-id="fe6e9-200">Código de exemplo</span><span class="sxs-lookup"><span data-stu-id="fe6e9-200">Sample code</span></span>

<span data-ttu-id="fe6e9-201">Visite nosso exemplo de aplicativo: [guias MSTeams de SSO de exemplo-NodeJS](https://github.com/OfficeDev/msteams-tabs-sso-sample-nodejs)</span><span class="sxs-lookup"><span data-stu-id="fe6e9-201">Visit our sample application: [MSTeams Tabs SSO Sample - Nodejs](https://github.com/OfficeDev/msteams-tabs-sso-sample-nodejs)</span></span>

<span data-ttu-id="fe6e9-202">O LEIAme explica como configurar seu ambiente de desenvolvimento e como configurar seu aplicativo no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-202">The README explains how to set up your development environment and how to configure your application in Azure AD.</span></span> <span data-ttu-id="fe6e9-203">Você também pode encontrar mais informações sobre como o exemplo é estruturado na [seção estrutura de aplicativos](https://github.com/OfficeDev/msteams-tabs-sso-sample-nodejs#app-structure) para ajudar a se familiarizar com a codebase.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-203">You can also find further information on how the sample is structured in the [app structure section](https://github.com/OfficeDev/msteams-tabs-sso-sample-nodejs#app-structure) to help familiarize yourself with the codebase.</span></span>

## <a name="known-limitations"></a><span data-ttu-id="fe6e9-204">Limitações conhecidas</span><span class="sxs-lookup"><span data-stu-id="fe6e9-204">Known Limitations</span></span>

### <a name="apps-that-require-additional-microsoft-graph-scopes"></a><span data-ttu-id="fe6e9-205">Aplicativos que exigem escopos adicionais do Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="fe6e9-205">Apps that require additional Microsoft Graph Scopes</span></span>

<span data-ttu-id="fe6e9-206">Nossa implementação atual do SSO concede consentimento apenas para permissões no nível do usuário — email, perfil, offline_access, OpenId, não para outras APIs (como User. Read ou mail. Read).</span><span class="sxs-lookup"><span data-stu-id="fe6e9-206">Our current implementation for SSO only grants consent for user-level permissions — email, profile, offline_access, OpenId — not for other APIs (such as User.Read or Mail.Read).</span></span> <span data-ttu-id="fe6e9-207">Se seu aplicativo precisar de mais escopos do Microsoft Graph, aqui estão algumas soluções habilitadas:</span><span class="sxs-lookup"><span data-stu-id="fe6e9-207">If your app needs further Microsoft Graph scopes, here are some enabling workarounds:</span></span>

#### <a name="tenant-admin-consent"></a><span data-ttu-id="fe6e9-208">Consentimento do administrador do locatário</span><span class="sxs-lookup"><span data-stu-id="fe6e9-208">Tenant Admin Consent</span></span>

<span data-ttu-id="fe6e9-209">A abordagem mais simples é obter um administrador de locatários para se concordar em nome da organização.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-209">The simplest approach is to get a tenant admin to pre-consent on behalf of the organization.</span></span> <span data-ttu-id="fe6e9-210">Isso significa que os usuários não terão que se concordar com esses escopos e você poderá, então, ser livre para trocar o lado do servidor de token usando o [fluxo em nome](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow)do AD do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-210">This means users won’t have to consent to these scopes and you can then be free to exchange the token server side using Azure AD’s [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow).</span></span> <span data-ttu-id="fe6e9-211">Essa solução alternativa é aceitável para aplicativos de linha de negócios internos, mas pode não ser suficiente para desenvolvedores terceirizados que podem não confiar na aprovação do administrador de locatários.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-211">This workaround is acceptable for internal line-of-business applications but may not be enough for third-party developers who may not be able to rely on tenant admin approval.</span></span>

<span data-ttu-id="fe6e9-212">Uma maneira simples de conenviar em nome de uma organização (como um administrador de locatários) é visitar:</span><span class="sxs-lookup"><span data-stu-id="fe6e9-212">A simple way of consenting on behalf of an organization (as a tenant admin) is to visit:</span></span>

* `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>`

#### <a name="asking-for-additional-consent-using-the-auth-api"></a><span data-ttu-id="fe6e9-213">Solicitar consentimento adicional usando a API de autenticação</span><span class="sxs-lookup"><span data-stu-id="fe6e9-213">Asking for additional consent using the Auth API</span></span>

<span data-ttu-id="fe6e9-214">Outra abordagem para obter escopos adicionais do Microsoft Graph é apresentar uma caixa de diálogo de consentimento usando nossa [abordagem existente de autenticação do Azure ad baseada na Web,](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) que envolve a apresentação de uma caixa de diálogo de consentimento do Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-214">Another approach for getting additional Microsoft Graph scopes is to present a consent dialog using our existing [web-based Azure AD authentication approach](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) which involves popping up an Azure AD consent dialog.</span></span> <span data-ttu-id="fe6e9-215">Há algumas adições notáveis:</span><span class="sxs-lookup"><span data-stu-id="fe6e9-215">There are some notable additions:</span></span>

1. <span data-ttu-id="fe6e9-216">O token recuperado usando `getAuthToken()` precisa ser trocado no servidor usando o [fluxo em nome do](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) Azure ad para obter acesso a essas APIs adicionais do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-216">The token retrieved using `getAuthToken()` needs to be exchanged server-side using Azure AD [on-behalf-of flow](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) to get access to those additional Microsoft Graph APIs.</span></span>
    * <span data-ttu-id="fe6e9-217">Certifique-se de usar o ponto de extremidade v2 do Microsoft Graph para esta troca</span><span class="sxs-lookup"><span data-stu-id="fe6e9-217">Be sure to use the v2 Microsoft Graph endpoint for this exchange</span></span>
2. <span data-ttu-id="fe6e9-218">Se o Exchange falhar, o Azure AD retornará uma exceção de concessão inválida.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-218">If the exchange fails, Azure AD will return an invalid grant exception.</span></span> <span data-ttu-id="fe6e9-219">Há geralmente uma de duas mensagens de erro: `invalid_grant` ou`interaction_required`</span><span class="sxs-lookup"><span data-stu-id="fe6e9-219">There are usually one of two error messages: `invalid_grant` or `interaction_required`</span></span>
3. <span data-ttu-id="fe6e9-220">Quando o Exchange falhar, você precisará solicitar o consentimento adicional.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-220">When the exchange fails, then you need to ask for additional consent.</span></span> <span data-ttu-id="fe6e9-221">Recomendamos que você mostre algumas interfaces de usuário solicitando que o usuário conceda um consentimento adicional.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-221">We recommend showing some UI asking the user to grant additional consent.</span></span> <span data-ttu-id="fe6e9-222">Esta interface do usuário deve incluir um botão que dispara uma caixa de diálogo de consentimento do Azure Active Directory usando nossa [API de autenticação do AD do Azure](~/concepts/authentication/auth-silent-aad.md).</span><span class="sxs-lookup"><span data-stu-id="fe6e9-222">This UI should include a button that triggers an Azure AD consent dialog using our [Azure AD authentication API](~/concepts/authentication/auth-silent-aad.md).</span></span>
4. <span data-ttu-id="fe6e9-223">Ao solicitar o consentimento adicional do Azure AD, você precisa incluir `prompt=consent` em seu [parâmetro de cadeia de caracteres de consulta](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) para o Azure ad caso contrário, o Azure ad não solicitará os escopos adicionais.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-223">When asking for additional consent from Azure AD, you need to include `prompt=consent` in your [query-string-parameter](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) to Azure AD otherwise Azure AD will not ask for the additional scopes.</span></span>
    * <span data-ttu-id="fe6e9-224">Em vez de:`?scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="fe6e9-224">Instead of: `?scope={scopes}`</span></span>
    * <span data-ttu-id="fe6e9-225">Use:`?prompt=consent&scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="fe6e9-225">Use this: `?prompt=consent&scope={scopes}`</span></span>
    * <span data-ttu-id="fe6e9-226">Certifique-se de `{scopes}` incluir todos os escopos para os quais você está solicitando o usuário (ex: mail. Read ou User. Read).</span><span class="sxs-lookup"><span data-stu-id="fe6e9-226">Be sure that `{scopes}` includes all the scopes you are prompting the user for (ex: Mail.Read or User.Read).</span></span>
5. <span data-ttu-id="fe6e9-227">Depois que o usuário tiver concedido permissão adicional, repita o em em nome de fluxo para obter acesso a essas APIs adicionais.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-227">Once the user has granted additional permission, retry the on-behalf-of-flow to get access to these additional APIs.</span></span>

### <a name="non-azure-ad-authentication"></a><span data-ttu-id="fe6e9-228">Autenticação não do Azure AD</span><span class="sxs-lookup"><span data-stu-id="fe6e9-228">Non-Azure AD Authentication</span></span>

<span data-ttu-id="fe6e9-229">A solução de autenticação descrita acima só funciona para aplicativos e serviços que dão suporte ao Azure AD como um provedor de identidade.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-229">The above-described authentication solution only works for apps and services that support Azure AD as an identity provider.</span></span> <span data-ttu-id="fe6e9-230">Os aplicativos que desejam autenticar usando serviços baseados no AD não-Azure precisam continuar usando o fluxo de [autenticação da Web](~/concepts/authentication.md)baseado em pop-up.</span><span class="sxs-lookup"><span data-stu-id="fe6e9-230">Apps that want to authenticate using non-Azure AD based services need to continue using the pop-up-based [web authentication flow](~/concepts/authentication.md).</span></span>
