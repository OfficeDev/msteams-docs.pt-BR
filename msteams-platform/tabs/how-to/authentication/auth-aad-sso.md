---
title: Suporte de login único para guias
description: Descreve o SSO (sign-on único)
ms.topic: how-to
keywords: api de login único do SSO AAD de autenticação do teams
ms.openlocfilehash: 7b8406473b8356b9c26948641b49f7e1239e697a
ms.sourcegitcommit: 5cb3453e918bec1173899e7591b48a48113cf8f0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/04/2021
ms.locfileid: "50449259"
---
# <a name="single-sign-on-sso-support-for-tabs"></a><span data-ttu-id="d8c4c-104">Suporte a SSO (login único) para guias</span><span class="sxs-lookup"><span data-stu-id="d8c4c-104">Single sign-on (SSO) support for tabs</span></span>

<span data-ttu-id="d8c4c-105">Os usuários entrar no Microsoft Teams por meio de suas contas de trabalho, escola ou Microsoft (Office 365, Outlook, etc.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-105">Users sign in to Microsoft Teams via their work, school, or Microsoft accounts (Office 365, Outlook, etc).</span></span> <span data-ttu-id="d8c4c-106">Você pode tirar proveito disso permitindo que um único login autorize sua guia do Microsoft Teams (ou módulo de tarefas) em clientes desktop ou móveis.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-106">You can take advantage of this by allowing a single sign-on to authorize your Microsoft Teams tab (or task module) on desktop or mobile clients.</span></span> <span data-ttu-id="d8c4c-107">Assim, se um usuário consentir em usar seu aplicativo, ele não terá que consentir novamente em outro dispositivo — ele será conectado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-107">Thus, if a user consents to use your app, they won’t have to consent again on another device — they will be signed in automatically.</span></span> <span data-ttu-id="d8c4c-108">Além disso, prefetchamos seu token de acesso para melhorar o desempenho e os tempos de carga.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-108">In addition, we prefetch your access token to improve performance and load times.</span></span>

> [!NOTE]
> <span data-ttu-id="d8c4c-109">**Versões do cliente móvel do Teams que suportam SSO**</span><span class="sxs-lookup"><span data-stu-id="d8c4c-109">**Teams mobile client versions supporting SSO**</span></span>  
>
> <span data-ttu-id="d8c4c-110">✔Teams para Android (1416/1.0.0.2020073101 e posterior)</span><span class="sxs-lookup"><span data-stu-id="d8c4c-110">✔Teams for Android (1416/1.0.0.2020073101 and later)</span></span>
>
> <span data-ttu-id="d8c4c-111">✔Teams para iOS (_Versão_: 2.0.18 e posterior)</span><span class="sxs-lookup"><span data-stu-id="d8c4c-111">✔Teams for iOS (_Version_: 2.0.18 and later)</span></span>  
>
> <span data-ttu-id="d8c4c-112">Para ter a melhor experiência com o Teams, use a versão mais recente do iOS e android.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-112">For the best experience with Teams, please use the latest version of iOS and Android.</span></span>

> [!NOTE]
> <span data-ttu-id="d8c4c-113">**Início rápido**</span><span class="sxs-lookup"><span data-stu-id="d8c4c-113">**Quickstart**</span></span>  
>
> <span data-ttu-id="d8c4c-114">O caminho mais simples para começar com a guia SSO é com o Microsoft Teams Toolkit para Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-114">The simplest path to getting started with tab SSO is with the Microsoft Teams Toolkit for Visual Studio Code.</span></span> [<span data-ttu-id="d8c4c-115">Saiba Mais</span><span class="sxs-lookup"><span data-stu-id="d8c4c-115">Learn more</span></span>](../../../toolkit/visual-studio-code-tab-sso.md)

## <a name="how-sso-works-at-runtime"></a><span data-ttu-id="d8c4c-116">Como o SSO funciona em tempo de execução</span><span class="sxs-lookup"><span data-stu-id="d8c4c-116">How SSO works at runtime</span></span>

<span data-ttu-id="d8c4c-117">O diagrama a seguir mostra como o processo de SSO funciona:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-117">The following diagram shows how the SSO process works:</span></span>

<!-- markdownlint-disable MD033 -->
<img src="~/assets/images/tabs/tabs-sso-diagram.png" alt="Tab single sign-on SSO diagram" width="75%"/>

1. <span data-ttu-id="d8c4c-118">Na guia, uma chamada JavaScript é feita para `getAuthToken()` .</span><span class="sxs-lookup"><span data-stu-id="d8c4c-118">In the tab, a JavaScript call is made to `getAuthToken()`.</span></span> <span data-ttu-id="d8c4c-119">Isso diz ao Teams para obter um token de autenticação para o aplicativo de tabulação.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-119">This tells Teams to obtain an authentication token for the tab application.</span></span>
2. <span data-ttu-id="d8c4c-120">Se essa for a primeira vez que o usuário atual usou seu aplicativo de tabulação, haverá um prompt de solicitação para consentimento (se o consentimento for necessário) ou para manipular a autenticação de etapa (como autenticação de dois fatores).</span><span class="sxs-lookup"><span data-stu-id="d8c4c-120">If this is the first time the current user has used your tab application, there will be a request prompt to consent (if consent is required) or to handle step-up authentication (such as two-factor authentication).</span></span>
3. <span data-ttu-id="d8c4c-121">O Teams solicita o token de aplicativo de tabulação do ponto de extremidade do Azure AD para o usuário atual.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-121">Teams requests the tab application token from the Azure AD endpoint for the current user.</span></span>
4. <span data-ttu-id="d8c4c-122">O Azure AD envia o token de aplicativo de tabulação para o aplicativo teams.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-122">Azure AD sends the tab application token to the Teams application.</span></span>
5. <span data-ttu-id="d8c4c-123">O Teams envia o token de aplicativo de tabulação para a guia como parte do objeto de resultado retornado pela `getAuthToken()` chamada.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-123">Teams sends the tab application token to the tab as part of the result object returned by the `getAuthToken()` call.</span></span>
6. <span data-ttu-id="d8c4c-124">O token será analisado no aplicativo de tabulação, via JavaScript, para extrair as informações necessárias, como o endereço de email do usuário.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-124">The token will be parsed in the tab application, via JavaScript, to extract the needed information, such as the user's email address.</span></span>

> [!NOTE]
> <span data-ttu-id="d8c4c-125">O é válido apenas para consentir um conjunto limitado de APIs no nível do usuário — email, perfil, offline_access e OpenId — e não para escopos do Microsoft Graph como `getAuthToken()` `User.Read` ou `Mail.Read` .</span><span class="sxs-lookup"><span data-stu-id="d8c4c-125">The `getAuthToken()` is only valid for consenting to a limited set of user-level APIs — email, profile, offline_access and OpenId — and not for further Microsoft Graph scopes such as `User.Read` or `Mail.Read`.</span></span> <span data-ttu-id="d8c4c-126">Consulte nossa seção no final deste documento para obter soluções alternativas sugeridas se você precisar de [escopos adicionais do Graph.](#apps-that-require-additional-microsoft-graph-scopes)</span><span class="sxs-lookup"><span data-stu-id="d8c4c-126">See our section at the end of this document for suggested workarounds if you require [additional Graph scopes](#apps-that-require-additional-microsoft-graph-scopes).</span></span>

<span data-ttu-id="d8c4c-127">A API do SSO também funcionará em [Módulos de Tarefas](../../../task-modules-and-cards/what-are-task-modules.md) que incorporam conteúdo da Web.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-127">The SSO API will also work in [Task Modules](../../../task-modules-and-cards/what-are-task-modules.md) that embed web content.</span></span>

## <a name="develop-an-sso-microsoft-teams-tab"></a><span data-ttu-id="d8c4c-128">Desenvolver uma guia SSO do Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="d8c4c-128">Develop an SSO Microsoft Teams tab</span></span>

<span data-ttu-id="d8c4c-129">Esta seção descreve as tarefas envolvidas na criação de uma guia do Teams que usa SSO.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-129">This section describes the tasks involved in creating a Teams tab that uses SSO.</span></span> <span data-ttu-id="d8c4c-130">Essas tarefas são descritas aqui como idioma e framework-agnóstico.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-130">These tasks are described here are language- and framework-agnostic.</span></span>

### <a name="1-create-your-azure-active-directory-azure-ad-application"></a><span data-ttu-id="d8c4c-131">1. Crie seu aplicativo do Azure Active Directory (Azure AD)</span><span class="sxs-lookup"><span data-stu-id="d8c4c-131">1. Create your Azure Active Directory (Azure AD) application</span></span>

#### <a name="registering-your-application-in-theazure-ad-portal-overview"></a><span data-ttu-id="d8c4c-132">Registrar seu aplicativo na visão geral[do portal do Azure AD:](https://azure.microsoft.com/features/azure-portal/)</span><span class="sxs-lookup"><span data-stu-id="d8c4c-132">Registering your application in the[Azure AD portal](https://azure.microsoft.com/features/azure-portal/) overview:</span></span>

1. <span data-ttu-id="d8c4c-133">Obter a ID do aplicativo [do Azure AD.](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in)</span><span class="sxs-lookup"><span data-stu-id="d8c4c-133">Get your [Azure AD Application ID](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in).</span></span>
2. <span data-ttu-id="d8c4c-134">Especifique as permissões que seu aplicativo precisa para o ponto de extremidade do Azure AD e, opcionalmente, o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-134">Specify the permissions that your application needs for the Azure AD endpoint and, optionally, Microsoft Graph.</span></span>
3. <span data-ttu-id="d8c4c-135">[Conceda permissões](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) para aplicativos desktop, web e móveis do Teams.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-135">[Grant permissions](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) for Teams desktop, web, and mobile applications.</span></span>
4. <span data-ttu-id="d8c4c-136">Pré-autorizar o Teams selecionando **o botão Adicionar um escopo** e, no painel que é aberto, digite como o nome do `access_as_user` **escopo**.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-136">Pre-authorize Teams by selecting the **Add a scope** button and in the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>

> [!NOTE]
> <span data-ttu-id="d8c4c-137">Há algumas restrições importantes que você deve estar ciente:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-137">There are some important restrictions you should be aware of:</span></span>
>
> * <span data-ttu-id="d8c4c-138">Só suportamos permissões de API do Microsoft Graph no nível do usuário, ou seja, email, perfil, offline_access, OpenId.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-138">We only support user-level Microsoft Graph API permissions, i.e., email, profile, offline_access, OpenId.</span></span> <span data-ttu-id="d8c4c-139">Se você precisar de acesso a outros escopos do Microsoft Graph (como ou ), consulte nossa solução alternativa recomendada no `User.Read` `Mail.Read` final desta documentação. [](#apps-that-require-additional-microsoft-graph-scopes)</span><span class="sxs-lookup"><span data-stu-id="d8c4c-139">If you need access to other Microsoft Graph scopes (such as `User.Read` or `Mail.Read`), see our [recommended workaround](#apps-that-require-additional-microsoft-graph-scopes) at the end of this documentation.</span></span>
> * <span data-ttu-id="d8c4c-140">É importante que o nome de domínio do aplicativo seja o mesmo que o nome de domínio que você registrou no aplicativo do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-140">It's important that your application's domain name is the same as the domain name you've registering for your Azure AD application.</span></span>
> * <span data-ttu-id="d8c4c-141">Atualmente, não há suporte para vários domínios por aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-141">We don't currently support multiple domains per app.</span></span>
> * <span data-ttu-id="d8c4c-142">Não suportamos aplicativos que usam o `azurewebsites.net` domínio porque ele é muito comum e pode ser um risco de segurança.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-142">We don't support applications that use the `azurewebsites.net` domain because it is too common and may be a security risk.</span></span> <span data-ttu-id="d8c4c-143">No entanto, estamos procurando ativamente remover essa restrição.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-143">However, we're actively seeking to remove this restriction.</span></span>

#### <a name="registering-your-app-through-the-azure-active-directory-portal-in-depth"></a><span data-ttu-id="d8c4c-144">Registrar seu aplicativo por meio do portal do Azure Active Directory detalhadamente:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-144">Registering your app through the Azure Active Directory portal in-depth:</span></span>

1. <span data-ttu-id="d8c4c-145">Registre um novo aplicativo no [portal do Azure Active Directory – Registros de Aplicativos.](https://go.microsoft.com/fwlink/?linkid=2083908)</span><span class="sxs-lookup"><span data-stu-id="d8c4c-145">Register a new application in the [Azure Active Directory – App Registrations](https://go.microsoft.com/fwlink/?linkid=2083908) portal.</span></span>
2. <span data-ttu-id="d8c4c-146">Selecione **Novo Registro** e, na página registrar um *aplicativo,* de definir os seguintes valores:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-146">Select **New Registration** and on the *register an application page*, set following values:</span></span>
    * <span data-ttu-id="d8c4c-147">De **definir o** nome do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-147">Set **name** to your app name.</span></span>
    * <span data-ttu-id="d8c4c-148">Escolha os **tipos de conta com** suporte (qualquer tipo de conta funcionará) ¹</span><span class="sxs-lookup"><span data-stu-id="d8c4c-148">Choose the **supported account types** (any account type will work) ¹</span></span>
    * <span data-ttu-id="d8c4c-149">Deixe o **URI de Redirecionamento** vazio.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-149">Leave **Redirect URI** empty.</span></span>
    * <span data-ttu-id="d8c4c-150">Escolha **Registrar**.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-150">Choose **Register**.</span></span>
3. <span data-ttu-id="d8c4c-151">Na página visão geral, copie e salve a **ID do aplicativo (cliente).**</span><span class="sxs-lookup"><span data-stu-id="d8c4c-151">On the overview page, copy and save the **Application (client) ID**.</span></span> <span data-ttu-id="d8c4c-152">Você precisará dele mais tarde ao atualizar o manifesto do aplicativo do Teams.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-152">You’ll need it later when updating your Teams application manifest.</span></span>
4. <span data-ttu-id="d8c4c-153">Em **Gerenciar**, selecione **Expor uma API**.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-153">Under **Manage**, select **Expose an API**.</span></span> 
5. <span data-ttu-id="d8c4c-154">Selecione o link **Definir** para gerar o URI de ID do Aplicativo no formato `api://{AppID}` de .</span><span class="sxs-lookup"><span data-stu-id="d8c4c-154">Select the **Set** link to generate the Application ID URI in the form of `api://{AppID}`.</span></span> <span data-ttu-id="d8c4c-155">Insira seu nome de domínio totalmente qualificado (com uma barra de avanço "/" anexada ao final) entre as barras de avanço duplo e o GUID.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-155">Insert your fully qualified domain name (with a forward slash "/" appended to the end) between the double forward slashes and the GUID.</span></span> <span data-ttu-id="d8c4c-156">A ID inteira deve ter a forma de: `api://fully-qualified-domain-name.com/{AppID}` ²</span><span class="sxs-lookup"><span data-stu-id="d8c4c-156">The entire ID should have the form of: `api://fully-qualified-domain-name.com/{AppID}` ²</span></span>
    * <span data-ttu-id="d8c4c-157">ex: `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` .</span><span class="sxs-lookup"><span data-stu-id="d8c4c-157">ex: `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`.</span></span>
    
    <span data-ttu-id="d8c4c-158">O nome de domínio totalmente qualificado é o nome de domínio acessível para humanos a partir do qual seu aplicativo é servido.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-158">The fully qualified domain name is the human readable domain name from which your app is served.</span></span> <span data-ttu-id="d8c4c-159">Se você estiver usando um serviço de tunelamento como ngrok, precisará atualizar esse valor sempre que o subdomínio ngrok mudar.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-159">If you are using a tunneling service such as ngrok, you will need to update     this value whenever your ngrok subdomain changes.</span></span> 
6. <span data-ttu-id="d8c4c-160">Selecione o botão **Adicionar um escopo**.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-160">Select the **Add a scope** button.</span></span> <span data-ttu-id="d8c4c-161">No painel que se abre, insira `access_as_user` como o **Nome de escopo**.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-161">In the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>
7. <span data-ttu-id="d8c4c-162">Definir **Quem pode consentir?**`Admins and users`</span><span class="sxs-lookup"><span data-stu-id="d8c4c-162">Set **Who can consent?** to `Admins and users`</span></span>
8. <span data-ttu-id="d8c4c-163">Preencha os campos para configurar os prompts de consentimento do administrador e do usuário com valores apropriados para o `access_as_user` escopo:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-163">Fill in the fields for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope:</span></span>
    * <span data-ttu-id="d8c4c-164">**Título de consentimento do administrador:** O Teams pode acessar o perfil do usuário.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-164">**Admin consent title:** Teams can access the user’s profile.</span></span>
    * <span data-ttu-id="d8c4c-165">**Descrição do** consentimento do administrador : Permite que o Teams chame as APIs da Web do aplicativo como o usuário atual.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-165">**Admin consent description**: Allows Teams to call the app’s web APIs as the current user.</span></span>
    * <span data-ttu-id="d8c4c-166">**Título de consentimento do** usuário : o Teams pode acessar o perfil de usuário e fazer solicitações em nome do usuário.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-166">**User consent title**: Teams can access the user profile and make requests on the user's behalf.</span></span>
    * <span data-ttu-id="d8c4c-167">**Descrição do consentimento do usuário:** Habilita o Teams a chamar as APIs desse aplicativo com os mesmos direitos do usuário.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-167">**User consent description:** Enable Teams to call this app’s APIs with the same rights as the user.</span></span>
9. <span data-ttu-id="d8c4c-168">Verifique se **o estado** está definido como **Habilitado**</span><span class="sxs-lookup"><span data-stu-id="d8c4c-168">Ensure that **State** is set to **Enabled**</span></span>
10. <span data-ttu-id="d8c4c-169">Selecione o **botão Adicionar escopo** para salvar</span><span class="sxs-lookup"><span data-stu-id="d8c4c-169">Select the **Add scope** button to save</span></span> 
    * <span data-ttu-id="d8c4c-170">A parte de domínio do nome **escopo** exibida logo abaixo do campo de texto deve corresponder automaticamente ao conjunto de URI de **ID** do aplicativo na etapa anterior, com anexado `/access_as_user` ao final:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-170">The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID** URI set in the previous step, with `/access_as_user` appended to the end:</span></span>
        * `api://subdomain.example.com/00000000-0000-0000-0000-000000000000/access_as_user`
11. <span data-ttu-id="d8c4c-171">Na seção **Aplicativos cliente autorizados,** identifique os aplicativos que você deseja autorizar para o aplicativo Web do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-171">In the **Authorized client applications** section, identify the applications that you want to authorize for your app’s web application.</span></span> <span data-ttu-id="d8c4c-172">Selecione *Adicionar um aplicativo cliente*.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-172">Select *Add a client application*.</span></span> <span data-ttu-id="d8c4c-173">Insira cada uma das seguintes IDs de cliente e selecione o escopo autorizado criado na etapa anterior:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-173">Enter each of the following client IDs and select the authorized scope you created in the previous step:</span></span>
    * <span data-ttu-id="d8c4c-174">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Aplicativo móvel/desktop do Teams)</span><span class="sxs-lookup"><span data-stu-id="d8c4c-174">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Teams mobile/desktop application)</span></span>
    * <span data-ttu-id="d8c4c-175">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Aplicativo Web do Teams)</span><span class="sxs-lookup"><span data-stu-id="d8c4c-175">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Teams web application)</span></span>
12. <span data-ttu-id="d8c4c-176">Navegue até **Permissões de API**.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-176">Navigate to **API Permissions**.</span></span> <span data-ttu-id="d8c4c-177">Selecione *Adicionar uma permissão permissões* Delegadas do Microsoft Graph e adicione as seguintes permissões da API do Microsoft  >    >  Graph:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-177">Select *Add a permission* > *Microsoft Graph* > *Delegated permissions*, then add the following permissions from Microsoft Graph API:</span></span>
    * <span data-ttu-id="d8c4c-178">User.Read (habilitado por padrão)</span><span class="sxs-lookup"><span data-stu-id="d8c4c-178">User.Read (enabled by default)</span></span>
    * <span data-ttu-id="d8c4c-179">email</span><span class="sxs-lookup"><span data-stu-id="d8c4c-179">email</span></span>
    * <span data-ttu-id="d8c4c-180">offline_access</span><span class="sxs-lookup"><span data-stu-id="d8c4c-180">offline_access</span></span>
    * <span data-ttu-id="d8c4c-181">OpenId</span><span class="sxs-lookup"><span data-stu-id="d8c4c-181">OpenId</span></span>
    * <span data-ttu-id="d8c4c-182">perfil</span><span class="sxs-lookup"><span data-stu-id="d8c4c-182">profile</span></span>

13. <span data-ttu-id="d8c4c-183">Navegue até **Autenticação**</span><span class="sxs-lookup"><span data-stu-id="d8c4c-183">Navigate to **Authentication**</span></span>

    <span data-ttu-id="d8c4c-184">Se um aplicativo não tiver sido concedido o consentimento do administrador de IT, os usuários terão que fornecer consentimento na primeira vez que usarem um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-184">If an app hasn't been granted IT admin consent, users will have to provide consent the first time they use an app.</span></span>

    <span data-ttu-id="d8c4c-185">Definir um URI de redirecionamento:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-185">Set a redirect URI:</span></span>
    * <span data-ttu-id="d8c4c-186">Selecione **Adicionar uma plataforma**.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-186">Select **Add a platform**.</span></span>
    * <span data-ttu-id="d8c4c-187">Selecione **Web**.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-187">Select **web**.</span></span>
    * <span data-ttu-id="d8c4c-188">Insira o **URI de redirecionamento** para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-188">Enter the **redirect URI** for your app.</span></span> <span data-ttu-id="d8c4c-189">Esta será a página onde um fluxo de concessão implícito bem-sucedido redireciona o usuário.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-189">This will be the page where a successful implicit grant flow will redirect the user.</span></span> <span data-ttu-id="d8c4c-190">Esse será o mesmo nome de domínio totalmente qualificado que você entrou na etapa 5 seguido pela rota da API para a qual uma resposta de autenticação deve ser enviada.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-190">This will be same fully qualified domain name that you entered in step 5 followed by the API route where a authentication response should be sent.</span></span> <span data-ttu-id="d8c4c-191">Se você estiver seguindo qualquer um dos exemplos do Teams, isso será: `https://subdomain.example.com/auth-end`</span><span class="sxs-lookup"><span data-stu-id="d8c4c-191">If you are following any of the Teams samples, this will be: `https://subdomain.example.com/auth-end`</span></span>

    <span data-ttu-id="d8c4c-192">Em seguida, habilita a concessão implícita verificando as seguintes caixas:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-192">Next, enable implicit grant by checking the following boxes:</span></span>  
    <span data-ttu-id="d8c4c-193">✔ token de ID</span><span class="sxs-lookup"><span data-stu-id="d8c4c-193">✔ ID Token</span></span>  
    <span data-ttu-id="d8c4c-194">✔ Token de Acesso</span><span class="sxs-lookup"><span data-stu-id="d8c4c-194">✔ Access Token</span></span>  
    
<span data-ttu-id="d8c4c-195">Parabéns!</span><span class="sxs-lookup"><span data-stu-id="d8c4c-195">Congratulations!</span></span> <span data-ttu-id="d8c4c-196">Você concluiu os pré-requisitos de registro do aplicativo para continuar com seu aplicativo SSO de guia.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-196">You have completed the app registration prerequisites to proceed with your tab SSO app.</span></span>     

> [!NOTE]
>
> * <span data-ttu-id="d8c4c-197">¹ Se seu aplicativo do Azure  AD estiver registrado no mesmo locatário em que você está fazendo uma solicitação de autenticação no Teams, o usuário não será solicitado a consentir e receberá um token de acesso imediatamente.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-197">¹ If your Azure AD app is registered in the _same_ tenant where you're making an authentication request in Teams, the user won't be asked to consent and will be granted an access token right away.</span></span> <span data-ttu-id="d8c4c-198">Os usuários só precisarão consentir com essas permissões se o aplicativo do Azure AD estiver registrado em um locatário diferente.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-198">Users only need to consent to these permissions if the Azure AD app is registered in a different tenant.</span></span>
> * <span data-ttu-id="d8c4c-199">² Se você receber um erro informando que o domínio já pertence e você é o proprietário, siga o procedimento em Início Rápido: Adicione um nome de domínio personalizado ao [Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) para registrar o domínio e repita a etapa 5, acima.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-199">² If you get an error stating that the domain is already owned and you are the owner, follow the procedure at [Quickstart: Add a custom domain name to Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) to register the domain, and then repeat step 5, above.</span></span> <span data-ttu-id="d8c4c-200">(Esse erro também pode ocorrer se você não estiver assinado com credenciais de administrador no escritório do Office 365).</span><span class="sxs-lookup"><span data-stu-id="d8c4c-200">(This error can also occur if you aren't signed in with Admin credentials in the Office 365 tenancy).</span></span>
> * <span data-ttu-id="d8c4c-201">Se você não estiver recebendo o UPN (Nome principal do usuário) no token de acesso retornado, poderá adicioná-lo como uma declaração [opcional](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-201">If you are not receiving the UPN (User Principal Name) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in Azure AD.</span></span>

### <a name="2-update-your-microsoft-teams-application-manifest"></a><span data-ttu-id="d8c4c-202">2. Atualizar seu manifesto de aplicativo do Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="d8c4c-202">2. Update your Microsoft Teams application manifest</span></span>

<span data-ttu-id="d8c4c-203">Adicione novas propriedades ao manifesto do Microsoft Teams:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-203">Add new properties to your Microsoft Teams manifest:</span></span>

* <span data-ttu-id="d8c4c-204">**WebApplicationInfo** - O pai dos seguintes elementos:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-204">**WebApplicationInfo** - The parent of the following elements:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="d8c4c-205">**id** - A ID do cliente do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-205">**id** - The client ID of the application.</span></span> <span data-ttu-id="d8c4c-206">Esta é a ID do aplicativo que você obteve como parte do registro do aplicativo no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-206">This is the application ID that you obtained as part of registering the application with Azure AD.</span></span>
>* <span data-ttu-id="d8c4c-207">**resource** - O domínio e o subdomínio do seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-207">**resource** - The domain and subdomain of your application.</span></span> <span data-ttu-id="d8c4c-208">Esse é o mesmo URI (incluindo o protocolo) que você registrou `api://` ao criar seu na etapa `scope` 6 acima.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-208">This is the same URI (including the `api://` protocol) that you registered when creating your `scope` in step 6 above.</span></span> <span data-ttu-id="d8c4c-209">Você não deve incluir o `access_as_user` caminho em seu recurso.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-209">You shouldn't include the `access_as_user` path in your resource.</span></span> <span data-ttu-id="d8c4c-210">A parte de domínio desse URI deve corresponder ao domínio, incluindo quaisquer subdomas, usados nas URLs do manifesto do aplicativo teams.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-210">The domain part of this URI should match the domain, including any subdomains, used in the URLs of your Teams application manifest.</span></span>

```json
"webApplicationInfo": {
  "id": "00000000-0000-0000-0000-000000000000",
  "resource": "api://subdomain.example.com/00000000-0000-0000-0000-000000000000"
}
```

> [!NOTE]
>
>* <span data-ttu-id="d8c4c-211">O recurso para um aplicativo AAD geralmente será a raiz de sua URL de site e o appID (por `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` exemplo, ).</span><span class="sxs-lookup"><span data-stu-id="d8c4c-211">The resource for an AAD app will usually be the root of its site URL and the appID (e.g. `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`).</span></span> <span data-ttu-id="d8c4c-212">Também usamos esse valor para garantir que sua solicitação seja proveniente do mesmo domínio.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-212">We also use this value to ensure your request is coming from the same domain.</span></span> <span data-ttu-id="d8c4c-213">Portanto, certifique-se de que `contentURL` a guia para sua guia use os mesmos domínios que sua propriedade resource.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-213">Therefore, make sure that the `contentURL` for your tab uses the same domains as your resource property.</span></span>
>* <span data-ttu-id="d8c4c-214">Você precisa usar o manifesto versão 1.5 ou superior para implementar o `webApplicationInfo` campo.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-214">You need to use manifest version 1.5 or higher to implement the `webApplicationInfo` field.</span></span>

### <a name="3-get-an-authentication-token-from-your-client-side-code"></a><span data-ttu-id="d8c4c-215">3. Obter um token de autenticação do código do lado do cliente</span><span class="sxs-lookup"><span data-stu-id="d8c4c-215">3. Get an authentication token from your client-side code</span></span>

<span data-ttu-id="d8c4c-216">Veja a aparência da API de autenticação:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-216">Here's what the authentication API looks like:</span></span>

```javascript
var authTokenRequest = {
  successCallback: function(result) { console.log("Success: " + result); },
  failureCallback: function(error) { console.log("Failure: " + error); }
};
microsoftTeams.authentication.getAuthToken(authTokenRequest);
```

<span data-ttu-id="d8c4c-217">Quando você chamar - e o consentimento adicional do usuário for necessário (para permissões no nível do usuário) - mostraremos uma caixa de diálogo para o usuário incentivando-o `getAuthToken` a conceder consentimento adicional.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-217">When you call `getAuthToken` - and additional user consent is required (for user-level permissions) - we will show a dialog to the user encouraging them to grant additional consent.</span></span> 

<span data-ttu-id="d8c4c-218">Depois de receber o token de acesso no retorno de chamada de sucesso, você pode decodificar o token de acesso para exibir as declarações associadas a esse token.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-218">After you receive the access token in the success callback, you can decode the access token to view the claims associated with that token.</span></span> <span data-ttu-id="d8c4c-219">Opcionalmente, você pode copiar e colar manualmente o token de acesso em uma ferramenta, como jwt.ms [inspecionar](https://jwt.ms/) seu conteúdo.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-219">Optionally, you can manually copy and paste the access token into a tool, such as [jwt.ms](https://jwt.ms/) to inspect its contents.</span></span> <span data-ttu-id="d8c4c-220">Se você não estiver recebendo o Nome da Entidade de Usuário (UPN) no token de acesso retornado, poderá adicioná-lo como uma declaração [opcional](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) no Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-220">If you are not receiving the User Principal Name (UPN) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in Azure AD.</span></span>

<p>
    <img src="~/assets/images/tabs/tabs-sso-prompt.png" alt="Tab single sign-on SSO dialog prompt" width="75%"/>
</p>

## <a name="code-sample"></a><span data-ttu-id="d8c4c-221">Exemplo de código</span><span class="sxs-lookup"><span data-stu-id="d8c4c-221">Code sample</span></span>

|<span data-ttu-id="d8c4c-222">**Exemplo de nome**</span><span class="sxs-lookup"><span data-stu-id="d8c4c-222">**Sample name**</span></span>|<span data-ttu-id="d8c4c-223">**Descrição**</span><span class="sxs-lookup"><span data-stu-id="d8c4c-223">**Description**</span></span>|<span data-ttu-id="d8c4c-224">**C#**</span><span class="sxs-lookup"><span data-stu-id="d8c4c-224">**C#**</span></span>|<span data-ttu-id="d8c4c-225">**TypeScript**</span><span class="sxs-lookup"><span data-stu-id="d8c4c-225">**TypeScript**</span></span>|
|---------------|---------------|------|--------------|
| <span data-ttu-id="d8c4c-226">Guia SSO</span><span class="sxs-lookup"><span data-stu-id="d8c4c-226">Tab SSO</span></span> |<span data-ttu-id="d8c4c-227">Aplicativo de exemplo do Microsoft Teams para guias do Azure AD SSO</span><span class="sxs-lookup"><span data-stu-id="d8c4c-227">Microsoft Teams sample app for tabs Azure AD SSO</span></span>| [<span data-ttu-id="d8c4c-228">View</span><span class="sxs-lookup"><span data-stu-id="d8c4c-228">View</span></span>](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/tab-sso/csharp)|<span data-ttu-id="d8c4c-229">[Exibir](https://github.com/OfficeDev/Microsoft-Teams-Samples/blob/main/samples/tab-sso/nodejs),</span><span class="sxs-lookup"><span data-stu-id="d8c4c-229">[View](https://github.com/OfficeDev/Microsoft-Teams-Samples/blob/main/samples/tab-sso/nodejs),</span></span> </br>[<span data-ttu-id="d8c4c-230">Teams Toolkit</span><span class="sxs-lookup"><span data-stu-id="d8c4c-230">Teams Toolkit</span></span>](../../../toolkit/visual-studio-code-tab-sso.md)|

## <a name="known-limitations"></a><span data-ttu-id="d8c4c-231">Limitações conhecidas</span><span class="sxs-lookup"><span data-stu-id="d8c4c-231">Known Limitations</span></span>

### <a name="apps-that-require-additional-microsoft-graph-scopes"></a><span data-ttu-id="d8c4c-232">Aplicativos que exigem escopos adicionais do Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="d8c4c-232">Apps that require additional Microsoft Graph Scopes</span></span>

<span data-ttu-id="d8c4c-233">Nossa implementação atual para o SSO concede consentimento apenas para permissões no nível do usuário — email, perfil, offline_access, OpenId — e não para outras APIs (como User.Read ou Mail.Read).</span><span class="sxs-lookup"><span data-stu-id="d8c4c-233">Our current implementation for SSO only grants consent for user-level permissions — email, profile, offline_access, OpenId — not for other APIs (such as User.Read or Mail.Read).</span></span> <span data-ttu-id="d8c4c-234">Se seu aplicativo precisar de mais escopos do Microsoft Graph, aqui estão algumas soluções alternativas de habilitação:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-234">If your app needs further Microsoft Graph scopes, here are some enabling workarounds:</span></span>

#### <a name="tenant-admin-consent"></a><span data-ttu-id="d8c4c-235">Consentimento do administrador do locatário</span><span class="sxs-lookup"><span data-stu-id="d8c4c-235">Tenant Admin Consent</span></span>

<span data-ttu-id="d8c4c-236">A abordagem mais simples é fazer com que um administrador de locatários consenta previamente em nome da organização.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-236">The simplest approach is to get a tenant admin to pre-consent on behalf of the organization.</span></span> <span data-ttu-id="d8c4c-237">Isso significa que os usuários não terão que consentir com esses escopos e você poderá ser livre para trocar o lado do servidor de token usando o fluxo [on-behalf-of](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow)do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-237">This means users won’t have to consent to these scopes and you can then be free to exchange the token server side using Azure AD’s [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow).</span></span> <span data-ttu-id="d8c4c-238">Essa solução alternativa é aceitável para aplicativos internos de linha de negócios, mas pode não ser suficiente para desenvolvedores de terceiros que talvez não possam depender da aprovação do administrador de locatários.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-238">This workaround is acceptable for internal line-of-business applications but may not be enough for third-party developers who may not be able to rely on tenant admin approval.</span></span>

<span data-ttu-id="d8c4c-239">Uma maneira simples de consentir em nome de uma organização (como administrador de locatário) é visitar:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-239">A simple way of consenting on behalf of an organization (as a tenant admin) is to visit:</span></span>

* `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>`

#### <a name="asking-for-additional-consent-using-the-auth-api"></a><span data-ttu-id="d8c4c-240">Solicitando consentimento adicional usando a API Auth</span><span class="sxs-lookup"><span data-stu-id="d8c4c-240">Asking for additional consent using the Auth API</span></span>

<span data-ttu-id="d8c4c-241">Outra abordagem para obter escopos adicionais do Microsoft Graph é apresentar uma caixa de diálogo de consentimento usando nossa abordagem de autenticação do [Azure AD](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) baseada na Web existente que envolve a aparecendo uma caixa de diálogo de consentimento do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-241">Another approach for getting additional Microsoft Graph scopes is to present a consent dialog using our existing [web-based Azure AD authentication approach](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) which involves popping up an Azure AD consent dialog.</span></span> <span data-ttu-id="d8c4c-242">Há algumas adições notáveis:</span><span class="sxs-lookup"><span data-stu-id="d8c4c-242">There are some notable additions:</span></span>

1. <span data-ttu-id="d8c4c-243">O token recuperado usando precisa ser trocado no lado do servidor usando o fluxo em nome do Azure AD para obter acesso a essas `getAuthToken()` APIs adicionais do [](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-243">The token retrieved using `getAuthToken()` needs to be exchanged server-side using Azure AD [on-behalf-of flow](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) to get access to those additional Microsoft Graph APIs.</span></span>
    * <span data-ttu-id="d8c4c-244">Certifique-se de usar o ponto de extremidade do Microsoft Graph v2 para este exchange</span><span class="sxs-lookup"><span data-stu-id="d8c4c-244">Be sure to use the v2 Microsoft Graph endpoint for this exchange</span></span>
2. <span data-ttu-id="d8c4c-245">Se a troca falhar, o Azure AD retornará uma exceção de concessão inválida.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-245">If the exchange fails, Azure AD will return an invalid grant exception.</span></span> <span data-ttu-id="d8c4c-246">Geralmente, há uma das duas mensagens de erro: `invalid_grant` ou `interaction_required`</span><span class="sxs-lookup"><span data-stu-id="d8c4c-246">There are usually one of two error messages: `invalid_grant` or `interaction_required`</span></span>
3. <span data-ttu-id="d8c4c-247">Quando a troca falhar, você precisará solicitar consentimento adicional.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-247">When the exchange fails, then you need to ask for additional consent.</span></span> <span data-ttu-id="d8c4c-248">Recomendamos mostrar alguma interface do usuário solicitando que o usuário conceda consentimento adicional.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-248">We recommend showing some UI asking the user to grant additional consent.</span></span> <span data-ttu-id="d8c4c-249">Essa interface do usuário deve incluir um botão que dispara uma caixa de diálogo de consentimento do Azure AD usando nossa API de autenticação [do Azure AD.](~/concepts/authentication/auth-silent-aad.md)</span><span class="sxs-lookup"><span data-stu-id="d8c4c-249">This UI should include a button that triggers an Azure AD consent dialog using our [Azure AD authentication API](~/concepts/authentication/auth-silent-aad.md).</span></span>
4. <span data-ttu-id="d8c4c-250">Ao solicitar consentimento adicional do Azure AD, você precisa incluir no parâmetro de cadeia de caracteres de consulta para o Azure AD caso contrário, o Azure AD não solicitará os `prompt=consent` escopos adicionais. [](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context)</span><span class="sxs-lookup"><span data-stu-id="d8c4c-250">When asking for additional consent from Azure AD, you need to include `prompt=consent` in your [query-string-parameter](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) to Azure AD otherwise Azure AD will not ask for the additional scopes.</span></span>
    * <span data-ttu-id="d8c4c-251">Em vez de: `?scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="d8c4c-251">Instead of: `?scope={scopes}`</span></span>
    * <span data-ttu-id="d8c4c-252">Use isso: `?prompt=consent&scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="d8c4c-252">Use this: `?prompt=consent&scope={scopes}`</span></span>
    * <span data-ttu-id="d8c4c-253">Certifique-se de que isso inclua todos os escopos que você está solicitando ao usuário `{scopes}` (por exemplo: Mail.Read ou User.Read).</span><span class="sxs-lookup"><span data-stu-id="d8c4c-253">Be sure that `{scopes}` includes all the scopes you are prompting the user for (ex: Mail.Read or User.Read).</span></span>
5. <span data-ttu-id="d8c4c-254">Depois que o usuário tiver concedido permissão adicional, repetir o on-behalf-of-flow para obter acesso a essas APIs adicionais.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-254">Once the user has granted additional permission, retry the on-behalf-of-flow to get access to these additional APIs.</span></span>

### <a name="non-azure-ad-authentication"></a><span data-ttu-id="d8c4c-255">Autenticação não Azure AD</span><span class="sxs-lookup"><span data-stu-id="d8c4c-255">Non-Azure AD Authentication</span></span>

<span data-ttu-id="d8c4c-256">A solução de autenticação acima descrita só funciona para aplicativos e serviços que suportam o Azure AD como um provedor de identidade.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-256">The above-described authentication solution only works for apps and services that support Azure AD as an identity provider.</span></span> <span data-ttu-id="d8c4c-257">Os aplicativos que querem autenticar usando serviços baseados no Azure AD precisam continuar usando o fluxo de autenticação da Web baseado em [pop-up.](~/concepts/authentication.md)</span><span class="sxs-lookup"><span data-stu-id="d8c4c-257">Apps that want to authenticate using non-Azure AD based services need to continue using the pop-up-based [web authentication flow](~/concepts/authentication.md).</span></span>

> [!NOTE] 
> <span data-ttu-id="d8c4c-258">O SSO é suportado para aplicativos de propriedade do cliente nos locatários do Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="d8c4c-258">SSO is supported for customer owned apps within the Azure AD B2C tenants.</span></span>
