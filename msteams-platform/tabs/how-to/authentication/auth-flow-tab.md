---
title: Fluxo de autenticação para guias
description: Descreve o fluxo de autenticação em guias
ms.topic: conceptual
localization_priority: Normal
keywords: guias de fluxo de autenticação de equipes
ms.openlocfilehash: 1282c149beba0ff5b424585f566a703f48234fa2
ms.sourcegitcommit: 51e4a1464ea58c254ad6bd0317aca03ebf6bf1f6
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/19/2021
ms.locfileid: "52566688"
---
# <a name="microsoft-teams-authentication-flow-for-tabs"></a><span data-ttu-id="33e8c-104">fluxo de autenticação Microsoft Teams para guias</span><span class="sxs-lookup"><span data-stu-id="33e8c-104">Microsoft Teams authentication flow for tabs</span></span>

> [!NOTE]
> <span data-ttu-id="33e8c-105">Para que a autenticação funcione para sua guia em clientes móveis, você deve garantir que você esteja usando pelo menos a versão 1.4.1 do Microsoft Teams JavaScript SDK.</span><span class="sxs-lookup"><span data-stu-id="33e8c-105">For authentication to work for your tab on mobile clients, you must ensure you are using at least 1.4.1 version of the Microsoft Teams JavaScript SDK.</span></span>
> <span data-ttu-id="33e8c-106">Teams O SDK lança janela separada para fluxo de autenticação.</span><span class="sxs-lookup"><span data-stu-id="33e8c-106">Teams SDK launches separate window for authentication flow.</span></span> <span data-ttu-id="33e8c-107">Defina o `SameSite` atributo para **Lax**.</span><span class="sxs-lookup"><span data-stu-id="33e8c-107">Set the `SameSite` attribute to **Lax**.</span></span> <span data-ttu-id="33e8c-108">Teams cliente de desktop ou versões mais antigas do Chrome ou Safari não `SameSite` suportam =Nenhum.</span><span class="sxs-lookup"><span data-stu-id="33e8c-108">Teams desktop client or older versions of Chrome or Safari do not support `SameSite`=None.</span></span>

<span data-ttu-id="33e8c-109">OAuth 2.0 é um padrão aberto para autenticação e autorização usado por Azure Active Directory (AAD) e muitos outros provedores de identidade.</span><span class="sxs-lookup"><span data-stu-id="33e8c-109">OAuth 2.0 is an open standard for authentication and authorization used by Azure Active Directory (AAD) and many other identity providers.</span></span> <span data-ttu-id="33e8c-110">Um entendimento básico do OAuth 2.0 é um pré-requisito para trabalhar com autenticação em Teams.</span><span class="sxs-lookup"><span data-stu-id="33e8c-110">A basic understanding of OAuth 2.0 is a prerequisite for working with authentication in Teams.</span></span> <span data-ttu-id="33e8c-111">Para obter mais informações, consulte [OAuth 2 simplificado](https://aaronparecki.com/oauth-2-simplified/) que é mais fácil de seguir do que a [especificação formal.](https://oauth.net/2/)</span><span class="sxs-lookup"><span data-stu-id="33e8c-111">For more information, see [OAuth 2 simplified](https://aaronparecki.com/oauth-2-simplified/) that is easier to follow than the [formal specification](https://oauth.net/2/).</span></span> <span data-ttu-id="33e8c-112">O fluxo de autenticação para guias e bots é diferente porque as guias são semelhantes aos sites para que possam usar o OAuth 2.0 diretamente.</span><span class="sxs-lookup"><span data-stu-id="33e8c-112">Authentication flow for tabs and bots are different because tabs are similar to websites so they can use OAuth 2.0 directly.</span></span> <span data-ttu-id="33e8c-113">Bots fazem algumas coisas de forma diferente, mas os conceitos principais são idênticos.</span><span class="sxs-lookup"><span data-stu-id="33e8c-113">Bots do a few things differently, but the core concepts are identical.</span></span>

<span data-ttu-id="33e8c-114">Para um exemplo de fluxo de autenticação para guias e bots usando o Nó e o [tipo de subvenção implícita OAuth 2.0,](https://oauth.net/2/grant-types/implicit/)consulte [iniciar o fluxo de autenticação para guias](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow).</span><span class="sxs-lookup"><span data-stu-id="33e8c-114">For an example of authentication flow for tabs and bots using Node and the [OAuth 2.0 implicit grant type](https://oauth.net/2/grant-types/implicit/), see [initiate authentication flow for tabs](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow).</span></span>

> [!NOTE]
> <span data-ttu-id="33e8c-115">Antes de mostrar um botão **de login** para o usuário e chamar a `microsoftTeams.authentication.authenticate` API em resposta à seleção do botão, você deve aguardar a inicialização do SDK para ser concluída.</span><span class="sxs-lookup"><span data-stu-id="33e8c-115">Before showing a **Login** button to the user and calling the `microsoftTeams.authentication.authenticate` API in response to selecting the button, you must wait for the SDK initialization to complete.</span></span> <span data-ttu-id="33e8c-116">Você pode passar um retorno de chamada para a `microsoftTeams.initialize` API que é chamada quando a inicialização é concluída.</span><span class="sxs-lookup"><span data-stu-id="33e8c-116">You can pass a callback to the `microsoftTeams.initialize` API that is called when initialization completes.</span></span>

![Diagrama da sequência de autenticação da guia](~/assets/images/authentication/tab_auth_sequence_diagram.png)

1. <span data-ttu-id="33e8c-118">O usuário interage com o conteúdo na configuração da guia ou na página de conteúdo, comumente um botão **De entrada** ou **login.**</span><span class="sxs-lookup"><span data-stu-id="33e8c-118">The user interacts with the content on the tab configuration or content page, commonly a **Sign in** or **Log in** button.</span></span>
2. <span data-ttu-id="33e8c-119">A guia constrói a URL para sua página inicial auth.</span><span class="sxs-lookup"><span data-stu-id="33e8c-119">The tab constructs the URL for its auth start page.</span></span> <span data-ttu-id="33e8c-120">Opcionalmente, ele usa informações de espaços reservados de URL ou chamadas `microsoftTeams.getContext()` Teams método SDK do cliente para agilizar a experiência de autenticação para o usuário.</span><span class="sxs-lookup"><span data-stu-id="33e8c-120">Optionally, it uses information from URL placeholders or calls `microsoftTeams.getContext()` Teams client SDK method to streamline the authentication experience for the user.</span></span> <span data-ttu-id="33e8c-121">Por exemplo, ao autenticar com AAD, se o `login_hint` parâmetro estiver definido no endereço de e-mail do usuário, o usuário não precisa fazer login se o fez recentemente.</span><span class="sxs-lookup"><span data-stu-id="33e8c-121">For example, when authenticating with AAD, if the `login_hint` parameter is set to the user's email address, the user does not have to sign in if they have done so recently.</span></span> <span data-ttu-id="33e8c-122">Isso ocorre porque o AAD usa as credenciais em cache do usuário.</span><span class="sxs-lookup"><span data-stu-id="33e8c-122">This is because AAD uses the user's cached credentials.</span></span> <span data-ttu-id="33e8c-123">A janela pop-up é mostrada brevemente e depois desaparece.</span><span class="sxs-lookup"><span data-stu-id="33e8c-123">The pop-up window is shown briefly and then disappears.</span></span>
3. <span data-ttu-id="33e8c-124">Em seguida, a guia chama o `microsoftTeams.authentication.authenticate()` geral e registra as `successCallback` e `failureCallback` funções.</span><span class="sxs-lookup"><span data-stu-id="33e8c-124">The tab then calls the `microsoftTeams.authentication.authenticate()` method and registers the `successCallback` and `failureCallback` functions.</span></span>
4. <span data-ttu-id="33e8c-125">Teams abre a página inicial em um iframe em uma janela pop-up.</span><span class="sxs-lookup"><span data-stu-id="33e8c-125">Teams opens the start page in an iframe in a pop-up window.</span></span> <span data-ttu-id="33e8c-126">A página inicial gera `state` dados aleatórios, salva-os para validação futura e redireciona para o ponto final do provedor de `/authorize` identidade, como para O `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` Azure AD.</span><span class="sxs-lookup"><span data-stu-id="33e8c-126">The start page generates random `state` data, saves it for future validation, and redirects to the identity provider's `/authorize` endpoint, such as `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` for Azure AD.</span></span> <span data-ttu-id="33e8c-127">Substitua `<tenant id>` com seu próprio id inquilino que é context.tid.</span><span class="sxs-lookup"><span data-stu-id="33e8c-127">Replace `<tenant id>` with your own tenant id that is context.tid.</span></span>
<span data-ttu-id="33e8c-128">Semelhante a outros fluxos de auth de aplicativo em Teams, a página inicial deve estar em um domínio que está em sua `validDomains` lista e no mesmo domínio que o sinal de postagem na página de redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="33e8c-128">Similar to other application auth flows in Teams, the start page must be on a domain that is in its `validDomains` list, and on the same domain as the post sign in redirect page.</span></span>

    > [!NOTE]
    > <span data-ttu-id="33e8c-129">O fluxo de subvenção implícita OAuth 2.0 exige um `state` parâmetro na solicitação de autenticação, que contém dados de sessão exclusivos para evitar um ataque de [falsificação de solicitação entre sites](https://en.wikipedia.org/wiki/Cross-site_request_forgery).</span><span class="sxs-lookup"><span data-stu-id="33e8c-129">The OAuth 2.0 implicit grant flow calls for a `state` parameter in the authentication request, which contains unique session data to prevent a [cross-site request forgery attack](https://en.wikipedia.org/wiki/Cross-site_request_forgery).</span></span> <span data-ttu-id="33e8c-130">Os exemplos usam um GUID gerado aleatoriamente para os `state` dados.</span><span class="sxs-lookup"><span data-stu-id="33e8c-130">The examples use a randomly-generated GUID for the `state` data.</span></span>

5. <span data-ttu-id="33e8c-131">No site do provedor, o usuário faz a assinatura e concede acesso à guia.</span><span class="sxs-lookup"><span data-stu-id="33e8c-131">On the provider's site, the user signs in and grants access to the tab.</span></span>
6. <span data-ttu-id="33e8c-132">O provedor leva o usuário para a página de redirecionamento OAuth 2.0 da guia com um token de acesso.</span><span class="sxs-lookup"><span data-stu-id="33e8c-132">The provider takes the user to the tab's OAuth 2.0 redirect page with an access token.</span></span>
7. <span data-ttu-id="33e8c-133">A guia verifica se o valor devolvido `state` corresponde ao que foi salvo anteriormente, e chama , que por sua vez chama a função registrada na etapa `microsoftTeams.authentication.notifySuccess()` `successCallback` 3.</span><span class="sxs-lookup"><span data-stu-id="33e8c-133">The tab checks that the returned `state` value matches what was saved earlier, and calls `microsoftTeams.authentication.notifySuccess()`, which in turn calls the `successCallback` function registered in step 3.</span></span>
8. <span data-ttu-id="33e8c-134">Teams fecha a janela pop-up.</span><span class="sxs-lookup"><span data-stu-id="33e8c-134">Teams closes the pop-up window.</span></span>
9. <span data-ttu-id="33e8c-135">A guia exibe interface do usuário de configuração, atualiza ou recarrega o conteúdo das guias, dependendo de onde o usuário começou.</span><span class="sxs-lookup"><span data-stu-id="33e8c-135">The tab either displays configuration UI, refreshes, or reloads the tabs content, depending on where the user started from.</span></span>

## <a name="treat-tab-context-as-hints"></a><span data-ttu-id="33e8c-136">Tratar o contexto da guia como dicas</span><span class="sxs-lookup"><span data-stu-id="33e8c-136">Treat tab context as hints</span></span>

<span data-ttu-id="33e8c-137">Embora o contexto da guia forneça informações úteis sobre o usuário, não use essas informações para autenticar o usuário.</span><span class="sxs-lookup"><span data-stu-id="33e8c-137">Although the tab context provides helpful information regarding the user, do not use this information to authenticate the user.</span></span> <span data-ttu-id="33e8c-138">Autenticar o usuário mesmo que você obtenha as informações como parâmetros de URL para a URL de conteúdo da guia ou chamando a `microsoftTeams.getContext()` função no Microsoft Teams SDK cliente.</span><span class="sxs-lookup"><span data-stu-id="33e8c-138">Do authenticate the user even if you get the information as URL parameters to your tab content URL or by calling the `microsoftTeams.getContext()` function in the Microsoft Teams client SDK.</span></span> <span data-ttu-id="33e8c-139">Um ator mal-intencionado pode invocar sua URL de conteúdo de guia com seus próprios parâmetros.</span><span class="sxs-lookup"><span data-stu-id="33e8c-139">A malicious actor can invoke your tab content URL with its own parameters.</span></span> <span data-ttu-id="33e8c-140">O ator também pode invocar uma página da Web personificando Microsoft Teams para carregar sua URL de conteúdo de guia em um iframe e retornar seus próprios dados para a `getContext()` função.</span><span class="sxs-lookup"><span data-stu-id="33e8c-140">The actor can also invoke a web page impersonating Microsoft Teams to load your tab content URL in an iframe and return its own data to the `getContext()` function.</span></span> <span data-ttu-id="33e8c-141">Você deve tratar as informações relacionadas à identidade no contexto da guia simplesmente como dicas e validá-las antes do uso.</span><span class="sxs-lookup"><span data-stu-id="33e8c-141">You must treat the identity-related information in the tab context simply as hints and validate them before use.</span></span> <span data-ttu-id="33e8c-142">Consulte as notas em [navegação para a página de autorização da sua página pop-up](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page).</span><span class="sxs-lookup"><span data-stu-id="33e8c-142">Refer to the notes in [navigate to the authorization page from your pop-up page](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page).</span></span>

## <a name="code-sample"></a><span data-ttu-id="33e8c-143">Exemplo de código</span><span class="sxs-lookup"><span data-stu-id="33e8c-143">Code sample</span></span>

<span data-ttu-id="33e8c-144">Código de amostra mostrando o processo de autenticação de guias:</span><span class="sxs-lookup"><span data-stu-id="33e8c-144">Sample code showing the tab authentication process:</span></span>

| <span data-ttu-id="33e8c-145">**Nome da amostra**</span><span class="sxs-lookup"><span data-stu-id="33e8c-145">**Sample name**</span></span> | <span data-ttu-id="33e8c-146">**Descrição**</span><span class="sxs-lookup"><span data-stu-id="33e8c-146">**Description**</span></span> | <span data-ttu-id="33e8c-147">**C#**</span><span class="sxs-lookup"><span data-stu-id="33e8c-147">**C#**</span></span> | <span data-ttu-id="33e8c-148">**Node.js**</span><span class="sxs-lookup"><span data-stu-id="33e8c-148">**Node.js**</span></span> |
|-----------------|-----------------|-------------|------------|
| <span data-ttu-id="33e8c-149">Teams autenticação da guia Teams</span><span class="sxs-lookup"><span data-stu-id="33e8c-149">Teams tab authentication</span></span> | <span data-ttu-id="33e8c-150">Processo de autenticação para guias usando AAD.</span><span class="sxs-lookup"><span data-stu-id="33e8c-150">Authentication process for tabs using AAD.</span></span> | [<span data-ttu-id="33e8c-151">View</span><span class="sxs-lookup"><span data-stu-id="33e8c-151">View</span></span>](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-complete-sample/csharp) | [<span data-ttu-id="33e8c-152">View</span><span class="sxs-lookup"><span data-stu-id="33e8c-152">View</span></span>](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-complete-sample/nodejs) |

## <a name="more-details"></a><span data-ttu-id="33e8c-153">Mais detalhes</span><span class="sxs-lookup"><span data-stu-id="33e8c-153">More details</span></span>

<span data-ttu-id="33e8c-154">Para obter uma implementação detalhada para autenticação de guias usando AAD, consulte:</span><span class="sxs-lookup"><span data-stu-id="33e8c-154">For a detailed implementation for tab authentication using AAD, see:</span></span>

* [<span data-ttu-id="33e8c-155">Autenticar um usuário em uma guia Teams</span><span class="sxs-lookup"><span data-stu-id="33e8c-155">Authenticate a user in a Teams tab</span></span>](~/tabs/how-to/authentication/auth-tab-AAD.md)
* [<span data-ttu-id="33e8c-156">Autenticação silenciosa</span><span class="sxs-lookup"><span data-stu-id="33e8c-156">Silent authentication</span></span>](~/tabs/how-to/authentication/auth-silent-AAD.md)
