---
title: Fluxo de autenticação para guias
description: Descreve o fluxo de autenticação em guias
keywords: guias de fluxo de autenticação de equipes
ms.openlocfilehash: 5ecd4d7d3a2658d17a8c6dea5d73cbd98eb2dfde
ms.sourcegitcommit: bfdcd122b6b4ffc52d92320d4741f870c07f0542
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/02/2020
ms.locfileid: "49552539"
---
# <a name="microsoft-teams-authentication-flow-for-tabs"></a><span data-ttu-id="d59c0-104">Fluxo de autenticação do Microsoft Teams para guias</span><span class="sxs-lookup"><span data-stu-id="d59c0-104">Microsoft Teams authentication flow for tabs</span></span>

> [!Note]
> <span data-ttu-id="d59c0-105">Para que a autenticação funcione para sua guia em clientes móveis, é necessário garantir que você esteja usando pelo menos a versão 1.4.1 do SDK do Microsoft Teams JavaScript.</span><span class="sxs-lookup"><span data-stu-id="d59c0-105">For authentication to work for your tab on mobile clients, you need to ensure you're using at least the 1.4.1 version of the Teams JavaScript SDK.</span></span>
> <span data-ttu-id="d59c0-106">O Teams SDK inicia a janela separada para o fluxo de autenticação e, portanto, o atributo SameSite pode ser definido como ' LAX '.</span><span class="sxs-lookup"><span data-stu-id="d59c0-106">Teams SDK launches separate window for authentication flow and hence samesite attribute can be set to 'Lax'.</span></span> <span data-ttu-id="d59c0-107">Atualmente, SameSite = nenhum não é suportado pelo cliente do teams desktop ou por versões mais antigas do Chrome ou do Safari.</span><span class="sxs-lookup"><span data-stu-id="d59c0-107">Currently, SameSite=None is not supported by the Teams desktop client or older versions of Chrome or Safari.</span></span>

<span data-ttu-id="d59c0-108">O OAuth 2,0 é um padrão aberto para autenticação e autorização usados pelo Azure AD e muitos outros provedores de identidade.</span><span class="sxs-lookup"><span data-stu-id="d59c0-108">OAuth 2.0 is an open standard for authentication and authorization used by Azure AD and many other identity providers.</span></span> <span data-ttu-id="d59c0-109">Uma compreensão básica do OAuth 2,0 é um pré-requisito para trabalhar com autenticação no Microsoft Teams; [Veja aqui uma boa visão geral](https://aaronparecki.com/oauth-2-simplified/) que é mais fácil de seguir do que a [especificação formal](https://oauth.net/2/).</span><span class="sxs-lookup"><span data-stu-id="d59c0-109">A basic understanding of OAuth 2.0 is a prerequisite for working with authentication in Teams; [here's a good overview](https://aaronparecki.com/oauth-2-simplified/) that's easier to follow than the [formal specification](https://oauth.net/2/).</span></span> <span data-ttu-id="d59c0-110">O fluxo de autenticação para guias e bots é um pouco diferente porque guias são muito semelhantes aos sites para que eles possam usar o OAuth 2,0 diretamente; os bots não são e devem fazer algumas coisas de forma diferente, mas os conceitos principais são idênticos.</span><span class="sxs-lookup"><span data-stu-id="d59c0-110">Authentication flow for tabs and bots are a little different because tabs are very similar to websites so they can use OAuth 2.0 directly; bots are not and must do a few things differently, but the core concepts are identical.</span></span>

<span data-ttu-id="d59c0-111">*Veja*, [iniciar o fluxo de autenticação para guias](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow) para obter um exemplo de fluxo de autenticação para guias e bots usando o nó e o [tipo de concessão implícita OAuth 2,0](https://oauth.net/2/grant-types/implicit/).</span><span class="sxs-lookup"><span data-stu-id="d59c0-111">*See*, [Initiate authentication flow for tabs](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow) for an example of authentication flow for tabs and bots using Node and the [OAuth 2.0 implicit grant type](https://oauth.net/2/grant-types/implicit/).</span></span>

![Diagrama de sequência de autenticação de guia](~/assets/images/authentication/tab_auth_sequence_diagram.png)

1. <span data-ttu-id="d59c0-113">O usuário interage com o conteúdo na configuração da guia ou página de conteúdo, normalmente um botão rotulado "entrar" ou "fazer logon".</span><span class="sxs-lookup"><span data-stu-id="d59c0-113">The user interacts with the content on the tab configuration or content page, commonly a button labeled "Sign in" or "Log in".</span></span>
2. <span data-ttu-id="d59c0-114">A guia constrói a URL da sua página inicial de autenticação, usando, opcionalmente, as informações dos espaços reservados de URL ou chamando `microsoftTeams.getContext()` o método SDK do cliente do teams para simplificar a experiência de autenticação para o usuário.</span><span class="sxs-lookup"><span data-stu-id="d59c0-114">The tab constructs the URL for its auth start page, optionally using information from URL placeholders or by calling `microsoftTeams.getContext()` Teams client SDK method to streamline the authentication experience for the user.</span></span> <span data-ttu-id="d59c0-115">Por exemplo, ao autenticar com o Azure AD, se o `login_hint` parâmetro estiver definido como o endereço de email do usuário, o usuário pode não ter que fazer logon se tiver feito isso recentemente, porque o Azure ad usará as credenciais armazenadas em cache do usuário, se possível: o pop-up piscará brevemente e desaparecerá.</span><span class="sxs-lookup"><span data-stu-id="d59c0-115">For example, when authenticating with Azure AD, if the `login_hint` parameter is set to the user's email address, the user may not even have to sign in if they have done so recently, because Azure AD will use the user's cached credentials if possible: the popup will flash briefly and then disappear.</span></span>
3. <span data-ttu-id="d59c0-116">Em seguida, a guia chama o `microsoftTeams.authentication.authenticate()` método e registra as `successCallback` `failureCallback` funções e.</span><span class="sxs-lookup"><span data-stu-id="d59c0-116">The tab then calls the `microsoftTeams.authentication.authenticate()` method and registers the `successCallback` and `failureCallback` functions.</span></span>
4. <span data-ttu-id="d59c0-117">O Microsoft Teams abre a página inicial em um iframe em uma janela pop-up.</span><span class="sxs-lookup"><span data-stu-id="d59c0-117">Teams opens the start page in an iframe in a pop-up window.</span></span> <span data-ttu-id="d59c0-118">A página inicial gera dados aleatórios `state` , salva-os para validação futura e redireciona para o ponto de extremidade do provedor de identidade, como `/authorize` para o `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` Azure AD.</span><span class="sxs-lookup"><span data-stu-id="d59c0-118">The start page generates random `state` data, saves it for future validation, and redirects to the identity provider's `/authorize` endpoint such as `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` for Azure AD.</span></span> <span data-ttu-id="d59c0-119">Substitua `<tenant id>` por sua própria ID de locatário (Context. tid).</span><span class="sxs-lookup"><span data-stu-id="d59c0-119">Replace `<tenant id>` with your own tenant id (context.tid).</span></span>
    * <span data-ttu-id="d59c0-120">Como outros fluxos de autenticação de aplicativos no Microsoft Teams, a página inicial deve estar em um domínio que está em sua `validDomains` lista e no mesmo domínio que a página de redirecionamento após o logon.</span><span class="sxs-lookup"><span data-stu-id="d59c0-120">Like other application auth flows in Teams, the start page must be on a domain that's in its `validDomains` list, and on the same domain as the post-login redirect page.</span></span>
    * <span data-ttu-id="d59c0-121">**Importante**: o fluxo de concessão implícita do OAuth 2,0 chama um `state` parâmetro na solicitação de autenticação que contém dados de sessão exclusivos para evitar um [ataque de falsificação de solicitação entre sites](https://en.wikipedia.org/wiki/Cross-site_request_forgery).</span><span class="sxs-lookup"><span data-stu-id="d59c0-121">**IMPORTANT**: The OAuth 2.0 implicit grant flow calls for a `state` parameter in the authentication request which contains unique session data to prevent a [cross-site request forgery attack](https://en.wikipedia.org/wiki/Cross-site_request_forgery).</span></span> <span data-ttu-id="d59c0-122">Os exemplos abaixo usam um GUID gerado aleatoriamente para os `state` dados.</span><span class="sxs-lookup"><span data-stu-id="d59c0-122">The examples below use a randomly-generated GUID for the `state` data.</span></span>
5. <span data-ttu-id="d59c0-123">No site do provedor, o usuário entra e concede acesso à guia.</span><span class="sxs-lookup"><span data-stu-id="d59c0-123">On the provider's site, the user signs in and grants access to the tab.</span></span>
6. <span data-ttu-id="d59c0-124">O provedor leva o usuário para a página de redirecionamento OAuth 2,0 da guia com um token de acesso.</span><span class="sxs-lookup"><span data-stu-id="d59c0-124">The provider takes the user to the tab's OAuth 2.0 redirect page with an access token.</span></span>
7. <span data-ttu-id="d59c0-125">A guia verifica se o `state` valor retornado corresponde ao que foi salvo anteriormente e, por `microsoftTeams.authentication.notifySuccess()` sua vez, chama a `successCallback` função registrada na etapa 3.</span><span class="sxs-lookup"><span data-stu-id="d59c0-125">The tab checks that the returned `state` value matches what was saved earlier, and calls `microsoftTeams.authentication.notifySuccess()`, which in turn calls the `successCallback` function registered in step 3.</span></span>
8. <span data-ttu-id="d59c0-126">O Microsoft Teams fecha a janela pop-up.</span><span class="sxs-lookup"><span data-stu-id="d59c0-126">Teams closes the pop-up window.</span></span>
9. <span data-ttu-id="d59c0-127">A guia exibe a interface do usuário de configuração ou atualiza ou recarrega o conteúdo das guias, dependendo de onde o usuário iniciou.</span><span class="sxs-lookup"><span data-stu-id="d59c0-127">The tab either displays configuration UI or refreshes or reloads the tabs content, depending on where the user started from.</span></span>

## <a name="treat-tab-context-as-hints"></a><span data-ttu-id="d59c0-128">Tratar contexto da guia como dicas</span><span class="sxs-lookup"><span data-stu-id="d59c0-128">Treat tab context as hints</span></span>

<span data-ttu-id="d59c0-129">Embora o contexto de guia forneça informações úteis sobre o usuário, não use essas informações para autenticar o usuário se ele for como parâmetros de URL para a URL de conteúdo da sua guia ou chamando a `microsoftTeams.getContext()` função no Microsoft Teams Client SDK.</span><span class="sxs-lookup"><span data-stu-id="d59c0-129">Although the tab context provides helpful information regarding the user, don't use this information to authenticate the user whether you get it as URL parameters to your tab content URL or by calling the `microsoftTeams.getContext()` function in the Microsoft Teams client SDK.</span></span> <span data-ttu-id="d59c0-130">Um ator mal-intencionado pode invocar a URL de conteúdo da guia com seus próprios parâmetros, e uma página da Web representando o Microsoft Teams pode carregar sua URL de conteúdo de tabulação em um iframe e retornar seus próprios dados para a `getContext()` função.</span><span class="sxs-lookup"><span data-stu-id="d59c0-130">A malicious actor could invoke your tab content URL with its own parameters, and a web page impersonating Microsoft Teams could load your tab content URL in an iframe and return its own data to the `getContext()` function.</span></span> <span data-ttu-id="d59c0-131">Você deve tratar as informações relacionadas à identidade no contexto da guia simplesmente como dicas e validá-las antes de usar.</span><span class="sxs-lookup"><span data-stu-id="d59c0-131">You should treat the identity-related information in the tab context simply as hints and validate them before use.</span></span> <span data-ttu-id="d59c0-132">Consulte as observações em [navegar até a página autorização na página pop-up](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page).</span><span class="sxs-lookup"><span data-stu-id="d59c0-132">Refer to the notes in [Navigate to the authorization page from your popup page](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page).</span></span>

## <a name="samples"></a><span data-ttu-id="d59c0-133">Exemplos</span><span class="sxs-lookup"><span data-stu-id="d59c0-133">Samples</span></span>

<span data-ttu-id="d59c0-134">Para ver o código de exemplo que mostra o processo de autenticação de guia, consulte:</span><span class="sxs-lookup"><span data-stu-id="d59c0-134">For sample code showing the tab authentication process see:</span></span>

* [<span data-ttu-id="d59c0-135">Exemplo de autenticação de guia do Microsoft Teams (nó)</span><span class="sxs-lookup"><span data-stu-id="d59c0-135">Microsoft Teams tab authentication sample (Node)</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-complete-node)
* [<span data-ttu-id="d59c0-136">Exemplo de autenticação de guia do Microsoft Teams (C#)</span><span class="sxs-lookup"><span data-stu-id="d59c0-136">Microsoft Teams tab authentication sample (C#)</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-complete-csharp)

## <a name="more-details"></a><span data-ttu-id="d59c0-137">Mais detalhes</span><span class="sxs-lookup"><span data-stu-id="d59c0-137">More details</span></span>

<span data-ttu-id="d59c0-138">Para obter uma implementação detalhada passo a passo para a autenticação de guia direcionada ao Azure Active Directory, confira:</span><span class="sxs-lookup"><span data-stu-id="d59c0-138">For a detailed implementation walkthrough for tab authentication targeting Azure Active Directory see:</span></span>

* [<span data-ttu-id="d59c0-139">Autenticar um usuário em uma guia do Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="d59c0-139">Authenticate a user in a Microsoft Teams tab</span></span>](~/tabs/how-to/authentication/auth-tab-AAD.md)
* [<span data-ttu-id="d59c0-140">Autenticação silenciosa</span><span class="sxs-lookup"><span data-stu-id="d59c0-140">Silent authentication</span></span>](~/tabs/how-to/authentication/auth-silent-AAD.md)
