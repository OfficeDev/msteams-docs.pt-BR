---
title: Alterações na API de bot para membros da equipe/chat
author: ojasvichoudhary
description: Descreve as alterações futuras e em andamento nas APIs bot usadas para recuperar membros de equipes e chats
keywords: lista de membros da equipe de apis de estrutura de bot
ms.topic: reference
ms.author: ojchoudh
ms.openlocfilehash: 38ccdd1d3052e906ceacaa47fa0cd14a1be7a41d
ms.sourcegitcommit: 79e6bccfb513d4c16a58ffc03521edcf134fa518
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/13/2021
ms.locfileid: "51696514"
---
# <a name="teams-bot-api-changes-to-fetch-team-or-chat-members"></a><span data-ttu-id="17364-104">Alterações na API de bot do Teams para buscar membros de equipe ou chat</span><span class="sxs-lookup"><span data-stu-id="17364-104">Teams bot API changes to fetch team or chat members</span></span>

>[!NOTE]
> <span data-ttu-id="17364-105">O processo de deprecation para `TeamsInfo.getMembers` `TeamsInfo.GetMembersAsync` e APIs foi iniciado.</span><span class="sxs-lookup"><span data-stu-id="17364-105">The deprecation process for `TeamsInfo.getMembers` and `TeamsInfo.GetMembersAsync` APIs have started.</span></span> <span data-ttu-id="17364-106">Inicialmente, elas são fortemente aceleradas para cinco solicitações por minuto e retornam um máximo de 10 mil membros por equipe.</span><span class="sxs-lookup"><span data-stu-id="17364-106">Initially, they are heavily throttled to five requests per minute and return a maximum of 10K members per team.</span></span> <span data-ttu-id="17364-107">Isso resulta na lista completa não sendo retornada à medida que o tamanho da equipe aumenta.</span><span class="sxs-lookup"><span data-stu-id="17364-107">This results in the full roster not being returned as team size increases.</span></span>
> <span data-ttu-id="17364-108">Você deve atualizar para a versão 4.10 ou superior do SDK da Estrutura de Bot e alternar para os pontos de extremidade da API paginada ou para a API de usuário `TeamsInfo.GetMemberAsync` único.</span><span class="sxs-lookup"><span data-stu-id="17364-108">You must update to version 4.10 or higher of the Bot Framework SDK and switch to the paginated API endpoints, or the `TeamsInfo.GetMemberAsync` single user API.</span></span> <span data-ttu-id="17364-109">Isso também se aplica ao bot mesmo que você não use essas APIs diretamente, pois os SDKs mais antigos chamam essas APIs durante [eventos membersAdded.](../bots/how-to/conversations/subscribe-to-conversation-events.md#team-members-added)</span><span class="sxs-lookup"><span data-stu-id="17364-109">This also applies to your bot even if you are not directly using these APIs, as older SDKs call these APIs during [membersAdded](../bots/how-to/conversations/subscribe-to-conversation-events.md#team-members-added) events.</span></span> <span data-ttu-id="17364-110">Para exibir a lista de alterações futuras, consulte [ALTERAÇÕES da API](team-chat-member-api-changes.md#api-changes).</span><span class="sxs-lookup"><span data-stu-id="17364-110">To view the list of upcoming changes, see [API changes](team-chat-member-api-changes.md#api-changes).</span></span> 

<span data-ttu-id="17364-111">Atualmente, os desenvolvedores de bot que querem recuperar informações para um ou mais membros de um chat ou equipe usam as APIs de bot do Microsoft Teams para C# ou para `TeamsInfo.GetMembersAsync` `TeamsInfo.getMembers` APIs TypeScript ou Node.js.</span><span class="sxs-lookup"><span data-stu-id="17364-111">Currently, bot developers who want to retrieve information for one or more members of a chat or team use the Microsoft Teams bot APIs `TeamsInfo.GetMembersAsync` for C# or `TeamsInfo.getMembers` for TypeScript or Node.js APIs.</span></span> <span data-ttu-id="17364-112">Para obter mais informações, consulte [fetch roster or user profile](../bots/how-to/get-teams-context.md#fetch-the-roster-or-user-profile).</span><span class="sxs-lookup"><span data-stu-id="17364-112">For more information, see [fetch roster or user profile](../bots/how-to/get-teams-context.md#fetch-the-roster-or-user-profile).</span></span> <span data-ttu-id="17364-113">Essas APIs têm várias deficiências.</span><span class="sxs-lookup"><span data-stu-id="17364-113">These APIs have several shortcomings.</span></span>

<span data-ttu-id="17364-114">Atualmente, se você deseja recuperar informações para um ou mais membros de um chat ou equipe, pode usar as [APIs](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetch-the-roster-or-user-profile) de bot do Microsoft Teams para C# ou para TYPEScript ou `TeamsInfo.GetMembersAsync` `TeamsInfo.getMembers` apIs Node.js.</span><span class="sxs-lookup"><span data-stu-id="17364-114">Currently, if you want to retrieve information for one or more members of a chat or team, you can use the [Microsoft Teams bot APIs](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetch-the-roster-or-user-profile) `TeamsInfo.GetMembersAsync` for C# or `TeamsInfo.getMembers` for TypeScript or Node.js APIs.</span></span> <span data-ttu-id="17364-115">Essas APIs têm as seguintes deficiências:</span><span class="sxs-lookup"><span data-stu-id="17364-115">These APIs have the following shortcomings:</span></span>

* <span data-ttu-id="17364-116">Para equipes grandes, o desempenho é ruim e os tempos limite são mais prováveis: o tamanho máximo da equipe aumentou consideravelmente desde que o Teams foi lançado no início de 2017.</span><span class="sxs-lookup"><span data-stu-id="17364-116">For large teams, performance is poor and timeouts are more likely: The maximum team size has grown considerably since Teams was released in early 2017.</span></span> <span data-ttu-id="17364-117">Como ou retorna toda a lista de membros, leva muito tempo para a chamada da API retornar para equipes grandes, e é comum que a chamada tenha tempo de espera e você precisa `GetMembersAsync` `getMembers` tentar novamente.</span><span class="sxs-lookup"><span data-stu-id="17364-117">As `GetMembersAsync` or `getMembers` returns the entire member list, it takes a long time for the API call to return for large teams, and it is common for the call to time out and you have to try again.</span></span>
* <span data-ttu-id="17364-118">Obter detalhes de perfil para um único usuário é difícil: para obter as informações de perfil de um único usuário, você precisa recuperar toda a lista de membros e, em seguida, pesquisar o que você deseja.</span><span class="sxs-lookup"><span data-stu-id="17364-118">Getting profile details for a single user is difficult: To get the profile information for a single user, you have to retrieve the entire member list and then search for the one you want.</span></span> <span data-ttu-id="17364-119">Há uma função auxiliar no SDK da Estrutura de Bots para torná-lo mais simples, mas não é eficiente.</span><span class="sxs-lookup"><span data-stu-id="17364-119">There is a helper function in the Bot Framework SDK to make it simpler, but it is not efficient.</span></span>

<span data-ttu-id="17364-120">Com a introdução de equipes de toda a organização, há um requisito para alinhar melhor essas APIs com controles de privacidade do Office 365.</span><span class="sxs-lookup"><span data-stu-id="17364-120">With the introduction of organization wide teams, there is a requirement to better align these APIs with Office 365 privacy controls.</span></span> <span data-ttu-id="17364-121">Bots usados em equipes grandes são capazes de recuperar informações básicas de perfil semelhantes à `User.ReadBasic.All` permissão do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="17364-121">Bots used in large teams are able to retrieve basic profile information similar to the `User.ReadBasic.All` Microsoft Graph permission.</span></span> <span data-ttu-id="17364-122">Os administradores de locatários têm um grande controle sobre quais aplicativos e bots podem ser usados em seu locatário, mas essas configurações são diferentes do Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="17364-122">Tenant administrators have a great deal of control over which apps and bots can be used in their tenant, but these settings are different from Microsoft Graph.</span></span>

<span data-ttu-id="17364-123">O código a seguir fornece uma representação JSON de exemplo do que é retornado pelas APIs de bot do Teams:</span><span class="sxs-lookup"><span data-stu-id="17364-123">The following code provides a sample JSON representation of what is returned by Teams bot APIs:</span></span>

```json
[{
    "id": "29:1GcS4EyB_oSI8A88XmWBN7NJFyMqe3QGnJdgLfFGkJnVelzRGos0bPbpsfJjcbAD22bmKc4GMbrY2g4JDrrA8vM06X1-cHHle4zOE6U4ttcc",
    "name": "Anon1 (Guest)",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "anonymous"
}, {
    "id": "29:1bSnHZ7Js2STWrgk6ScEErLk1Lp2zQuD5H2qQ960rtvstKp8tKLl-3r8b6DoW0QxZimuTxk_kupZ1DBMpvIQQUAZL-PNj0EORDvRZXy8kvWk",
    "objectId": "76b0b09f-d410-48fd-993e-84da521a597b",
    "givenName": "John",
    "surname": "Patterson",
    "email": "johnp@fabrikam.com",
    "userPrincipalName": "johnp@fabrikam.com",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "user"
}, {
    "id": "29:1URzNQM1x1PNMr1D7L5_lFe6qF6gEfAbkdG8_BUxOW2mTKryQqEZtBTqDt10-MghkzjYDuUj4KG6nvg5lFAyjOLiGJ4jzhb99WrnI7XKriCs",
    "objectId": "6b7b3b2a-2c4b-4175-8582-41c9e685c1b5",
    "givenName": "Rick",
    "surname": "Stevens",
    "email": "Rick.Stevens@fabrikam.com",
    "userPrincipalName": "rstevens@fabrikam.com",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "user"
}]
```

## <a name="api-changes"></a><span data-ttu-id="17364-124">Alterações na API</span><span class="sxs-lookup"><span data-stu-id="17364-124">API Changes</span></span>

<span data-ttu-id="17364-125">A seguir estão as próximas alterações na API:</span><span class="sxs-lookup"><span data-stu-id="17364-125">Following are the upcoming API changes:</span></span>

* <span data-ttu-id="17364-126">Uma nova API é criada [`TeamsInfo.GetPagedMembersAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetch-the-roster-or-user-profile) para recuperar informações de perfil para membros de um chat ou equipe.</span><span class="sxs-lookup"><span data-stu-id="17364-126">A new API is created [`TeamsInfo.GetPagedMembersAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetch-the-roster-or-user-profile) for retrieving profile information for members of a chat or team.</span></span> <span data-ttu-id="17364-127">Essa API agora está disponível com o SDK da Estrutura de Bot 4.8.</span><span class="sxs-lookup"><span data-stu-id="17364-127">This API is now available with the Bot Framework 4.8 SDK.</span></span> <span data-ttu-id="17364-128">Para desenvolvimento em todas as outras versões, use o [`GetConversationPagedMembers`](https://docs.microsoft.com/dotnet/api/microsoft.bot.connector.conversationsextensions.getconversationpagedmembersasync?view=botbuilder-dotnet-stable&preserve-view=true) método.</span><span class="sxs-lookup"><span data-stu-id="17364-128">For development in all other versions, use the [`GetConversationPagedMembers`](https://docs.microsoft.com/dotnet/api/microsoft.bot.connector.conversationsextensions.getconversationpagedmembersasync?view=botbuilder-dotnet-stable&preserve-view=true) method.</span></span>

    > [!NOTE]
    > <span data-ttu-id="17364-129">Em v3 ou v4, a melhor ação é atualizar para a versão de ponto mais recente que é 3.30.2 ou 4.8 respectivamente.</span><span class="sxs-lookup"><span data-stu-id="17364-129">In either v3 or v4, the best action is to upgrade to the latest point release that is 3.30.2 or 4.8 respectively.</span></span>

* <span data-ttu-id="17364-130">Uma nova API é criada [`TeamsInfo.GetMemberAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#get-single-member-details) para recuperar as informações de perfil de um único usuário.</span><span class="sxs-lookup"><span data-stu-id="17364-130">A new API is created [`TeamsInfo.GetMemberAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#get-single-member-details) for retrieving the profile information for a single user.</span></span> <span data-ttu-id="17364-131">Ele pega a ID da equipe ou chat e um [UPN](https://docs.microsoft.com/windows/win32/ad/naming-properties#userprincipalname) que é , Azure Active Directory Object ID , ou a ID do usuário do Teams como parâmetros e retorna as informações de perfil para esse `userPrincipalName` `objectId` `id` usuário.</span><span class="sxs-lookup"><span data-stu-id="17364-131">It takes the ID of the team or chat and a [UPN](https://docs.microsoft.com/windows/win32/ad/naming-properties#userprincipalname) that is `userPrincipalName`, Azure Active Directory Object ID `objectId`, or the Teams user ID `id` as parameters and returns the profile information for that user.</span></span>

    > [!NOTE]
    > <span data-ttu-id="17364-132">`objectId` é alterado para `aadObjectId` corresponder ao que é chamado no objeto de uma mensagem da Estrutura de `Activity` Bot.</span><span class="sxs-lookup"><span data-stu-id="17364-132">`objectId` is changed to `aadObjectId` to match what is called in the `Activity` object of a Bot Framework message.</span></span> <span data-ttu-id="17364-133">A nova API está disponível com a versão 4.8 do SDK da Estrutura de Bots.</span><span class="sxs-lookup"><span data-stu-id="17364-133">The new API is available with version 4.8 of the Bot Framework SDK.</span></span> <span data-ttu-id="17364-134">Ele também está disponível na extensão SDK do Teams Bot Framework 3.x.</span><span class="sxs-lookup"><span data-stu-id="17364-134">It is also available in the Teams SDK extension Bot Framework 3.x.</span></span> <span data-ttu-id="17364-135">Enquanto isso, você pode usar o ponto de extremidade [REST.](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#get-single-member-details)</span><span class="sxs-lookup"><span data-stu-id="17364-135">Meanwhile, you can use the [REST](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#get-single-member-details) endpoint.</span></span>

* <span data-ttu-id="17364-136">`TeamsInfo.GetMembersAsync` no C# e `TeamsInfo.getMembers` em TypeScript ou Node.js está formalmente preterido.</span><span class="sxs-lookup"><span data-stu-id="17364-136">`TeamsInfo.GetMembersAsync` in C# and `TeamsInfo.getMembers` in TypeScript or Node.js is formally deprecated.</span></span> <span data-ttu-id="17364-137">Depois que a nova API está disponível, você deve atualizar seus bots para usá-la.</span><span class="sxs-lookup"><span data-stu-id="17364-137">Once the new API is available, you must update your bots to use it.</span></span> <span data-ttu-id="17364-138">Isso também se aplica à [API REST subjacente que essas APIs usam](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#tabpanel_CeZOj-G++Q_json).</span><span class="sxs-lookup"><span data-stu-id="17364-138">This also applies to the [underlying REST API that these APIs use](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#tabpanel_CeZOj-G++Q_json).</span></span>
* <span data-ttu-id="17364-139">Até o final de 2021, os bots não podem recuperar proativamente as propriedades ou para membros de um `userPrincipalName` `email` chat ou equipe.</span><span class="sxs-lookup"><span data-stu-id="17364-139">By late 2021, bots cannot proactively retrieve the `userPrincipalName` or `email` properties for members of a chat or team.</span></span> <span data-ttu-id="17364-140">Os bots devem usar o Graph para recuperá-los.</span><span class="sxs-lookup"><span data-stu-id="17364-140">Bots must use Graph to retrieve them.</span></span> <span data-ttu-id="17364-141">As `userPrincipalName` propriedades e não são `email` retornadas da nova API a partir do `GetConversationPagedMembers` final de 2021.</span><span class="sxs-lookup"><span data-stu-id="17364-141">The `userPrincipalName` and `email` properties are not returned from the new `GetConversationPagedMembers` API starting in late 2021.</span></span> <span data-ttu-id="17364-142">Os bots têm que usar o Graph com um token de acesso para recuperar informações.</span><span class="sxs-lookup"><span data-stu-id="17364-142">Bots have to use Graph with an access token to retrieve information.</span></span> <span data-ttu-id="17364-143">Deve ser mais fácil para os bots obterem um token de acesso e simplificarem e simplificarem o processo de consentimento do usuário final.</span><span class="sxs-lookup"><span data-stu-id="17364-143">It must be made easier for bots to get an access token and streamline and simplify the end-user consent process.</span></span>
